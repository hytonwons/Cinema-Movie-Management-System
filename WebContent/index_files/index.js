var FavoriteControlStyleType={FloatStyle:1,ListStyle:2,SCMStyle:3};var FavoriteCategoryControl=Class.create();Object.extend(FavoriteCategoryControl.prototype,{FAVORITE_CATEGORY_NAME_DEFAULT_TXT:"新分类名称",FAVORITE_CATEGORY_NAME_MAX_LENGTH:25,FAVORITE_CATEGORY_NAME_MAX_DESCRIPTION:"分类名不能超过{0}个字",closed:false,favoriteCategories:[],favoriteDialog:null,selectedCategoryBtn:null,favoriteCategoryListRegion:null,newCategoryTextId:null,newCategoryBtn:null,newCategoryControlBtn:null,newCategoryItemId:null,htmlElement:"li",isFloatStyle:true,server:{getFavoriteCategorys:function(h,g,f,e){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetFavoriteCategorys2",[h,g,f],e,"/community.api?Ajax_CallBack=true","post","20000")}},addToFavorate:function(k,h,f,j,g){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","AddToFavorate102",[k,h,f,j],g,"/community.api?Ajax_CallBack=true","post","20000")}},createCategory:function(c,d){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","CreateFavoriteCategory2",[c],d,"/community.api?Ajax_CallBack=true","post","20000")}}},initialize:function(b){this.favoriteCategoryListRegion=b.favoriteCategoryListRegionObj;this.favoriteDialog=b;this.load();this.server.getFavoriteCategorys(this.favoriteDialog.relatedObjType,this.favoriteDialog.relatedObjId,true,function(){var a=getFavoriteCategorysResult;if(a&&a.value){if(!a.value.isLogin){if(typeof UserLoginDialog!="undefined"){var d=new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs(["/js/2014/UserLoginDialog.js"],function(){var c=new UserLoginDialog({callback:function(){location.reload()}})})}return}this.favoriteCategories=a.value.categorys;this.favoriteCountWithoutCategory=a.value.favoriteCountWithoutCategory;this.favoriteDialog.isLogin=a.value.isLogin;this.favoriteDialog.hasFavorite=a.value.hasFavorited;if(this.favoriteDialog.hasFavorite){this.favoriteDialog.favoriteButtonText.innerHTML="已收藏";if(!this.favoriteDialog.favoriteButton.hasClassName("curron")&&this.favoriteDialog.favoriteControlStyleType==FavoriteControlStyleType.FloatStyle){this.favoriteDialog.favoriteButton.addClassName("curron");this.favoriteDialog.favoriteButton.title="已收藏"}this.buildFavoriteCategoryListRegion();this.initializeDOM();this.initializeEvent();if(a.value.isLogin){this.favoriteDialog.favoriteContainer.show();this.favoriteDialog.favoriteButton.addClassName("curr")}}else{this.server.addToFavorate(this.favoriteDialog.relatedObjType,this.favoriteDialog.relatedObjId,0,"",function(){var c=addToFavorateResult;if(c&&c.value){if(!this.favoriteDialog.favoriteButton.hasClassName("curron")&&this.favoriteDialog.favoriteControlStyleType==FavoriteControlStyleType.FloatStyle){this.favoriteDialog.favoriteButton.addClassName("curron");this.favoriteDialog.favoriteButton.title="已收藏"}this.favoriteDialog.hasFavorite=true;this.favoriteDialog.favoriteButtonText.innerHTML="已收藏"}this.buildFavoriteCategoryListRegion();this.initializeDOM();this.initializeEvent();this.favoriteDialog.favoriteContainer.show();this.favoriteDialog.favoriteButton.addClassName("curr")}.bind(this))}}}.bind(this))},initializeDOM:function(){this.selectedCategoryBtn=this.favoriteDialog.selectedCategoryObj},destroyDOM:function(){this.selectedCategoryBtn=null;this.favoriteDialog=null;this.favoriteCategories=[];this.favoriteCategoryListRegion=null;this.newCategoryTextId=null;this.newCategoryBtn=null;this.newCategoryControlBtn=null;this.newCategoryItemId=null},initializeEvent:function(){this.onClickSelectedCategoryBtnHandler=this.onClickSelectedCategoryBtn.bindAsEventListener(this);Event.observe(this.selectedCategoryBtn,"click",this.onClickSelectedCategoryBtnHandler);this.onClickNewCategoryBtnHandler=this.onClickNewCategoryBtn.bindAsEventListener(this);Event.observe(this.newCategoryBtn,"click",this.onClickNewCategoryBtnHandler)},destroyEvent:function(){Event.stopObserving(this.onClickSelectedCategoryBtn,"click",this.onClickSelectedCategoryBtnHandler);Event.stopObserving(this.onClickNewCategoryBtn,"click",this.onClickNewCategoryBtnHandler);this.favoriteCategoryListRegion.getElementsBySelector(this.htmlElement).each(function(f){var d=f.readAttribute("categoryId");if(typeof(d)!="undefined"){var e=Event.findElement(f,this.htmlElement);Event.stopObserving(e,"click",this.onClickAddFavoriteBtnHandler)}})},buildCategoryItem:function(g,h,f){var e=Builder.node(this.htmlElement,{categoryId:g},[Builder.node("a",{href:"#",method:"selectCategory"},[h])]);this.onClickAddFavoriteBtnHandler=this.onClickAddFavoriteBtn.bindAsEventListener(this);Event.observe(e,"click",this.onClickAddFavoriteBtnHandler);return e},buildNewCategoryItem:function(){this.newCategoryControlBtn=Builder.node(this.htmlElement,{},[Builder.node("a",{href:"#",method:"selectCategory"},[Builder.node("i",{className:"ico_t_add"}),"新分类"])]);return this.newCategoryControlBtn},buildAddTextCategoryItem:function(){this.newCategoryTextId=Builder.node("input",{className:"colltxt",type:"text"});this.newCategoryBtn=Builder.node("input",{className:"btn",type:"button"});if(this.isFloatStyle){this.newCategoryItemId=Builder.node("li",{},[Builder.node("div",{className:"addcollsec clearfix"},[this.newCategoryTextId,this.newCategoryBtn])])}else{this.newCategoryItemId=Builder.node("div",{className:"addcollsec clearfix"},[this.newCategoryTextId,this.newCategoryBtn])}return this.newCategoryItemId},buildFavoriteCategoryListRegion:function(){this.favoriteCategoryListRegion.appendChild(this.buildCategoryItem(0,"未分类",this.favoriteCountWithoutCategory));this.favoriteCategories.each(function(b){this.favoriteCategoryListRegion.appendChild(this.buildCategoryItem(b.Id,b.Name,b.Count))}.bind(this));this.favoriteCategoryListRegion.appendChild(this.buildAddTextCategoryItem())},onClickSelectedCategoryBtn:function(d){htmlElement="dl";if(!this.isFloatStyle){htmlElement="div"}var c=Event.findElement(d,htmlElement);if(c.hasClassName("curr")){c.removeClassName("curr");if(this.favoriteDialog.categoryContrainerObj.visible()){this.favoriteDialog.categoryContrainerObj.hide()}}else{c.addClassName("curr");if(!this.favoriteDialog.categoryContrainerObj.visible()){this.favoriteDialog.categoryContrainerObj.show()}}Event.stop(d)},onClickNewCategoryControlBtn:function(b){if(this.newCategoryItemId){if(!this.newCategoryItemId.visible()){this.newCategoryItemId.show()}else{this.newCategoryItemId.hide()}}Event.stop(b)},onClickNewCategoryBtn:function(d){Event.stop(d);var c=this.newCategoryTextId.value.trim();if(c.length>0){if(c.bytelength()>50){$alert("分类名不要超过25个汉字！");return}this.server.createCategory(c,function(){var a=createFavoriteCategoryResult;if(a&&a.value){this.createCategoryCallback(a.value)}else{$alert("添加分类失败，请稍候重试")}}.bind(this))}else{$alert("分类名不能为空！")}},createCategoryCallback:function(g){var e=g.id;var f=g.name;if(this.favoriteCategories!==null){this.favoriteCategories.push({Id:e,Name:f});var h=this.buildCategoryItem(e,f,this.favoriteCategories.Count);this.favoriteCategoryListRegion.insertBefore(h,this.newCategoryItemId);this.newCategoryTextId.value=""}},addToFavoriteCallback:function(){var b=addToFavorateResult;if(b&&b.value){this.favoriteDialog.hasFavorite=true;this.favoriteDialog.favoriteButtonText.innerHTML="已收藏";this.favoriteDialog.favoriteContainer.hide();this.favoriteDialog.favoriteButton.removeClassName("curr")}else{$alert("添加收藏失败，请稍候重试")}Event.stop()},onClickAddFavoriteBtn:function(f){var e=Event.findElement(f,this.htmlElement);var d=e.readAttribute("categoryId");this.server.addToFavorate(this.favoriteDialog.relatedObjType,this.favoriteDialog.relatedObjId,d,"",this.addToFavoriteCallback.bind(this));Event.stop(f)},load:function(){if(this.favoriteDialog.favoriteControlStyleType==FavoriteControlStyleType.FloatStyle){this.htmlElement="li"}else{if(this.favoriteDialog.favoriteControlStyleType==FavoriteControlStyleType.ListStyle){this.htmlElement="p";this.isFloatStyle=false}}},close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});var FavoriteButtonControl=Class.create();Object.extend(FavoriteButtonControl.prototype,{name:"FavoriteButtonControl",closed:false,relatedObjType:0,relatedObjId:0,hasFavorited:false,observer:null,favoriteButton:null,favoriteContainer:null,favoriteButtonText:null,favoriteCategoryControl:null,options:{isLogin:false,signInUrl:"",relatedObjId:0,relatedObjType:0,shareRelatedObjType:0,hasFavorited:false,favoriteButton:"",onFavoriteOKCallback:null,favoriteControlStyleType:FavoriteControlStyleType.FloatStyle,callback:null,expandMovieId:0},FavoriteTweet:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","FavoriteTweet",[f],d,"/Service/Twitter.msi","get","20000",e)},getFavoriteCategorys:function(h,g,f,e){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetFavoriteCategorys2",[h,g,f],e,"/community.api?Ajax_CallBack=true","post","20000")}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);if(this.signInUrl){this.signInUrl=this.signInUrl+"/operation/?redirectUrl="+encodeURIComponent(location.href)}else{this.signInUrl=siteMcUrl+"/member/signin/operation/?redirectUrl="+encodeURIComponent(location.href)}if(this.shareRelatedObjType!=="9992"&&this.shareRelatedObjType!=="6401"){this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load();this.render()}else{this.getFavoriteCategorys(this.relatedObjType,this.relatedObjId,true,function(){var a=getFavoriteCategorysResult;if(a&&a.value){if(!a.value.isLogin){if(typeof UserLoginDialog!="undefined"){var d=new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs(["/js/2014/UserLoginDialog.js"],function(){var c=new UserLoginDialog({callback:function(){location.reload()}})})}}else{this.isLogin=true;this.FavoriteTweet(this.relatedObjId,this.favoriteButton,function(f){if(f&&f.value){var c=[];if(this.favoriteControlStyleType==FavoriteControlStyleType.FloatStyle){c.push('<p><i class="ico_t_coll"></i><span>已收藏</span></p>')}else{if(this.favoriteControlStyleType==FavoriteControlStyleType.ListStyle){c.push('<p><i class="ico_t_coll"></i><span>已收藏</span></p>')}}this.favoriteContainer.innerHTML=c.join("");this.favoriteContainer.show();this.favoriteContainer.addClassName("onlycollect");this.favoriteButton.addClassName("curr");this.initializeEvent()}else{$alert("电影微评收藏失败")}}.bind(this))}}}.bind(this))}Event.observe(window,"unload",this.close.bind(this))},initializeField:function(){},initializeDOM:function(){var c=[];this.favoriteCategoryListRegionObj;this.selectedCategoryObj;this.categoryContrainer;this.categoryContrainerSelectedObj;var d=Builder.node("p",{},[Builder.node("i",{className:"ico_t_coll"}),Builder.node("span",{},["收 藏"])]);if(this.favoriteControlStyleType==FavoriteControlStyleType.FloatStyle){this.favoriteCategoryListRegionObj=Builder.node("ul",{});this.selectedCategoryObj=Builder.node("dt",{},[Builder.node("i",{className:"ico_t_collsec"}),Builder.node("span",{},["请选择分类"])]);this.categoryContrainerObj=Builder.node("dd",{},[this.favoriteCategoryListRegionObj]);this.categoryContrainerSelectedObj=Builder.node("dl",{},[this.selectedCategoryObj,this.categoryContrainerObj]);this.favoriteContainer.appendChild(d);this.favoriteContainer.appendChild(this.categoryContrainerSelectedObj)}else{if(this.favoriteControlStyleType==FavoriteControlStyleType.ListStyle){this.favoriteCategoryListRegionObj=Builder.node("div",{className:"hidbox"});this.selectedCategoryObj=Builder.node("strong",{},[Builder.node("i",{className:"ico_t_collsec"}),Builder.node("span",{},["请选择分类"])]);this.categoryContrainerObj=this.favoriteCategoryListRegionObj;this.categoryContrainerSelectedObj=Builder.node("div",{className:"showcoll"},[this.selectedCategoryObj,this.favoriteCategoryListRegionObj]);this.favoriteContainer.appendChild(d);this.favoriteContainer.appendChild(this.categoryContrainerSelectedObj)}else{throw"favoriteControlStyleType does not implemented!"}}this.favoriteButtonText=this.favoriteContainer.getElementsBySelector("p span")[0]},destroyDOM:function(){this.favoriteButton=null;this.favoriteButtonText=null;this.favoriteContainer=null;this.favoriteCategories=[];this.favoriteCategoryListRegion=null},initializeEvent:function(){this.onClickFavoriteButtonHandler=this.onClickFavoriteButton.bindAsEventListener(this);this.favoriteButton.observe("click",this.onClickFavoriteButtonHandler)},destroyEvent:function(){this.favoriteButton.stopObserving("click",this.onClickFavoriteButtonHandler)},initializeControl:function(){this.favoriteCategoryControl=new FavoriteCategoryControl(this)},destroyControl:function(){this.favoriteCategoryControl=null},load:function(){},render:function(){if(this.hasFavorited){this.favoriteButtonText.innerHTML="已收藏";if(!this.favoriteButton.hasClassName("curron")&&this.favoriteControlStyleType==FavoriteControlStyleType.FloatStyle){this.favoriteButton.addClassName("curron");this.favoriteButton.title="已收藏"}}else{this.favoriteButtonText.innerHTML="收 藏"}},onClick:function(f){var e=Event.findElement(f,"div");if(e&&e.readAttribute){var d=e.readAttribute("class");if(d=="addcollsec clearfix"){return}}if(this.favoriteButton){this.favoriteButton.removeClassName("curr")}if(this.favoriteContainer){this.favoriteContainer.hide()}},onClickFavoriteButton:function(f){var e=Event.findElement(f,"div");var g=e.hasClassName("curr");if(this.callback){this.callback(e)}if(!this.isLogin){if(typeof UserLoginDialog!="undefined"){var h=new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs(["/js/2014/UserLoginDialog.js"],function(){var a=new UserLoginDialog({callback:function(){location.reload()}})})}}else{if(g){e.removeClassName("curr");if(this.favoriteContainer){this.favoriteContainer.hide()}}else{if(e.hasClassName("notcurr")){e.removeClassName("notcurr")}e.addClassName("curr");if(this.categoryContrainerObj){this.categoryContrainerObj.hide();if(this.categoryContrainerSelectedObj){if(this.categoryContrainerSelectedObj.hasClassName("curr")){this.categoryContrainerSelectedObj.removeClassName("curr")}}}if(this.favoriteContainer){this.favoriteContainer.show()}}}Event.stop(f)},onFavoriteControlDialogOKCallback:function(b){this.hasFavorited=b.success;this.favoritedCount=b.favoritedCount;this.render();if(this.onFavoriteOKCallback){this.onFavoriteOKCallback(b)}},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var FavoriteButtonControlSCM=Class.create();Object.extend(FavoriteButtonControlSCM.prototype,{name:"FavoriteButtonControlSCM",closed:false,hasFavorited:false,observer:null,favoriteButton:null,options:{goodsId:0,isLogin:false,signInUrl:"",hasFavorited:false,favoriteButton:"",favoriteControlStyleType:FavoriteControlStyleType.SCMStyle,callback:null},hasIsLogin:function(f,e,d){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","HasIsLogin",[f,e],d,"/community.api?Ajax_CallBack=true","post","20000")}},addFavoritedSCM:function(d,c){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","AddFavoritedSCM",[d],c,"/community.api?Ajax_CallBack=true","post","20000")}},removeFavoritedSCM:function(d,c){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RemoveFavoritedSCM",[d],c,"/community.api?Ajax_CallBack=true","post","20000")}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},clickFavorite:function(){this.hasIsLogin(this.goodsId,true,function(){var c=getLoginAndFavoriteResult;if(c&&c.value){if(!c.value.isLogin){if(typeof UserLoginDialog!="undefined"){var d=new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs(["/js/2014/UserLoginDialog.js"],function(){var a=new UserLoginDialog({callback:function(){location.reload()}})})}}else{this.isLogin=true;if(typeof c.value.hasFavorited!="undefined"){if(c.value.hasFavorited){this.removeFavoritedSCM(this.goodsId,function(){if(removeFavoriteSCMResult&&removeFavoriteSCMResult.value&&typeof removeFavoriteSCMResult.value.success!="undefined"){if(removeFavoriteSCMResult.value.success){if(this.favoriteButton.hasClassName("on")){this.favoriteButton.removeClassName("on")}}else{$alert("取消收藏失败")}}else{$alert("取消收藏异常")}}.bind(this))}else{this.addFavoritedSCM(this.goodsId,function(){if(addFavoriteSCMResult&&addFavoriteSCMResult.value&&typeof addFavoriteSCMResult.value.success!="undefined"){if(addFavoriteSCMResult.value.success){if(!this.favoriteButton.hasClassName("on")){this.favoriteButton.addClassName("on")}}else{$alert("添加收藏失败")}}else{$alert("添加收藏异常")}}.bind(this))}}}}}.bind(this))},initialize:function(b){this.setOptions(b);if(this.signInUrl){this.signInUrl=this.signInUrl+"/operation/?redirectUrl="+encodeURIComponent(location.href)}else{this.signInUrl=siteMcUrl+"/member/signin/operation/?redirectUrl="+encodeURIComponent(location.href)}this.clickFavorite();Event.observe(window,"unload",this.close.bind(this))},initializeField:function(){},initializeDOM:function(){},destroyDOM:function(){this.favoriteButton=null},initializeEvent:function(){},destroyEvent:function(){},initializeControl:function(){},destroyControl:function(){},load:function(){},render:function(){},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var MtimeShareRelatedObjectTypes={Movie:1,Person:2,UserPhoto:5,Blog:6,Group:9,ForumTopic:10,MoviePicture:11,PersonPicture:21,Activity:22,Cinema:33,Video:41,List:50,CMSNews:51,CMSGalleryImage:52,Twitter:54,CMSSpecialTopic:59,GameVote:63,Link:64,GameQuiz:67,Festival:82,FestivalEvent:83,CommunityFeature:84,TopList:90,DETSeatOrder:85,MediaReview:336,SCMGoodsComment:9911};var ShareRelatedObjectTypes={MovieIsReleased:1001,MovieUpcoming:1002,MovieHasAwards:1003,MovieGeneral:1004,MovieContentPlot:1005,MovieRoleDescInfo:1006,MovieRoleDescAll:1007,MovieBehindCurtain:1008,MovieVerseLines:1009,MovieBehindTemplate:1010,MovieTelecinePage:1011,PersonFavorableComment:2001,News:5101,ImageNews:5102,MovieLongComment:9991,MovieShortComment:9992,MovieLeaveComment:9993,VideoMovie:4101,VideoPerson:4102,PictureMovie:11,PicturePerson:21,Cinema:33,IndexNewsTop:9981,Movie:1111,Blog:6001,ForumTopic:7001,Activity:2201,MediaReview:3361,Link:6401,OffsiteLink:64011,GoodsDetail:99991,NewsComment:51011,VideoMovieComment:41011,VideoPersonComment:41021,SCMGoodsDetail:99992};var ShareControlStyleType={FloatStyle:1,ListStyle:2,OnlyShare:3,OnlyShareSCM:4};var ShareTabType={shareToMtimeFriend:{name:"shareToMtimeFriend",text:"时光好友"},shareToEMail:{name:"shareToEMail",text:"邮件地址"},shareToWeb:{name:"shareToWeb",text:"其他网站"},showQrCode:{name:"showQrCode",text:"二维码"}};var GlobalUrlValue="";var ShareControlDialogBase=Class.create();Object.extend(ShareControlDialogBase.prototype,{name:"ShareControlDialogBase",title:"分享到我的时光",closed:false,dialog:null,tabContentRegion:null,options:{shareControl:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},initializeField:function(){},initializeDOM:function(){this.tabContentRegion},destroyDOM:function(){this.shareControl=this.dialog=this.tabHeaderRegion=this.tabContentRegion=null},initializeControl:function(){this.dialog=new Dialog({title:this.title,content:this.tabContentRegion,windowClassName:"w600",closeCallback:this.close.bind(this)})},destroyControl:function(){},initializeEvent:function(){},destroyEvent:function(){},load:function(){},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var ShareToMtimeFriendDialog=Class.create();Object.extend(ShareToMtimeFriendDialog.prototype,ShareControlDialogBase.prototype);Object.extend(ShareToMtimeFriendDialog.prototype,{defaultPrompt:"还可以输入210个字",reasonDefaultTxt:"分享理由",reasonMaxLength:210,dialogTemplate:new Template('<div class="sharemid"><span class="load48" style="display:none;" _type="loading"></span><div class="editshare"><span _type="digit_feedback">#{defaultPrompt}</span> <textarea _type="txtreason" class="curr">#{defaultText}</textarea></div><div class="#{middleShareClassName} clearfix" _type="addition_region">#{middleShareHtml}</div></div>'),closed:false,selectFirstImage:false,content:null,txtReason:null,shareButton:null,onClickShareButtonHandler:null,getShareInfoAdditionalInfo:function(f,e,d){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetShareInfoAdditionalInfo",[f,e],d,"/community.api?Ajax_CallBack=true","get","20000")}},getShortenUrl:function(d,c){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","ShortenUrl",[d],c,"/Service/Twitter.msi","get","20000")},loadEditorJs:function(b){if(typeof(Weibo)!="undefined"&&Weibo.Face&&Weibo.Image&&Weibo.Sync&&Weibo.Syntax&&Weibo.Topic&&Weibo.Video){b&&b()}else{if(self.debug){$loadJs(["/js/2011/weibo/editor/editor.js","/js/2011/weibo/editor/image.js","/js/2011/weibo/editor/face.js","/js/2011/weibo/editor/sync.js","/js/2011/weibo/editor/syntax.js","/js/2011/weibo/editor/video.js","/js/2011/weibo/editor/topic.js"],function(){b&&b()})}else{$loadJs("/js/2011/weiboEditor.js",function(){b&&b()})}}},load:function(){},initializeDOM:function(){ShareControlDialogBase.prototype.initializeDOM.apply(this);var b=this.shareControl.shareInfo;this.textAreaContent=this.reasonDefaultTxt;if(this.shareControl.shareMtimeContent){this.textAreaContent=this.shareControl.shareMtimeContent()}this.content=Builder.build(this.dialogTemplate.evaluate({defaultPrompt:this.defaultPrompt,defaultText:this.textAreaContent,middleShareClassName:this.shareControl.middleShareClassName,middleShareHtml:this.shareControl.getMiddleShareHtml()}));this.shareButton=$(Builder.node("a",{className:"sharelink"},["分 享"]));this.tabContentRegion=this.content},initializeControl:function(){ShareControlDialogBase.prototype.initializeControl.apply(this);if(this.dialog.buttonRegion){this.dialog.buttonRegion.appendChild(this.shareButton);this.dialog.buttonRegion.addClassName("btnshare")}this.txtReason=this.content.down('[_type="txtreason"]');this.editorTextbox=new Textbox({text:this.txtReason,watermarkText:"",focusClassName:"",blurClassName:""});this.editorTextbox.text.value=this.textAreaContent;var f=this;if(this.shareControl.relatedObjType===MtimeShareRelatedObjectTypes.CMSNews||this.shareControl.relatedObjType===MtimeShareRelatedObjectTypes.Cinema||this.shareControl.relatedObjType===MtimeShareRelatedObjectTypes.SCMGoodsComment){if(this.shareControl.getShareObjectPicUrl){this.shareImageUrl=this.shareControl.getShareObjectPicUrl()}}this.loadEditorJs(function(){f.editor=new Weibo.Editor({editor:f.txtReason});new Weibo.Feedback({editor:f.editor,digitFeedback:{target:f.content.down('[_type="digit_feedback"]'),normalTemplate:"还可以输入{2}个字",warnTemplate:'<font color="red">字数超出{3}字</font>'}})});var e=this.shareControl.shareInfo;var d=this.content.down('[_type="loading"]');if(e.needAdditionalInfo){d.show();this.getShareInfoAdditionalInfo(this.shareControl.relatedObjType,this.shareControl.getShareObjectId(),function(y){if(y&&y.value&&(y.value.picUrls||y.value.videoUrls||y.value.extPicUrls)){var v="",s="",C="";var u=['<ul class="infotab clearfix" _type="nav">'];var a=y.value;if((a.picUrls&&a.picUrls.length>0)||(y.value.extPicUrls&&y.value.extPicUrls.length>0)){if(a.extPicUrls&&a.extPicUrls.length>0){if(a.picUrls){a.picUrls=a.extPicUrls.concat(a.picUrls)}else{a.picUrls=y.value.extPicUrls}}u.push('<li _type="image" class="curr"><i class="i_share_pic">&nbsp;</i>选择一张图片<i class="i_share_select">&nbsp;</i></li>');var c=['<div class="infoslist" _type="images"><div class="infoscroll">'];if(a.picUrls.length>5){c.push('<a href="#" onclick="return false;" _type="turnleft" class="i_share_prev">&nbsp;</a><a href="#" class="i_share_next" _type="turnright" onclick="return false;">&nbsp;</a>')}c.push('<div _type="slidesregion" class="scrollmid">');a.picUrls.each(function(h,g){if(g%5==0){if(g/5!=0){c.push("</ul>");c.push('<ul style="display:none;">')}else{c.push("<ul>")}}c.push('<li _imageurl="'+h+'" name="tab"><img src="'+h+'" width="90" /></li>')});c.push("</ul></div></div></div>");s=c.join("")}if(a.videoUrls&&a.videoUrls.length>0){var B=[];if(u.length==1){u.push('<li _type="video" class="curr"><i class="i_share_play">&nbsp;</i>选择一个视频<i class="i_share_select">&nbsp;</i></li>');B=['<div class="infoslist" _type="videos"><div class="infoscroll">']}else{u.push('<li _type="video"><i class="i_share_play">&nbsp;</i>选择一个视频</li>');B=['<div class="infoslist" _type="videos" style="display:none"><div class="infoscroll">']}if(a.videoUrls.length>5){B.push('<a href="#" onclick="return false;" _type="turnleft" class="i_share_prev">&nbsp;</a><a href="#" class="i_share_next" _type="turnright" onclick="return false;">&nbsp;</a>')}B.push('<div _type="slidesregion" class="scrollmid">');a.videoCoverUrls.each(function(h,g){if(g%5==0){if(g/5!=0){B.push("</ul>");B.push('<ul style="display:none;">')}else{B.push("<ul>")}}B.push('<li _videourl="'+a.videoUrls[g].url+'" title="'+a.videoUrls[g].title+'" name="tab"><img src="'+h+'" width="90"></li>')});B.push("</ul></div></div></div>");C=B.join("")}u.push("</ul>");v=u.join("");var b=f.content.down('[_type="addition_region"]');v&&b.appendChild(Builder.build(v));s&&b.appendChild(Builder.build(s));C&&b.appendChild(Builder.build(C));f.navRegion=f.content.down('[_type="nav"]');if(f.navRegion.childElements().length<2){f.navRegion=null}f.imagesRegion=f.content.down('[_type="images"]');f.videosRegion=f.content.down('[_type="videos"]');if(f.selectFirstImage&&f.imagesRegion){var t=f.imagesRegion.down("li[_imageurl]");imgUrl=t.readAttribute("_imageurl");f.shareImageUrl=imgUrl;t.addClassName("curr");var z='<i class="i_sharecurr"></i>';t.appendChild(Builder.build(z))}if(f.navRegion){f.navControlHandler=f.navControl.bind(f);Event.observe(f.navRegion,"click",f.navControlHandler)}if(f.imagesRegion||f.videosRegion){f.selectImageOrVideoHandler=f.selectImageOrVideo.bind(f);f.imagesRegion&&Event.observe(f.imagesRegion,"click",f.selectImageOrVideoHandler);f.videosRegion&&Event.observe(f.videosRegion,"click",f.selectImageOrVideoHandler);f.videosRegion&&(f.videoCheckTimeout=setTimeout(f.videoCheck.bind(f),500));if(a.picUrls&&a.picUrls.length>5){var x=f.imagesRegion.down('[_type="turnleft"]');var w=f.imagesRegion.down('[_type="turnright"]');var A=f.imagesRegion.down('[_type="slidesregion"]');f.buildSlidesControl(A,w,x)}if(a.videoUrls&&a.videoUrls.length>5){var x=f.videosRegion.down('[_type="turnleft"]');var w=f.videosRegion.down('[_type="turnright"]');var A=f.videosRegion.down('[_type="slidesregion"]');f.buildSlidesControl(A,w,x)}}}d.hide()})}},buildSlidesControl:function(m,k,l){var g=m.childElements();if(g.length>1){var h=0;var j=g.length;Event.observe(k,"click",function(){$(g[h]).hide();if(h!=j-1){++h}else{h=0}$(g[h]).show()});Event.observe(l,"click",function(){$(g[h]).hide();if(h!=0){h=0}else{h=j-1}$(g[h]).show()})}},destroyDOM:function(){this.editor.destroy();ShareControlDialogBase.prototype.destroyDOM.apply(this);this.content=null;this.txtReason=null;this.shareButton=null;if(this.textAreaContent){this.textAreaContent=null}},initializeEvent:function(){ShareControlDialogBase.prototype.initializeEvent.apply(this);this.onClickShareButtonHandler=this.onClickShareButton.bindAsEventListener(this);Event.observe(this.shareButton,"click",this.onClickShareButtonHandler)},destroyEvent:function(){this.navRegion&&Event.stopObserving(this.navRegion,"click",this.navControlHandler);this.imagesRegion&&Event.stopObserving(this.imagesRegion,"click",this.selectImageOrVideoHandler);this.videosRegion&&Event.stopObserving(this.videosRegion,"click",this.selectImageOrVideoHandler);this.videoCheckTimeout&&clearTimeout(this.videoCheckTimeout);Event.stopObserving(this.shareButton,"click",this.onClickShareButtonHandler);ShareControlDialogBase.prototype.destroyEvent.apply(this)},navControl:function(m){var l=Event.findElement(m,"li");if(l!=document&&!l.hasClassName("curr")){var n=l.up();var o=l.getAttribute("_type");var h=n.down(".curr");var k=h.getAttribute("_type");var j=h.down(".i_share_select");j&&j.remove();h.removeClassName("curr");l.addClassName("curr");l.appendChild(Builder.build('<i class="i_share_select"></i>'));this.content.down('[_type="'+k+'s"]').hide();this.content.down('[_type="'+o+'s"]').show()}},videoCheck:function(){this.videoCheckTimeout&&clearTimeout(this.videoCheckTimeout);this.videoCheckTimeout=null;var d=this.editorTextbox.getValue();if(this.shareVideoUrl&&d.indexOf(this.shareVideoUrl)==-1){var c=this.videosRegion.down('li[shortenurl="'+this.shareVideoUrl+'"]');if(c){c.removeClassName("curr");this.shareVideoUrl=null}}this.videoCheckTimeout=setTimeout(this.videoCheck.bind(this),500)},selectImageOrVideo:function(n){var m=Event.findElement(n,"li");if(m!=document&&(m.hasAttribute("_imageurl")||m.hasAttribute("_videourl"))){if(m.hasClassName("curr")){if(m.hasAttribute("_imageurl")){this.shareImageUrl=null}else{var t=this.shareVideoUrl;if(t){var u=this.editorTextbox.getValue().replace(new RegExp(t,"ig"),"");this.editor.editor.value="";this.editor.insertText(u)}this.shareVideoUrl=null}var q=m.down(".i_sharecurr");q&&q.remove();m.removeClassName("curr")}else{if(m.hasAttribute("_imageurl")){this.shareImageUrl=m.getAttribute("_imageurl");var o=m.up('[_type="images"]').down(".curr");var p=o&&o.down(".i_sharecurr");o&&o.removeClassName("curr");p&&p.remove();m.addClassName("curr");m.appendChild(Builder.build('<i class="i_sharecurr"></i>'))}else{var t=this.shareVideoUrl;var u=this.editorTextbox.getValue().replace(new RegExp(t,"ig"),"");this.editor.editor.value="";this.editor.insertText(u);t=m.getAttribute("_videourl");var r=m.getAttribute("shortenurl");var s=this;var l=function(){s.editor.insertText(s.shareVideoUrl+" ");var a=m.up('[_type="videos"]').down(".curr");var b=a&&a.down(".i_sharecurr");a&&a.removeClassName("curr");b&&b.remove();m.addClassName("curr");m.appendChild(Builder.build('<i class="i_sharecurr"></i>'))};if(r){this.shareVideoUrl=r;l()}else{this.getShortenUrl(t,function(a){if(a&&a.value&&a.value.errorCode!=1){r=a.value.shortenUrl;m.setAttribute("shortenurl",r);s.shareVideoUrl=r;l()}})}}}}},saveShareCallback:function(c){if(c){var d=c.value;switch(d){case -2:$alert("您在时光网发布的内容违反互联网管理规定，对此帐户予禁言处理。",null,null,1);this.dialog.close();break;case -1:$alert("转发理由含有敏感词，请修改后再试",null,null,1);this.dialog.close();break;case 0:$alert("转发失败，请稍后再试",null,null,1);this.dialog.close();break;case 1:case 2:$alert("转发成功",null,null,1);if(this.shareControl.shareSuccessCallBack){this.shareControl.shareSuccessCallBack()}this.dialog.close();break;default:this.dialog.close();break}}},saveTweetShareCallback:function(d){var c=null;switch(d.value){case -5:c="原作者微评正在审核中，如有不便敬请谅解!";break;case -9:case -4:case -3:case -2:case 0:c="转发微评失败";break;case -1:c="转发微评失败,内容过长";break;case -11:c="转发微评失败,您被禁言";break;case -10:c="转发微评失败,内容包含敏感词";break;case -20:c="你发布的速度太快了，休息一下吧：）";break}if(c){$alert(c,null,null,1)}else{$alert("转发成功",null,null,1);if(this.shareControl.shareSuccessCallBack){this.shareControl.shareSuccessCallBack()}}this.dialog.close()},onClickShareButton:function(f){var j=this.txtReason.value.trim();var h=this.editor.getLength();if(h>this.editor.lengthExp.max){return}else{var g=this.shareImageUrl?this.shareImageUrl:"";var k="";this.shareControl.saveShare(j,this.saveShareCallback.bind(this),this.saveTweetShareCallback.bind(this),this.shareButton,g,k)}}});var ShareControlBase=Class.create();Object.extend(ShareControlBase.prototype,{name:"ShareControlBase",EXCERPT_SIZE:50,closed:false,MtimeShareRelatedObjectTypes:$H(MtimeShareRelatedObjectTypes),ShareRelatedObjectTypes:$H(ShareRelatedObjectTypes),avaliableTabs:[ShareTabType.shareToMtimeFriend,ShareTabType.shareToEMail,ShareTabType.shareToWeb,ShareTabType.showQrCode],relatedObjType:0,shareRelatedObjType:0,isAjaxData:true,shareButton:null,shareInfo:null,shareContainer:null,shareControlStyleType:ShareControlStyleType.FloatStyle,middleShareClassName:"boxshare",server:{saveShareInfo:function(l,k,j,g,h,m){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","SaveShareInfoCrossDomainByFlash",[l,k,j,h,m],g,"/community.api?Ajax_CallBack=true","post","20000")}},ForwardTweet:function(f,e,d){return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.TwitterService","ForwardTweetCrossDomainByFlash",f,e,"/Service/Twitter.msi","post","20000",d)},getIsLogin:function(b){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetIsLogin",[],b,"/community.api?Ajax_CallBack=true","get","20000")}},getShareInfo:function(l,k,j,h,g,m){if(siteCommunityServiceUrl){if(h===""){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetShareInfo",[l,k,j],g,"/community.api?Ajax_CallBack=true","get","20000",m)}else{return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetShareInfoExpand",[l,k,j,h],g,"/community.api?Ajax_CallBack=true","get","20000",m)}}}},ButtonInfoMap:$H({toWeixin:{name:"toWeixin",shareClassName:"weixin",text:"微信",type:ShareTabType.showQrCode,urlFormat:"javascript:ShowQrCode('');"},toSinaMicroblogging:{name:"toSinaMicroblogging",shareClassName:"sinaweibo",text:"新浪微博",type:ShareTabType.shareToWeb,urlFormat:"javascript:GlobalSiteShare('http://service.t.sina.com.cn/share/share.php?appkey=166678827&pic={2}&ralateUid=1663735900&url={0}&title={1}');"},toQQ:{name:"toQQ",shareClassName:"qq",text:"QQ",type:ShareTabType.shareToWeb,urlFormat:"javascript:GlobalSiteShare('http://connect.qq.com/widget/shareqq/index.html?url={0}&desc=&title={1}&summary=&pics={2}&flash=&site=http://www.mtime.com');"},toQzone:{name:"toQzone",shareClassName:"qzone",text:"QQ空间",type:ShareTabType.shareToWeb,urlFormat:"javascript:GlobalSiteShare('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={0}&desc={1}');"},toEMail:{name:"toEMail",shareClassName:"email",text:"电子邮件",type:ShareTabType.shareToEMail,urlFormat:"mailto:?subject={3}&body={4}"},toMtime:{name:"toMtime",shareClassName:"mytime",text:"我的时光",type:ShareTabType.shareToMtimeFriend}}),options:{desc:"",expandMovieId:0,shareContainer:null,shareButton:null,autoLoad:true,callback:null,shareSuccessCallBack:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},typeMapping:function(){if(this.isAjaxData){if(this.shareRelatedObjType==0){if(this.relatedObjType==0){throw"shareRelatedObjType not set and relatedObjType not set!"}switch(this.relatedObjType){case MtimeShareRelatedObjectTypes.Movie:this.shareRelatedObjType=ShareRelatedObjectTypes.MovieGeneral;break;case MtimeShareRelatedObjectTypes.Person:this.shareRelatedObjType=ShareRelatedObjectTypes.PersonNotFavorableComment;break;case MtimeShareRelatedObjectTypes.CMSNews:this.shareRelatedObjType=ShareRelatedObjectTypes.NewsGeneral;break;case MtimeShareRelatedObjectTypes.MoviePicture:this.shareRelatedObjType=ShareRelatedObjectTypes.PictureMovie;break;case MtimeShareRelatedObjectTypes.PersonPicture:this.shareRelatedObjType=ShareRelatedObjectTypes.PicturePerson;break;case MtimeShareRelatedObjectTypes.Cinema:this.shareRelatedObjType=ShareRelatedObjectTypes.Cinema;break;default:throw"relatedObjType not Mapping shareRelatedObjType!";break}}}},initialize:function(b){this.setOptions(b);this.initializeField();this.typeMapping();this.initializeDOM();this.initializeEvent();this.load();this.render();this.initializeControl();Event.observe(window,"unload",this.close.bind(this))},initializeField:function(){this.avaliableTabs=$A(this.avaliableTabs);this.collectBoxId=null},initializeDOM:function(){var g=this.ButtonInfoMap.values();var h=[];var k=siteCommunityServiceUrl+"/ShareHandler.ashx?shareRelatedObjType="+this.shareRelatedObjType+"&relatedId="+this.getShareObjectId()+"&expandId="+this.getShareExpandId()+"&expandContext="+decodeURIComponent(this.getShareExpandContext())+"&screenshotImageUrl="+this.getScreenshotImageUrl();if(this.shareButton&&this.shareContainer){this.shareContainer.hide();if(this.shareControlStyleType==ShareControlStyleType.FloatStyle){h.push('<ul class="clearfix">');for(var j=0;j<g.length;++j){var f=g[j];if(this.avaliableTabs.indexOf(f.type)<0){continue}if(f.name==="toMtime"){h.push('<li class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:void(0);">'+f.text+"</a></li>")}else{if(f.name==="toEMail"){h.push('<li class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:EmailIframe(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></li>")}else{if(f.name==="toWeixin"){h.push('<li class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:ShowQrCode(\''+this.link+"');\" >"+f.text+"</a></li>")}else{h.push('<li class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:GlobalSiteShare(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></li>")}}}}h.push("</ul>");this.shareContainer.innerHTML=h.join("")}else{if(this.shareControlStyleType==ShareControlStyleType.ListStyle){for(var j=0;j<g.length;++j){var f=g[j];if(this.avaliableTabs.indexOf(f.type)<0){continue}if(f.name==="toMtime"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:void(0);">'+f.text+"</a></p>")}else{if(f.name==="toEMail"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:EmailIframe(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></p>")}else{if(f.name==="toWeixin"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:ShowQrCode(\''+this.link+"');\" >"+f.text+"</a></p>")}else{h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:GlobalSiteShare(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></p>")}}}}this.shareContainer.innerHTML=h.join("")}else{throw"shareControlStyleType does not implemented!"}}}else{if(this.shareButton&&!this.shareContainer){if(this.shareControlStyleType==ShareControlStyleType.OnlyShare||this.shareControlStyleType==ShareControlStyleType.OnlyShareSCM){this.shareContainer=Builder.node("div",{className:"inner newsharebar"},[Builder.node("div",{className:"smtimebar"},[Builder.node("div",{className:"sharebox"})])]);for(var j=0;j<g.length;++j){var f=g[j];if(this.avaliableTabs.indexOf(f.type)<0){continue}if(f.name==="toMtime"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:void(0);">'+f.text+"</a></p>")}else{if(f.name==="toEMail"){h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:EmailIframe(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></p>")}else{h.push('<p class="'+f.shareClassName+'"><a method="'+f.name+'" href="javascript:GlobalSiteShare(\''+k+"&method="+f.name+"');\" >"+f.text+"</a></p>")}}}this.shareContainer.getElementsBySelector("div.sharebox")[0].innerHTML=h.join("")}}}},destroyDOM:function(){if(this.shareButton){this.shareButton=null}if(this.shareContainer){this.shareContainer=null}if(this.collectBoxId){this.collectBoxId=null}if(this.windowOpen){this.windowOpen=null}},initializeEvent:function(){if(!this.autoLoad){this.onClickShareButtonHandler=this.onClickShareButton.bindAsEventListener(this);if(this.shareButton){this.shareButton.observe("click",this.onClickShareButtonHandler)}}this.onClickshareContainerHandler=this.onClickshareContainer.bindAsEventListener(this);if(this.shareContainer){this.shareContainer.observe("click",this.onClickshareContainerHandler)}},destroyEvent:function(){if(this.shareButton){this.shareButton.stopObserving("click",this.onClickShareButtonHandler)}if(this.shareContainer){this.shareContainer.stopObserving("click",this.onClickshareContainerHandler)}},initializeControl:function(){if(this.shareControlStyleType==ShareControlStyleType.OnlyShare||this.shareControlStyleType==ShareControlStyleType.OnlyShareSCM){var d=this;var c=this.shareControlStyleType==ShareControlStyleType.OnlyShareSCM;this.collectBox=new DialogBox({element:this.shareButton,content:this.shareContainer.outerHTML,arrowNew:true,onClick:function(b){var g=Event.pointerX(b);var h=Event.pointerY(b);var a=Event.element(b);if(a!=this.element&&!a.descendantOf(this.element)&&!a.descendantOf(this.windowElement)&&!Position.within(this.windowElement,g,h)){this.close();d.close()}},setupDimensions:function(){if(c){this.windowElement.addClassName("my_shop")}var y=0,A=0;var C=this.windowElement.getDimensions();var D=C.width;var B=C.height;var w=this.elementX+this.elementWidth/2;var x=this.elementY;var t=w;var u=x+this.elementHeight;if(this.arrowNew){var b=this.cardId.down("em."+this.indicationStyle)}else{var b=this.cardId.down("p."+this.indicationStyle)}var a;if(b===undefined||b===null){a=17}else{a=b.getHeight()}switch(this.positionType){case 0:y=t-47;A=u+a;break;case 1:y=t-(D-47);A=u+a;break;case 2:y=w-47;A=x-a-B;break;case 3:y=w-(D-47);A=x-a-B;break;default:y=t-47;A=u+a;break}var E=0;if(this.overlay){E=parseInt(this.overlay.getStyle("zIndex"),10)+1}else{E=Windows.getZIndex()+1}if(Mtime.browser.ie&&Mtime.browser.ie>=7){var s=this.element.getHeight();var v=this.element.getStyle("fontSize");var z=parseInt(v.slice(0,2),10);if(this.element.innerHTML!==""&&s>z+10){y=200}}this.windowElement.setStyle({position:"absolute",top:A+"px",left:y+"px",zIndex:E})}});this.collectBoxId=$(this.collectBox.id);if(this.collectBoxId){this.collectBoxId.observe("click",this.onClickshareContainerHandler)}}},destroyControl:function(){if(this.shareControlStyleType==ShareControlStyleType.OnlyShare||this.shareControlStyleType==ShareControlStyleType.OnlyShareSCM){if(this.collectBox){this.collectBox.close();this.collectBox=null}}},load:function(){if(this.autoLoad&&this.isAjaxData){this.server.getShareInfo(this.shareRelatedObjType,this.getShareObjectId(),this.getShareExpandId(),this.getShareExpandContext(),this.getShareInfoCallback.bind(this),this.shareContainer)}},render:function(){},renderWebShareLinks:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))},shareInfoLoaded:function(){},getShareInfoCallback:function(b){if(typeof getShareInfoResult!="undefined"&&getShareInfoResult.value){this.shareInfo=getShareInfoResult.value;this.shareInfoLoaded();this.renderWebShareLinks();if(this.autoLoad){this.onClickShareButtonHandler=this.onClickShareButton.bindAsEventListener(this);if(this.shareButton){this.shareButton.observe("click",this.onClickShareButtonHandler)}}this.showShareDialog(b)}else{$alert("加载对象信息出错，请刷新页面重试")}},onClickShareButton:function(d){var c=Event.findElement(d,"div");this.callback&&this.callback(c);if(c.hasClassName("curr")){c.removeClassName("curr");if(this.shareContainer){this.shareContainer.hide()}}else{if(c.hasClassName("notcurr")){c.removeClassName("notcurr")}c.addClassName("curr");if(this.shareContainer){this.shareContainer.show()}}Event.stop(d)},onClickshareContainer:function(C){var B=Event.findElement(C,"a");if(!B||!B.readAttribute){return}var J=B.readAttribute("method");if(!J){return}if(this.shareRelatedObjType===ShareRelatedObjectTypes.MovieBehindTemplate){var I=this.shareContainer.up().up().up().down("ul").getElementsBySelector("li");if(typeof I!="undefined"&&I!=null&&I.length>0){var A=I[0];var G=A.readAttribute("title");var F=A.readAttribute("imgabstract");var H=A.down("img").readAttribute("src");this.title=G;this.pic=H;this.desc=F;var O=this.getShareObjectUrl();var N=this.getShareObjectTitle();var K="";var M=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var v=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){K=this.getShareObjectPicUrl()}var w=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,O,N,K)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,O,N,K,M,v)}}.bind(this))}}else{if(this.shareRelatedObjType===ShareRelatedObjectTypes.ImageNews){if(this.imageId!=this.expandMovieId){this.shareInfo=null;this.expandMovieId=this.imageId;var y=this.ButtonInfoMap.values();var D=[];var L=siteCommunityServiceUrl+"/ShareHandler.ashx?shareRelatedObjType="+this.shareRelatedObjType+"&relatedId="+this.getShareObjectId()+"&expandId="+this.getShareExpandId()+"&screenshotImageUrl="+this.getScreenshotImageUrl();var z=L+"&method="+J;if(this.shareButton&&this.shareContainer){if(this.shareControlStyleType==ShareControlStyleType.FloatStyle){D.push('<ul class="clearfix">');for(var E=0;E<y.length;++E){var x=y[E];if(this.avaliableTabs.indexOf(x.type)<0){continue}if(x.name==="toMtime"){D.push('<li class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:void(0);">'+x.text+"</a></li>")}else{if(x.name==="toEMail"){D.push('<li class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:EmailIframe(\''+L+"&method="+x.name+"');\" >"+x.text+"</a></li>")}else{D.push('<li class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:GlobalSiteShare(\''+L+"&method="+x.name+"');\" >"+x.text+"</a></li>")}}}D.push("</ul>");this.shareContainer.innerHTML=D.join("")}else{if(this.shareControlStyleType==ShareControlStyleType.ListStyle){for(var E=0;E<y.length;++E){var x=y[E];if(this.avaliableTabs.indexOf(x.type)<0){continue}if(x.name==="toMtime"){D.push('<p class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:void(0);">'+x.text+"</a></p>")}else{if(x.name==="toEMail"){D.push('<p class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:EmailIframe(\''+L+"&method="+x.name+"');\" >"+x.text+"</a></p>")}else{D.push('<p class="'+x.shareClassName+'"><a method="'+x.name+'" href="javascript:GlobalSiteShare(\''+L+"&method="+x.name+"');\" >"+x.text+"</a></p>")}}}this.shareContainer.innerHTML=D.join("")}}}GlobalUrlValue=z}}}if(this.shareInfo===null&&this.isAjaxData){this.server.getShareInfo(this.shareRelatedObjType,this.getShareObjectId(),this.getShareExpandId(),this.getShareExpandContext(),this.getShareInfoCallback.bind(this,J),this.shareContainer)}else{this.showShareDialog(J,C)}},shareTrack:function(d){var f=null;if(this.shareRelatedObjType!=0){this.ShareRelatedObjectTypes.find(function(a){if(a.value===this.relatedObjType){f=a.key}return false}.bind(this))}else{this.MtimeShareRelatedObjectTypes.find(function(a){if(a.value===this.relatedObjType){f=a.key}return false}.bind(this))}if(!f){return}var e=String.format("M11_Common_Share{0}_{1}",f,d);if(typeof tracker!=="undefined"&&typeof tracker.trackAdView!=="undefined"){tracker.trackClick("M11_Common",e)}},showShareDialog:function(e,f){var d=this.ButtonInfoMap[e];if(!d){return}if(d.type==ShareTabType.shareToWeb||d.type==ShareTabType.shareToEMail){if(!f){}if(this.shareSuccessCallBack){this.shareSuccessCallBack()}this.shareTrack(e)}else{if(d.type==ShareTabType.showQrCode){if(this.shareSuccessCallBack){this.shareSuccessCallBack()}this.shareTrack(e)}else{if(f){Event.stop(f)}if(!this.shareInfo||typeof(this.shareInfo.isLogin)=="undefined"||this.shareInfo.isLogin==null){this.server.getIsLogin(function(){if(typeof(getIsLogin)!="undefined"&&getIsLogin.value){if(!getIsLogin.value.isLogin){$redirect(this.getSignInUrl());return}switch(d.type){case ShareTabType.shareToMtimeFriend:this.showShareToMtimeFriendDialog();if(this.shareButton){if(this.shareButton.hasClassName("curr")){this.shareButton.removeClassName("curr");if(this.shareContainer){this.shareContainer.hide()}}}break;default:throw"ButtonType does not implemented"}}}.bind(this))}else{if(!this.shareInfo.isLogin){$redirect(this.getSignInUrl());return}switch(d.type){case ShareTabType.shareToMtimeFriend:this.showShareToMtimeFriendDialog();if(this.shareButton){if(this.shareButton.hasClassName("curr")){this.shareButton.removeClassName("curr");if(this.shareContainer){this.shareContainer.hide()}}}break;default:throw"ButtonType does not implemented"}}}}},showShareToMtimeFriendDialog:function(){new ShareToMtimeFriendDialog({shareControl:this})},getSignInUrl:function(){return siteMcUrl+"/member/signin/operation/?redirectUrl="+encodeURIComponent(location.href)},getShareObjectUrl:function(){return""},getShareObjectPicUrl:function(){return""},getShareObjectMailTitle:function(){return""},getShareObjectTitle:function(){return""},getShareObjectId:function(){return 0},getShareExpandId:function(){return 0},getShareExpandContext:function(){return""},getScreenshotImageUrl:function(){return""},getShareObjectDefaultRecommendContent:function(f){var e="分享一篇文章-"+this.getShareObjectTitle();var d="你好，这篇文章写的不错，我想你可能会感兴趣，推荐你去看看！《"+this.getShareObjectTitle()+"》"+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}},getShareObjectDefaultRecommendSuffix:function(){return""},getMiddleShareHtml:function(){return""},saveShareInternal:function(k,h,n,l,j,o){if(this.shareRelatedObjType==ShareRelatedObjectTypes.MovieShortComment||this.shareRelatedObjType==ShareRelatedObjectTypes.MovieLeaveComment){this.server.ForwardTweet([k,this.getShareObjectId(),false,false],n,l)}else{var m=this.getShareObjectId();if(this.shareRelatedObjType===ShareRelatedObjectTypes.MovieContentPlot||this.shareRelatedObjType===ShareRelatedObjectTypes.MovieRoleDescInfo||this.shareRelatedObjType===ShareRelatedObjectTypes.MovieBehindCurtain||this.shareRelatedObjType===ShareRelatedObjectTypes.MovieVerseLines||this.shareRelatedObjType===ShareRelatedObjectTypes.MovieBehindTemplate||this.shareRelatedObjType===ShareRelatedObjectTypes.MediaReview){m=this.expandMovieId}this.server.saveShareInfo(this.relatedObjType,m,k,h,j,o)}},onSaveShareCallback:function(c,d){if(d){c(d)}},onTweetSaveShareCallback:function(c,d){if(d){c(d)}},saveShare:function(j,g,l,k,h,m){this.saveShareInternal(j,this.onSaveShareCallback.bind(this,g),this.onTweetSaveShareCallback.bind(this,l),k,h,m)},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var ShareMovieControl=Class.create();Object.extend(ShareMovieControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieControl.prototype,{name:"ShareMovieControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.Movie,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieIsReleasedControl=Class.create();Object.extend(ShareMovieIsReleasedControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieIsReleasedControl.prototype,{name:"ShareMovieIsReleasedControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieIsReleased,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieUpcomingControl=Class.create();Object.extend(ShareMovieUpcomingControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieUpcomingControl.prototype,{name:"ShareMovieUpcomingControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieUpcoming,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieHasAwardsControl=Class.create();Object.extend(ShareMovieHasAwardsControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieHasAwardsControl.prototype,{name:"ShareMovieHasAwardsControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieHasAwards,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieGeneralControl=Class.create();Object.extend(ShareMovieGeneralControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieGeneralControl.prototype,{name:"ShareMovieGeneralControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieGeneral,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return"分享电影"},getShareObjectUrl:function(){return this.shareInfo.movieLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享一部电影《"+this.getShareObjectMailTitle()+"》";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieContentPlotControl=Class.create();Object.extend(ShareMovieContentPlotControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieContentPlotControl.prototype,{name:"ShareMovieContentPlotControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieContentPlot,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieParagraphId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.movieParagraphLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieParagraphId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》剧情";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieRoleDescInfoControl=Class.create();Object.extend(ShareMovieRoleDescInfoControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieRoleDescInfoControl.prototype,{name:"ShareMovieRoleDescInfoControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieRoleDescInfo,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieRoleId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.movieRoleLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieRoleId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》角色介绍";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieRoleDescAllControl=Class.create();Object.extend(ShareMovieRoleDescAllControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieRoleDescAllControl.prototype,{name:"ShareMovieRoleDescAllControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieRoleDescAll,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{movieId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.movieRoleLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》角色介绍";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieBehindCurtainControl=Class.create();Object.extend(ShareMovieBehindCurtainControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieBehindCurtainControl.prototype,{name:"ShareMovieBehindCurtainControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieBehindCurtain,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{behindSectionID:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.behindSectionLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.behindSectionID},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.getScreenshotImageUrl()},getScreenshotImageUrl:function(){if(this.shareInfo){return this.shareInfo.screenshotImageUrl}else{return""}},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》幕后看点";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieVerseLinesControl=Class.create();Object.extend(ShareMovieVerseLinesControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieVerseLinesControl.prototype,{name:"ShareMovieVerseLinesControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieVerseLines,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{behindSectionID:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.behindSectionLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.behindSectionID},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.getScreenshotImageUrl()},getScreenshotImageUrl:function(){if(this.shareInfo){return this.shareInfo.screenshotImageUrl}else{return""}},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》台词金句";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieBehindTemplateControl=Class.create();Object.extend(ShareMovieBehindTemplateControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieBehindTemplateControl.prototype,{name:"ShareMovieBehindTemplateControl",relatedObjType:MtimeShareRelatedObjectTypes.Movie,shareRelatedObjType:ShareRelatedObjectTypes.MovieBehindTemplate,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",link:"",pic:"",desc:"",movieId:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),render:function(){this.server.getShareInfo(this.shareRelatedObjType,this.getShareObjectId(),this.getShareExpandId(),this.getShareExpandContext(),function(){if(typeof getShareInfoResult!="undefined"&&getShareInfoResult.value){this.shareInfo=getShareInfoResult.value}else{$alert("加载对象信息出错，请刷新页面重试")}var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}.bind(this),this.shareContainer)},getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.title+" "+this.desc+this.link},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return"《"+this.shareInfo.movieName+"》-"+this.title+" "+this.desc+this.link},getShareObjectId:function(){return this.movieId},getShareExpandId:function(){return this.movieId},getShareObjectMailTitle:function(){return this.shareInfo.movieName},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》幕后";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieTelecinePageControl=Class.create();Object.extend(ShareMovieTelecinePageControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieTelecinePageControl.prototype,{name:"ShareMovieTelecinePageControl",relatedObjType:MtimeShareRelatedObjectTypes.Link,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{date:new Date(),movieTitle:"",cityName:"",imageUrl:"",link:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),load:function(){this.getImagePath(null);ShareControlBase.prototype.load.apply(this)},getImagePath:function(b){if(!this.imageUrl){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","UploadPicByUrl",[this.link],function(a){if(a&&a.value&&a.value.ImagePath){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetThumbnailImageUrlByImagePath",[a.value.ImagePath],function(d){if(d&&d.value&&d.value.ImageUrl){this.imageUrl=a.value.ImagePath;this.link=d.value.ImageUrl;b&&b()}}.bind(this),"/Service/Twitter.msi","get","20000")}}.bind(this),"/Service/Twitter.msi","get","20000")}else{b&&b()}},getMiddleShareHtml:function(){var d=[];var c=this.date+" "+this.cityName+" 最新影讯";d.push('<div class="picmid"><a title="'+this.movieTitle+'" target="_blank" href="'+this.link+'"><img alt="'+this.movieTitle+'" src="'+this.imageUrl+'" /></a></div>');d.push('<div class="txtmid"><h2><a target="_blank" href="'+this.link+'">'+this.movieTitle+"</a></h2><p>"+c+"</p></div>");return d.join("")},shareMtimeContent:function(){return"《"+this.movieTitle+"》 "+this.date+" "+this.cityName+" 最新影讯 "+this.link},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return"《"+this.movieTitle+"》 "+this.date+" "+this.cityName+" 最新影讯地址："+this.link},getShareObjectPicUrl:function(){return this.imageUrl},getShareObjectMailTitle:function(){return"《"+this.movieTitle+"》 "+this.date+" "+this.cityName+" 影讯"},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.title,this.link,e,this.desc,d)},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl();j=j.replace(new RegExp("&","ig"),"^PIC^")}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var SharePersonFavorableCommentControl=Class.create();Object.extend(SharePersonFavorableCommentControl.prototype,ShareControlBase.prototype);Object.extend(SharePersonFavorableCommentControl.prototype,{name:"SharePersonFavorableCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Person,shareRelatedObjType:ShareRelatedObjectTypes.PersonFavorableComment,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{personId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.personName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.personName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.personName+"</a></h2><h3>"+this.shareInfo.personNameEn+"</h3><ul><li>"+this.shareInfo.personSex+"，"+this.shareInfo.personConstellation+"</li><li>职业："+this.shareInfo.personProfessions+"</li></ul></div>");return b.join("")},shareMtimeContent:function(){return"分享影人"},getShareObjectUrl:function(){return this.shareInfo.personLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.personId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e='关于"'+this.getShareObjectMailTitle()+'"';var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareNewsControl=Class.create();Object.extend(ShareNewsControl.prototype,ShareControlBase.prototype);Object.extend(ShareNewsControl.prototype,{name:"ShareNewsControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSNews,shareRelatedObjType:ShareRelatedObjectTypes.News,isPicNews:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{newsId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享新闻"},getShareObjectUrl:function(){return this.shareInfo.newsLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.newsId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="电影新闻分享："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareImageNewsControl=Class.create();Object.extend(ShareImageNewsControl.prototype,ShareControlBase.prototype);Object.extend(ShareImageNewsControl.prototype,{name:"ShareImageNewsControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSGalleryImage,shareRelatedObjType:ShareRelatedObjectTypes.ImageNews,isPicNews:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.isPicNews=true},initializeField:function(){ShareControlBase.prototype.initializeField.apply(this);this.expandMovieId=this.imageId},getMiddleShareHtml:function(){var d=[];var e=this.shareInfo.imageNewTitle;var f=this.shareInfo.imageTitle;d.push('<div class="picmid"><a title="'+e+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+e+'" src="'+this.getShareObjectPicUrl()+'" /></a></div>');d.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+e+"</a></h2><p>"+f+"</p></div>");return d.join("")},shareMtimeContent:function(){return"分享新闻"},getShareObjectUrl:function(){return this.shareInfo.newsLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="电影新闻分享："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieLongCommentControl=Class.create();Object.extend(ShareMovieLongCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieLongCommentControl.prototype,{name:"ShareMovieLongCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Blog,shareRelatedObjType:ShareRelatedObjectTypes.MovieLongComment,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{blogId:0,urlTypeId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享影评"},getShareObjectUrl:function(){return this.shareInfo.blogLink},getShareObjectTitle:function(){this.shareInfo.title=this.shareInfo.title.replace(/\"/g,"＂");return this.shareInfo.title},getShareObjectId:function(){return this.blogId},getShareExpandId:function(){return this.urlTypeId},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="[影评分享]"+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieShortCommentControl=Class.create();Object.extend(ShareMovieShortCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieShortCommentControl.prototype,{name:"ShareMovieShortCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Twitter,shareRelatedObjType:ShareRelatedObjectTypes.MovieShortComment,middleShareClassName:"",options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{tweetId:0}),shareMtimeContent:function(){return"分享微评"},getShareObjectUrl:function(){return this.shareInfo.tweetLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.tweetId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="关于《"+this.getShareObjectMailTitle()+"》的短评";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMovieLeaveCommentControl=Class.create();Object.extend(ShareMovieLeaveCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareMovieLeaveCommentControl.prototype,{name:"ShareMovieLeaveCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Twitter,shareRelatedObjType:ShareRelatedObjectTypes.MovieLeaveComment,middleShareClassName:"",options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{tweetId:0}),shareMtimeContent:function(){return"分享微评"},getShareObjectUrl:function(){return this.shareInfo.tweetLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.tweetId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e='关于"'+this.getShareObjectMailTitle()+'"';var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareVideoMovieControl=Class.create();Object.extend(ShareVideoMovieControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoMovieControl.prototype,{name:"ShareVideoMovieControl",relatedObjType:MtimeShareRelatedObjectTypes.Video,shareRelatedObjType:ShareRelatedObjectTypes.VideoMovie,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.videoTitleName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.videoTitleName+'" src="'+this.shareInfo.specificVideoUrl+'" /><i class="i_share_video">&nbsp;</i><i class="i_share_mask">&nbsp;</i></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.videoTitleName+"</a></h2><p>"+this.shareInfo.videoName+"</p></div>");return b.join("")},shareMtimeContent:function(){return"分享视频"},getShareObjectUrl:function(){return this.shareInfo.videoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.videoId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享视频："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareVideoPersonControl=Class.create();Object.extend(ShareVideoPersonControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoPersonControl.prototype,{name:"ShareVideoPersonControl",relatedObjType:MtimeShareRelatedObjectTypes.Video,shareRelatedObjType:ShareRelatedObjectTypes.VideoPerson,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0,personId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.videoTitleName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.videoTitleName+'" src="'+this.shareInfo.specificVideoUrl+'" /><i class="i_share_video">&nbsp;</i><i class="i_share_mask">&nbsp;</i></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.videoTitleName+"</a></h2><p>"+this.shareInfo.videoName+"</p></div>");return b.join("")},shareMtimeContent:function(){return"分享视频"},getShareObjectUrl:function(){return this.shareInfo.videoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.videoId},getShareExpandId:function(){return this.personId},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享视频："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var SharePictureMovieControl=Class.create();Object.extend(SharePictureMovieControl.prototype,ShareControlBase.prototype);Object.extend(SharePictureMovieControl.prototype,{name:"SharePictureMovieControl",relatedObjType:MtimeShareRelatedObjectTypes.MoviePicture,shareRelatedObjType:ShareRelatedObjectTypes.PictureMovie,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.specificImageUrl+'" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.movieName+"</a></h2><p>"+this.shareInfo.specificImageTypeName+"</p></div>");return b.join("")},shareMtimeContent:function(){return"分享图片"},getShareObjectUrl:function(){return this.shareInfo.imageLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享图片："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var SharePicturePersonControl=Class.create();Object.extend(SharePicturePersonControl.prototype,ShareControlBase.prototype);Object.extend(SharePicturePersonControl.prototype,{name:"SharePicturePersonControl",relatedObjType:MtimeShareRelatedObjectTypes.PersonPicture,shareRelatedObjType:ShareRelatedObjectTypes.PicturePerson,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{imageId:0}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.personName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.personName+'" src="'+this.shareInfo.specificImageUrl+'" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.personName+"</a></h2><p>"+this.shareInfo.specificImageTypeName+"</p></div>");return b.join("")},shareMtimeContent:function(){return"分享图片"},getShareObjectUrl:function(){return this.shareInfo.imageLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.imageId},getShareExpandId:function(){return this.personId},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享图片："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareCinemaControl=Class.create();Object.extend(ShareCinemaControl.prototype,ShareControlBase.prototype);Object.extend(ShareCinemaControl.prototype,{name:"ShareCinemaControl",relatedObjType:MtimeShareRelatedObjectTypes.Cinema,shareRelatedObjType:ShareRelatedObjectTypes.Cinema,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{cinemaId:0,date:new Date()}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.cinemaName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.cinemaName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.cinemaName+"</a></h2><p>"+this.shareInfo.description+"</p></div>");return b.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareExpandContext:function(){return encodeURIComponent(this.getDatetime())},getShareObjectUrl:function(){return this.shareInfo.cinemaLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.cinemaId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getDatetime:function(){var m=this.date.getFullYear();var k=this.date.getMonth()+1;var h=this.date.getDate();var l=k.toString();if(k<10){l="0"+l}var j=h.toString();if(h<10){j="0"+j}var g=m+"年"+l+"月"+h+"日";return g},renderWebShareLinks:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl().replace(/\&/g,"^PIC^")}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))},getShareObjectDefaultRecommendContent:function(h){var f=this.getDatetime();var g='"'+this.getShareObjectMailTitle()+'"'+f+"影讯";var e=this.getShareObjectTitle();if(h==="subject"){return g}else{return e}}});var ShareUniversalControl=Class.create();Object.extend(ShareUniversalControl.prototype,ShareControlBase.prototype);Object.extend(ShareUniversalControl.prototype,{name:"ShareUniversalControl",relatedObjType:51,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",fullTitle:"",link:"",pic:"",desc:"",newsId:0,shareInfo:{isLogin:null,needAdditionalInfo:false}}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.title+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.title+'" src="'+this.getShareObjectPicUrl()+'" style="width:96px;height:96px" /></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.title+"</a></h2></div>");return b.join("")},shareMtimeContent:function(){return this.title+this.link},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.fullTitle+this.link},getShareObjectMailTitle:function(){return this.title},getShareObjectId:function(){return this.newsId},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareBlogControl=Class.create();Object.extend(ShareBlogControl.prototype,ShareControlBase.prototype);Object.extend(ShareBlogControl.prototype,{name:"ShareBlogControl",relatedObjType:MtimeShareRelatedObjectTypes.Blog,shareRelatedObjType:ShareRelatedObjectTypes.Blog,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{blogId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享文章"},getShareObjectUrl:function(){return this.shareInfo.blogLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.blogId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="[分享文章]"+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareForumTopicControl=Class.create();Object.extend(ShareForumTopicControl.prototype,ShareControlBase.prototype);Object.extend(ShareForumTopicControl.prototype,{name:"ShareForumTopicControl",relatedObjType:MtimeShareRelatedObjectTypes.ForumTopic,shareRelatedObjType:ShareRelatedObjectTypes.ForumTopic,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{topicId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享文章"},getShareObjectUrl:function(){return this.shareInfo.topicLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.topicId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="[分享文章]"+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareActivityControl=Class.create();Object.extend(ShareActivityControl.prototype,ShareControlBase.prototype);Object.extend(ShareActivityControl.prototype,{name:"ShareActivityControl",relatedObjType:MtimeShareRelatedObjectTypes.Activity,shareRelatedObjType:ShareRelatedObjectTypes.Activity,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{activityId:0}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.shareInfo.description;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return"分享活动"},getShareObjectUrl:function(){return this.shareInfo.activityLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.activityId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="[分享活动]"+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareMediaReviewControl=Class.create();Object.extend(ShareMediaReviewControl.prototype,ShareControlBase.prototype);Object.extend(ShareMediaReviewControl.prototype,{name:"ShareMediaReviewControl",relatedObjType:MtimeShareRelatedObjectTypes.MediaReview,shareRelatedObjType:ShareRelatedObjectTypes.MediaReview,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{mediaReviewId:0}),getMiddleShareHtml:function(){var c=[];var d="";if(this.shareInfo.movieLength!==""){d=this.shareInfo.movieLength+"分钟 - "}c.push('<div class="picmid"><a title="'+this.shareInfo.movieName+'" target="_blank" href="'+this.shareInfo.coverLinkUrl+'"><img alt="'+this.shareInfo.movieName+'" src="'+this.shareInfo.coverImageUrl+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.shareInfo.coverLinkUrl+'">'+this.shareInfo.movieName+" ("+this.shareInfo.movieYear+")</a></h2><h3>"+this.shareInfo.movieNameEn+"</h3><ul><li>"+d+this.shareInfo.movieTypes+"</li><li>导演："+this.shareInfo.movieDirectors+"</li><li>主演："+this.shareInfo.movieActors+"</li></ul></div>");return c.join("")},shareMtimeContent:function(){return this.shareInfo.shareReason},getShareObjectUrl:function(){return this.shareInfo.mediaReviewLink},getShareObjectTitle:function(){this.shareInfo.title=this.shareInfo.title.replace(/\"/g,"＂");return this.shareInfo.title},getShareObjectId:function(){return this.mediaReviewId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectPicUrl:function(){return this.shareInfo.pic},getShareObjectDefaultRecommendContent:function(f){var e="分享《"+this.getShareObjectMailTitle()+"》媒体影评";var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareLinkControl=Class.create();Object.extend(ShareLinkControl.prototype,ShareControlBase.prototype);Object.extend(ShareLinkControl.prototype,{name:"ShareLinkControl",relatedObjType:MtimeShareRelatedObjectTypes.Link,isAjaxData:false,middleShareClassName:"",options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",link:"",pic:"",desc:"",mtimeDefaultContent:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),shareMtimeContent:function(){return this.mtimeDefaultContent},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.title+this.link},getShareObjectMailTitle:function(){return this.title},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.title,this.link,e,this.desc,d)},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareOffsiteLinkControl=Class.create();Object.extend(ShareOffsiteLinkControl.prototype,ShareControlBase.prototype);Object.extend(ShareOffsiteLinkControl.prototype,{name:"ShareOffsiteLinkControl",relatedObjType:MtimeShareRelatedObjectTypes.OffsiteLink,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",link:"",pic:"",desc:"",mtimeDefaultContent:""}),shareMtimeContent:function(){return this.mtimeDefaultContent},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.title+this.link},getShareObjectMailTitle:function(){return this.title},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},initializeDOM:function(){var f=this.ButtonInfoMap.values();var g=[];if(this.shareContainer){for(var h=0;h<f.length;++h){var e=f[h];if(this.avaliableTabs.indexOf(e.type)<0){continue}if(e.name==="toMtime"||e.name==="toQzone"){}else{if(e.name==="toEMail"){g.push('<a class="'+e.shareClassName+'" method="'+e.name+'" href="###" >'+e.text+"</a>")}else{g.push('<a class="'+e.shareClassName+'" method="'+e.name+'" href="###" target="_self" >'+e.text+"</a>")}}}this.shareContainer.innerHTML=g.join("")}},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareGoodsDetailControl=Class.create();Object.extend(ShareGoodsDetailControl.prototype,ShareControlBase.prototype);Object.extend(ShareGoodsDetailControl.prototype,{name:"ShareGoodsDetailControl",relatedObjType:MtimeShareRelatedObjectTypes.Link,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{title:"",link:"",pic:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.title+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.title+'" src="'+this.pic+'" /></a></div>');return b.join("")},shareMtimeContent:function(){return"分享商品"},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.title+this.link},getShareObjectMailTitle:function(){return this.title},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.pic},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.title,this.link,e,this.desc,d)},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareNewsCommentControl=Class.create();Object.extend(ShareNewsCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareNewsCommentControl.prototype,{name:"ShareNewsCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.CMSNews,shareRelatedObjType:ShareRelatedObjectTypes.NewsComment,isPicNews:false,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{newsId:0,commentContext:"",newsTitle:"",newsUrl:"",shareInfo:{isLogin:null,needAdditionalInfo:true}}),renderWebShareLinks:function(){ShareControlBase.prototype.renderWebShareLinks.apply(this);this.middleShareClassName="infoshare"},getMiddleShareHtml:function(){var d=[];var c=this.newsTitle;if(c.bytelength()>this.EXCERPT_SIZE*2){c=c.substr(0,this.EXCERPT_SIZE)+"..."}d.push('<h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+c+"</a></h2>");return d.join("")},shareMtimeContent:function(){return this.commentContext},getShareObjectUrl:function(){return this.newsUrl},getShareObjectTitle:function(){return"<"+this.commentContext+"> 评：新闻 【"+this.newsTitle+"】 <"+this.newsUrl+">"},getShareObjectId:function(){return this.newsId},getShareExpandId:function(){return 0},getShareObjectMailTitle:function(){return this.newsTitle},getShareObjectDefaultRecommendContent:function(f){var e="新闻评论分享："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareVideoMovieCommentControl=Class.create();Object.extend(ShareVideoMovieCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoMovieCommentControl.prototype,{name:"ShareVideoMovieCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Video,shareRelatedObjType:ShareRelatedObjectTypes.VideoMovieComment,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0,commentContext:""}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.videoTitleName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.videoTitleName+'" src="'+this.shareInfo.specificVideoUrl+'" /><i class="i_share_video">&nbsp;</i><i class="i_share_mask">&nbsp;</i></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.videoTitleName+"</a></h2><p>"+this.shareInfo.videoName+"</p></div>");return b.join("")},shareMtimeContent:function(){return this.commentContext},getShareObjectUrl:function(){return this.shareInfo.videoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.videoId},getShareExpandId:function(){return 0},getShareExpandContext:function(){return encodeURIComponent(this.commentContext)},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享视频评论："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareVideoPersonCommentControl=Class.create();Object.extend(ShareVideoPersonCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareVideoPersonCommentControl.prototype,{name:"ShareVideoPersonCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.Video,shareRelatedObjType:ShareRelatedObjectTypes.VideoPersonComment,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{videoId:0,personId:0,commentContext:""}),getMiddleShareHtml:function(){var b=[];b.push('<div class="picmid"><a title="'+this.shareInfo.videoTitleName+'" target="_blank" href="'+this.getShareObjectUrl()+'"><img alt="'+this.shareInfo.videoTitleName+'" src="'+this.shareInfo.specificVideoUrl+'" /><i class="i_share_video">&nbsp;</i><i class="i_share_mask">&nbsp;</i></a></div>');b.push('<div class="txtmid"><h2><a target="_blank" href="'+this.getShareObjectUrl()+'">'+this.shareInfo.videoTitleName+"</a></h2><p>"+this.shareInfo.videoName+"</p></div>");return b.join("")},shareMtimeContent:function(){return this.commentContext},getShareObjectUrl:function(){return this.shareInfo.videoLink},getShareObjectTitle:function(){return this.shareInfo.title},getShareObjectId:function(){return this.videoId},getShareExpandId:function(){return this.personId},getShareExpandContext:function(){return encodeURIComponent(this.commentContext)},getShareObjectMailTitle:function(){return this.shareInfo.mailTitle},getShareObjectDefaultRecommendContent:function(f){var e="分享视频评论："+this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}}});var ShareSCMGoodsCommentControl=Class.create();Object.extend(ShareSCMGoodsCommentControl.prototype,ShareControlBase.prototype);Object.extend(ShareSCMGoodsCommentControl.prototype,{name:"ShareSCMGoodsCommentControl",relatedObjType:MtimeShareRelatedObjectTypes.SCMGoodsComment,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{goodsName:"",commentText:"",link:"",goodsImageUrl:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),getMiddleShareHtml:function(){var c=[];var d=this.goodsImageUrl.substring(0,this.goodsImageUrl.lastIndexOf("."))+"_160X160";d+=this.goodsImageUrl.substring(this.goodsImageUrl.lastIndexOf("."));c.push('<div class="picmid"><a title="'+this.goodsName+'" target="_blank" href="'+this.link+'"><img alt="'+this.goodsName+'" src="'+d+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.link+'">'+this.goodsName+"</a></h2></div>");return c.join("")},shareMtimeContent:function(){return"【商品】"+this.goodsName+': "'+this.commentText+'" '+this.link},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.goodsName+': "'+this.commentText+'" '+this.link},getShareObjectMailTitle:function(){return"商品评论分享："+this.goodsName},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.goodsImageUrl},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d=this.getShareObjectTitle();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.goodsName,this.link,e,this.desc,d)},render:function(){var m=this.getShareObjectUrl();var l=this.getShareObjectTitle();var j="";var k=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var g=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){j=this.getShareObjectPicUrl()}var h=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){a.href=String.format(b.urlFormat,m,l,j)}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,m,l,j,k,g)}}.bind(this))}});var ShareSCMGoodsDetailControl=Class.create();Object.extend(ShareSCMGoodsDetailControl.prototype,ShareControlBase.prototype);Object.extend(ShareSCMGoodsDetailControl.prototype,{name:"ShareSCMGoodsDetailControl",relatedObjType:MtimeShareRelatedObjectTypes.SCMGoodsComment,isAjaxData:false,options:Object.extend(Object.extend({},ShareControlBase.prototype.options),{goodsName:"",link:"",goodsImageUrl:"",desc:"",shareInfo:{isLogin:null,needAdditionalInfo:false}}),getMiddleShareHtml:function(){var c=[];var d=this.goodsImageUrl.substring(0,this.goodsImageUrl.lastIndexOf("."))+"_160X160";d+=this.goodsImageUrl.substring(this.goodsImageUrl.lastIndexOf("."));c.push('<div class="picmid"><a title="'+this.goodsName+'" target="_blank" href="'+this.link+'"><img alt="'+this.goodsName+'" src="'+d+'" /></a></div>');c.push('<div class="txtmid"><h2><a target="_blank" href="'+this.link+'">'+this.goodsName+"</a></h2></div>");return c.join("")},shareMtimeContent:function(){return this.goodsName+" | "+this.desc},onClickShareButton:function(d){var c=Event.findElement(d,"dd");this.callback&&this.callback(c);if(c.hasClassName("on")){c.removeClassName("on");if(this.shareContainer){this.shareContainer.hide()}}else{if(c.hasClassName("notcurr")){c.removeClassName("notcurr")}c.addClassName("on");if(this.shareContainer){this.shareContainer.show()}}Event.stop(d)},getShareObjectUrl:function(){return this.link},getShareObjectTitle:function(){return this.goodsName+" | "+this.desc+" | 时光商城"},getShareObjectMailTitle:function(){return"分享商品："+this.goodsName},getShareObjectId:function(){return 0},getShareObjectPicUrl:function(){return this.goodsImageUrl},getShareObjectDefaultRecommendContent:function(f){var e=this.getShareObjectMailTitle();var d="分享商品： "+this.getShareObjectTitle()+" "+this.getShareObjectUrl();if(f==="subject"){return e}else{return d}},serverLinkControl:{recommendLinkToShare:function(j,k,h,g,f){if(typeof(siteCommunityServiceUrl)!="undefined"){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","RecommendLinkToShare",[j,k,h,g],f,"/community.api?Ajax_CallBack=true","get","20000")}}},onSaveShareCallback:function(b){if(typeof recommendLinkToShareResult!=="undefined"){b(recommendLinkToShareResult)}},saveShareInternal:function(e,d,f){this.serverLinkControl.recommendLinkToShare(this.goodsName,this.link,e,this.desc,d)},render:function(){var q=this.getShareObjectUrl();var p=this.getShareObjectTitle();var n="";var m=this.goodsName;var l=this.desc;var o=encodeURIComponent(this.getShareObjectDefaultRecommendContent("subject"));var j=encodeURIComponent(this.getShareObjectDefaultRecommendContent("body"));if(this.getShareObjectPicUrl()){n=this.getShareObjectPicUrl()}var k=this.shareContainer.getElementsBySelector("a").each(function(a){var c=a.readAttribute("method");var b=this.ButtonInfoMap[c];if(b&&b.type==ShareTabType.shareToWeb){if(c=="toSinaMicroblogging"||c=="toTencentMicroblogging"){a.href=String.format(b.urlFormat,q,p,n)}else{a.href=String.format(b.urlFormat,q,m,n,p,l)}}if(b&&b.type==ShareTabType.shareToEMail){a.href=String.format(b.urlFormat,q,m,n,p,l,o,j)}}.bind(this))}});var ShareControlManager=Class.create();Object.extend(ShareControlManager.prototype,{controls:null,initialize:function(){this.controls=[]},swtichNewControl:function(e,h){var f=parseInt(e.shareRelatedObjType,10);var g;switch(f){case ShareRelatedObjectTypes.Movie:g=new ShareMovieControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieIsReleased:g=new ShareMovieIsReleasedControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieUpcoming:g=new ShareMovieUpcomingControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieHasAwards:g=new ShareMovieHasAwardsControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieGeneral:g=new ShareMovieGeneralControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieContentPlot:g=new ShareMovieContentPlotControl({shareControlStyleType:h,movieParagraphId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieRoleDescInfo:g=new ShareMovieRoleDescInfoControl({shareControlStyleType:h,movieRoleId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieRoleDescAll:g=new ShareMovieRoleDescAllControl({shareControlStyleType:h,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieBehindCurtain:g=new ShareMovieBehindCurtainControl({shareControlStyleType:h,behindSectionID:e.relatedId,screenshotImageUrl:e.screenshotImageUrl,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieVerseLines:g=new ShareMovieVerseLinesControl({shareControlStyleType:h,behindSectionID:e.relatedId,screenshotImageUrl:e.screenshotImageUrl,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieBehindTemplate:g=new ShareMovieBehindTemplateControl({shareControlStyleType:h,title:e.title,link:e.link,pic:e.pic,desc:e.desc,movieId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieTelecinePage:g=new ShareMovieTelecinePageControl({shareControlStyleType:h,shareButton:e.shareButton,shareContainer:e.shareContainer,movieTitle:e.movieTitle,cityName:e.cityName,imageUrl:e.imageUrl,date:e.date,link:e.link,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.PersonFavorableComment:g=new SharePersonFavorableCommentControl({shareControlStyleType:h,personId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.News:g=new ShareNewsControl({shareControlStyleType:h,newsId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.ImageNews:g=new ShareImageNewsControl({shareControlStyleType:h,imageId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieLongComment:g=new ShareMovieLongCommentControl({shareControlStyleType:h,blogId:e.relatedId,urlTypeId:e.expandId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieShortComment:g=new ShareMovieShortCommentControl({shareControlStyleType:h,tweetId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MovieLeaveComment:g=new ShareMovieLeaveCommentControl({shareControlStyleType:h,tweetId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.VideoMovie:g=new ShareVideoMovieControl({shareControlStyleType:h,videoId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.VideoPerson:g=new ShareVideoPersonControl({shareControlStyleType:h,videoId:e.relatedId,personId:e.expandId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.PictureMovie:g=new SharePictureMovieControl({shareControlStyleType:h,imageId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,desc:e.desc,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.PicturePerson:g=new SharePicturePersonControl({shareControlStyleType:h,imageId:e.relatedId,personId:e.expandId,shareButton:e.shareButton,shareContainer:e.shareContainer,desc:e.desc,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.Cinema:g=new ShareCinemaControl({shareControlStyleType:h,cinemaId:e.relatedId,date:e.date,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.IndexNewsTop:g=new ShareUniversalControl({shareControlStyleType:h,newsId:e.relatedId,title:e.title,fullTitle:e.fullTitle,link:e.link,pic:e.pic,desc:e.desc,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.Blog:g=new ShareBlogControl({shareControlStyleType:h,blogId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.ForumTopic:g=new ShareForumTopicControl({shareControlStyleType:h,topicId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.Activity:g=new ShareActivityControl({shareControlStyleType:h,activityId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.MediaReview:g=new ShareMediaReviewControl({shareControlStyleType:h,mediaReviewId:e.relatedId,shareButton:e.shareButton,shareContainer:e.shareContainer,expandMovieId:e.expandMovieId,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.Link:g=new ShareLinkControl({shareControlStyleType:h,title:e.title,link:e.link,pic:e.pic,desc:e.desc,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.OffsiteLink:g=new ShareOffsiteLinkControl({title:e.title,link:e.link,pic:e.pic,desc:e.desc,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.GoodsDetail:g=new ShareGoodsDetailControl({shareControlStyleType:h,title:e.title,link:e.link,pic:e.pic,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;case ShareRelatedObjectTypes.SCMGoodsDetail:g=new ShareSCMGoodsDetailControl({shareControlStyleType:h,goodsName:e.title,link:e.link,goodsImageUrl:e.pic,desc:e.desc,shareButton:e.shareButton,shareContainer:e.shareContainer,autoLoad:false,callback:e.callback,shareSuccessCallBack:e.shareSuccessCallBack});break;default:break}return g},initShareControl:function(c){var d=[];c.each(function(a){var b;var h=ShareControlStyleType.FloatStyle;if(a.shareControlStyleType){h=a.shareControlStyleType}var j=parseInt(a.shareRelatedObjType,10);var k=this;var b=k.swtichNewControl(a,h);if(b){this.controls.push(b);d.push(b)}}.bind(this));return d},destroyControl:function(){this.controls.each(function(b){b.close()});this.controls=null},close:function(){if(!this.closed){this.closed=true;this.destroyControl()}}});function EmailIframe(d){var c=document.createElement("iframe");c.style.display="none";c.style.width="0px";c.style.height="0px";c.src=d;document.body.appendChild(c);setTimeout(function(){document.body.removeChild(c)},8000)}function GlobalSiteShare(z){if(GlobalUrlValue!==""){z=GlobalUrlValue;GlobalUrlValue=""}var q=z.indexOf("?");if(q>0){var w=z.substring(q);var u=z.substring(0,q);var p=[];var y=w.substring(1);var v=y.split("&");for(var s=0;s<v.length;s++){var x=v[s].indexOf("=");if(x==-1){continue}var j=v[s].substring(0,x);var A=v[s].substring(x+1);A=A.replace(/\^PIC\^/g,encodeURIComponent("&"));p.push({key:j,value:decodeURIComponent(A)})}var r=null;if(p.length>0){r=u+"?";for(var t=0;t<p.length;t++){if(t!=0){r+="&"}r+=p[t].key+"="+encodeURIComponent(p[t].value)}}if(r!=null){z=r}}window.open(z)}function ShowQrCode(f){var d="";if(getNewValue){d=encodeURIComponent(getNewValue(location.href))}else{d=encodeURIComponent(location.href)}d=siteServiceUrl+"/GetQrCodeHandler.ashx?qrCodeStr="+d;var e=[];e.push('<div class="tc">');e.push('<h4 class="px18">分享到微信朋友圈</h4>');e.push('<p><img width="232" height="232" alt="二维码" src="'+d+'"></p>');e.push('<p class="c_666 px14">扫描上方二维码 分享到微信</p>');e.push("</div>");this.dialog=new Dialog({title:"",content:e.join("")})}var Follow=Class.create();Object.extend(Object.extend(Follow.prototype),{server:{getFollow:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetFollowRelation",[f,e],d,"/Service/Twitter.msi","get","20000")},Follow:function(f,d,e){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","Follow",[f],e,"/Service/Twitter.msi","get","20000",d)},UnFollow:function(d,c){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","UnFollow",[d],c,"/Service/Twitter.msi","get","20000")},RemoveFromBlackList:function(d,c){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","RemoveFromBlackList",[d],c,"/Service/Twitter.msi","get","20000")}},options:{container:"",isLogin:false,autoGetFollowInfo:false,relatedObjType:0,relatedId:0,ischange:false,iscard:false,isuser:false,callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDom();this.initializeEvent();this.load()},initializeDom:function(){this.container=$(this.container);this.contentEnd=$("contentEnd")},destroyDOM:function(){this.container=null;this.collectBoxId=null},initializeEvent:function(){if(this.container){this.clickRegionHandler=this.onClick.bind(this);this.container.observe("click",this.clickRegionHandler)}Event.observe(window,"unload",this.close.bind(this))},load:function(){if(this.autoGetFollowInfo){if(this.isLogin){this.server.getFollow(this.relatedObjType,this.relatedId,function(b){if(b&&b.value){this.followInfo=b.value;this.render()}else{this.followInfo=null;this.builderNode(0);this.container.innerHTML=this.followTemplate}}.bind(this))}else{this.render()}}},render:function(){if(this.isLogin&&this.followInfo&&this.followInfo.fTwitterId&&this.followInfo.nickname){this.fTwitterId=this.followInfo.fTwitterId;this.nickname=this.followInfo.nickname;var b=this.followInfo.relation;switch(b){case 1:this.builderNode("c");break;case 2:this.builderNode("a");break;case 3:this.builderNode("d");break;case 4:this.builderNode("b");break;default:this.builderNode(0)}this.container.innerHTML=this.followTemplate}else{this.builderNode(0);this.container.innerHTML=this.followTemplate}},onClick:function(g){var e=Event.element(g);var h=e.readAttribute("method");switch(h){case"aFollow":this.fTwitterId=e.readAttribute("ftwitterid");var f="确定不再关注？";this.builderDialogBox(e,f,"c");break;case"bFollow":this.fTwitterId=e.readAttribute("ftwitterid");var f="确定取消关注？";this.builderDialogBox(e,f,"d");break;case"cFollow":case"dFollow":this.fTwitterId=e.readAttribute("ftwitterid");this.server.Follow(this.fTwitterId,e,function(a){if(a&&a.value){switch(a.value){case -7:if(typeof UserLoginDialog!="undefined"){var b=new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs(["/js/2014/UserLoginDialog.js"],function(){var c=new UserLoginDialog({callback:function(){location.reload()}})})}break;case -1:$alert("不能关注自己!");break;case -4:$alert("关注失败，关注人数已达上限!");break;case -5:$alert("由于该用户的隐私设置，您无法关注他/她!");break;case -3:case -2:$alert("关注失败，该用户已不存在!");break;case -6:$alert("该会员已被你拉入黑名单");break;case 0:$alert("关注失败!");break;case 1:this.nickname=e.readAttribute("nickname");if(this.ischange){if(h==="cFollow"){this.builderNode("a");this.followId=e.up("a",0);if(typeof(this.followId)==="undefined"){this.followId=e}}else{if(h==="dFollow"){this.builderNode("b");this.followId=e.up("b",0)}}this.followId.next("p.pt12")&&this.followId.next("p.pt12").remove();this.followId.replace(this.followTemplate)}this.callback&&this.callback(this.followId,false,"follow");if(this.isuser){if(typeof Weibo!="undefined"&&typeof(Weibo.FollowSuccDialog)!="undefined"){var b=new Weibo.FollowSuccDialog({user:{id:this.fTwitterId,name:this.nickname}})}else{$loadJs(["/js/2011/weibo/popupDialog.js"],function(){var c=new Weibo.FollowSuccDialog({user:{id:this.fTwitterId,name:this.nickname}})}.bind(this))}}break}}}.bind(this));break;case"eFollow":this.fTwitterId=e.readAttribute("ftwitterid");var f='<p class="bold">确定解除黑名单？</p>';this.followId=e.up("b",0);if(this.collectBox!=null){this.collectBox.close()}this.collectBox=new DialogBox({element:e,content:f,buttons:[{title:"确定",buttonStyle:"btn_blue2 mr15",callback:function(a){this.server.RemoveFromBlackList(this.fTwitterId,function(b){this.callback&&this.callback("",false);if(b&&b.value){if(this.ischange){this.nickname=e.readAttribute("nickname");this.builderNode("c");this.followId.next("p.pt12")&&this.followId.next("p.pt12").remove();this.followId.replace(this.followTemplate)}}}.bind(this));a.close()}.bind(this)},{title:"取消",buttonStyle:"btn_gray2",onmouseover:"this.className='btn_blue2'",onmouseout:"this.className='btn_gray2'",callback:function(a){if(this.ischange){this.callback&&this.callback("",false)}a.close()}.bind(this)}]});break}},destroyEvent:function(){this.container.stopObserving("click",this.clickRegionHandler)},closeFollow:function(e,d,f){this.followId=e.up("b",0);if(this.collectBox!=null){this.collectBox.close()}if(browser.ie){e.up("a",0).style.position="static"}this.collectBox=new DialogBox({element:e,content:d,buttons:[{title:"确定",buttonStyle:"btn_blue2 mr15",callback:function(a){this.server.UnFollow(this.fTwitterId,function(b){if(b&&b.value){this.callback&&this.callback(this.followId,false,"unfollow");if(this.ischange){this.nickname=e.readAttribute("nickname");this.builderNode(f);this.followId.next("p.pt12")&&this.followId.next("p.pt12").remove();this.followId.replace(this.followTemplate)}}}.bind(this));a.close()}.bind(this)},{title:"取消",buttonStyle:"btn_gray2",onmouseover:"this.className='btn_blue2'",onmouseout:"this.className='btn_gray2'",callback:function(a){if(this.ischange){this.callback&&this.callback("",false)}a.close()}.bind(this)}]})},builderDialogBox:function(j,h,l){if(this.dialogBox){this.dialogBox.remove()}this.followType=l;this.element=j;var m=j.up(".my_layer");var o=160;if(m){o=parseInt(m.style.zIndex,10)+2}var n='<div class="messpop" style="z-index: '+o+';width: 290px;"> <em class="br_arrow">&nbsp;</em> '+h+' <a class="btn_on">确定</a> <a class="btn_off">取消</a> </div>';this.dialogBox=Builder.build(n);var k=this.getXY(j);this.dialogBox.setStyle({top:Math.round(k.y-80)+"px",left:Math.round(k.x-278)+"px"});if(this.contentEnd){this.contentEnd.appendChild(this.dialogBox)}else{document.body.appendChild(this.dialogBox)}this.onClickDialogBoxHandler=this.onClickDialogBox.bind(this);Event.observe(this.dialogBox,"click",this.onClickDialogBoxHandler)},onClickDialogBox:function(e){var d=Event.element(e);var f;if(this.iscard){f=this.element.up("b",0)}else{f=this.element.up("span",0)}if(d.hasClassName("btn_on")){this.server.UnFollow(this.fTwitterId,function(a){if(a&&a.value){this.callback&&this.callback(f,false,"unfollow");if(this.ischange){this.nickname=d.readAttribute("nickname");this.builderNode(this.followType);if(f){f.replace(this.followTemplate)}}this.dialogBox.remove();this.dialogBox=null}}.bind(this));Event.stopObserving(this.dialogBox,"click",this.onClickDialogBoxHandler)}else{if(d.hasClassName("btn_off")){this.callback&&this.callback("",false);Event.stopObserving(this.dialogBox,"click",this.onClickDialogBoxHandler);this.dialogBox.remove();this.dialogBox=null}}},builderNode:function(b){switch(b){case 0:this.followTemplate='<a class="my_relation_adds cc" href="#" onclick="return false" ><cite method="cFollow">加关注</cite></a>';break;case"a":if(this.iscard){this.followTemplate=String.format('<b class="bm_ticket not_bm_ticket"><i>√</i>已关注<span><a atype="a" method="aFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">取消</a></span></b>',this.fTwitterId,this.nickname)}else{this.followTemplate='<span class="my_relation"><span class="ico_focus mr6 c_000"><cite>已关注</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method="aFollow">取消</cite></a></span>'}break;case"b":if(this.iscard){this.followTemplate=String.format('<b href="#" target="_blank" class="bm_ticket not_bm_ticket">相互关注<span><a atype="a" method="dFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">取消</a></span></b>',this.fTwitterId,this.nickname)}else{this.followTemplate='<span class="my_relation"><span class="ico_ecfocus mr6 c_000"><cite>相互关注</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method="bFollow">取消</cite></a></span>'}break;case"c":if(this.iscard){this.followTemplate=String.format('<a href="#" method="cFollow" ftwitterid="{0}" nickname="{1}" target="_blank" class="bm_ticket" onclick="return false;">+ 加关注</a>',this.fTwitterId,this.nickname)}else{this.followTemplate='<a class="my_relation_adds cc" href="#" onclick="return false" ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "cFollow" ><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "cFollow">加关注</cite></a>'}break;case"d":if(this.iscard){this.followTemplate=String.format('<b class="bm_ticket not_bm_ticket">粉丝<span><a method="dFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">加关注</a></span></b>',this.fTwitterId,this.nickname)}else{this.followTemplate='<span class="my_relation"><span class="mr6 c_000"><cite>粉丝</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "dFollow">加关注</cite></a></span>'}break;case"e":if(this.iscard){this.followTemplate='<span class="my_relation fr mt9 mr9"><span class="mr6 c_000"><cite>已加入黑名单</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "dFollow">解除</cite></a></span>'}else{this.followTemplate='<span class="my_relation"><span class="mr6 c_000"><cite>已加入黑名单</cite></span>|<a href="#" onclick="return false"  class="ico_cancel ml6"><cite ftwitterid='+this.fTwitterId+" nickname="+this.nickname+' method= "dFollow">解除</cite></a></span>'}break}},getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft;k=a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM()}}});var ToolBannerShareControlManager;var siteCommunityServiceUrl=siteCommunityServiceUrl||"http://service.community.mtime.com";var RightFloatToolsControl=Class.create();Object.extend(RightFloatToolsControl.prototype,{options:{editorComment:"",hasSearchButton:true,hasShareButton:true,hasFavoriteButton:true,hasMessageButton:true,hasCodeButton:true,hasTopButton:true,conversionUrl:"",shareRelatedObjType:"",relatedId:0,expandId:0,autoLoad:"",screenshotImageUrl:"",movieTitle:"",cityName:"",imageUrl:"",imagePath:"",link:"",videoId:0,title:"",fullTitle:"",pic:"",desc:"",expandMovieId:0,date:new Date(),isLogin:false,signInUrl:"",relatedObjId:0,relatedObjType:0,hasFavorited:false,codeTemplate:'<dl><dt><img src="#{codeUrl}" width="115" height="115"></dt><dd><p>扫描二维码</p><p>手机浏览页面</p></dd></dl>'},server:{getFavoriteCategorys:function(h,g,f,e){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetFavoriteCategorys2",[h,g,f],e,"/community.api?Ajax_CallBack=true","post","20000")}}},initialize:function(b){this.setOptions(b);this.initializeDom();this.initializeEvent();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeDom:function(){this.scrolltop=0;this.addDOM();this.rightFloatControls=this.rightFloatControl.immediateDescendants();this.topbar=$("topbar");this.isSearch=true},initializeEvent:function(){if(this.rightFloatControl){this.onClickRigtFloatHandler=this.onClickRigtFloat.bind(this);Event.observe(this.rightFloatControl,"click",this.onClickRigtFloatHandler)}this.onClickBodyHandler=this.onClickBody.bind(this);Event.observe(document.body,"click",this.onClickBodyHandler);Event.observe(window,"unload",this.close.bind(this));this.setIntervalTimer()},load:function(){if(this.hasFavoriteButton){this.server.getFavoriteCategorys(this.relatedObjType,this.relatedObjId,true,function(b){if(b&&b.value){if(b.value.isLogin&&b.value.hasFavorited&&this.favoritebar){this.favoritebar.addClassName("curron");this.favoritebar.title="已收藏"}}}.bind(this))}},addDOM:function(){this.showButtonMethod(this.rightFloatControls);this.rightFloatControl=Builder.node("div",{className:"mtimebar"},[this.searchbar,this.sharebar,this.favoritebar,this.messagebar,this.codebar,this.tooltopbar,this.sharebox,this.favoritbox,this.codebox]);document.body.appendChild(this.rightFloatControl)},showButtonMethod:function(){if(!this.hasSearchButton){this.searchbar=$(Builder.node("div",{className:"searchbar",title:"搜索",style:"display:none"}))}else{this.searchbar=$(Builder.node("div",{className:"searchbar",title:"搜索",method:"search",style:"display:none"},[Builder.node("b",{className:"baron",method:"search"},["搜索"])]))}if(!this.hasShareButton){this.sharebar=$(Builder.node("div",{className:"sharebar",title:"分享",style:"display:none"}))}else{this.sharebar=$(Builder.node("div",{className:"sharebar",title:"分享",method:"share"},[Builder.node("b",{className:"baron",method:"share"},["分享"])]))}if(!this.hasFavoriteButton){this.favoritebar=$(Builder.node("div",{className:"collectbar",title:"收藏",style:"display:none"}))}else{this.favoritebar=$(Builder.node("div",{className:"collectbar",title:"收藏",method:"favorite"},[Builder.node("b",{className:"baron",method:"favorite"},["收藏"])]))}if(!this.hasMessageButton){this.messagebar=$(Builder.node("div",{className:"messagebar",title:"留言",style:"display:none"}))}else{this.messagebar=$(Builder.node("div",{className:"messagebar",title:"留言",method:"message"},[Builder.node("b",{className:"baron",method:"message"},["留言"])]))}if(!this.hasCodeButton){this.codebar=$(Builder.node("div",{className:"codebar",title:"二维码",style:"display:none"}))}else{this.codebar=$(Builder.node("div",{className:"codebar",title:"二维码",method:"code"},[Builder.node("b",{className:"baron",method:"code"},["二维码"])]))}if(!this.hasTopButton){this.tooltopbar=$(Builder.node("div",{className:"topbar",title:"返回顶部",style:"display:none"}))}else{this.tooltopbar=$(Builder.node("div",{className:"topbar",title:"返回顶部",method:"backtop",style:"visibility:hidden"},[Builder.node("b",{className:"baron",method:"backtop"},["返回顶部"])]))}this.sharebox=$(Builder.node("div",{className:"sharebox",style:"display:none;"}));this.favoritbox=$(Builder.node("div",{className:"collectbox",style:"display:none;"}));this.codebox=$(Builder.node("div",{className:"codebox",style:"display:none;"}));nullDiv=null},onClickBody:function(e){var d=Event.element(e);var f=d.up(".mtimebar");if(f!==this.rightFloatControl){this.removeClassName()}},onClickRigtFloat:function(o){this.clickElement=Event.element(o);var q=this.clickElement.readAttribute("method");if(!this.clickElement||this.clickElement===document.body){return}switch(q){case"search":this.removeClassName();if(this.topbar){if(this.isSearch){this.lockTopBar=true;this.isSearch=false;this.topbar.addClassName("scrolltop");this.scrolltop=document.documentElement.scrollTop||document.body.scrollTop;this.topbarHeight=this.topbar.getHeight();var p=this.topbar.down(".menubg");this.topbarHeight+=p.getHeight();this.topbar.style.top=-this.topbarHeight+"px";var k=this.topbar.down(".bartop");var l=0;if(k){l=k.getHeight()}var r=this.topbar.down(".topline");if(!r){r=this.topbar.down(".bartop")}var s=r.getHeight()+l;document.body.style.paddingTop=s+"px";this.topbar.addClassName("transition6");FunctionExt.defer(function(){this.topbar.style.position="fixed";this.topbar.style.top="0px";p=r=s=k=l=null},200,this)}else{this.topbarAnimate()}}break;case"share":this.removeClassName();if(typeof ShareControlManager!=="undefined"){this.instanceShareControl()}else{$loadJs("/js/2014/share.js",function(){this.instanceShareControl()}.bind(this))}this.sharebar.addClassName("curr");this.sharebox.show();break;case"favorite":this.removeClassName();if(typeof FavoriteButtonControl!=="undefined"){this.instanceCollectControl()}else{$loadJs("/js/2014/favorite.js",function(){this.instanceCollectControl()}.bind(this))}break;case"message":this.removeClassName();if($(this.editorComment)){var n=$(this.editorComment);var m=$("commentRegion");if(m){m.scrollTo()}else{n.scrollTo()}n.focus();n=null}break;case"code":if(this.codebar.hasClassName("curr")){this.removeClassName()}else{this.removeClassName();this.setClassName();this.builderCodeMethod()}break;case"backtop":this.removeClassName();document.body.scrollIntoView();break}q=null},instanceShareControl:function(){if(typeof ToolBannerShareControlManager=="undefined"){ToolBannerShareControlManager=new ShareControlManager()}if(!this.shareControlManager){this.shareControlManager=ToolBannerShareControlManager.initShareControl([{shareRelatedObjType:this.shareRelatedObjType,relatedId:this.relatedId,expandId:this.expandId,autoLoad:this.autoLoad,screenshotImageUrl:this.screenshotImageUrl,movieTitle:this.movieTitle,cityName:this.cityName,imageUrl:this.imageUrl,imagePath:this.imagePath,link:this.link,videoId:this.relatedId,title:this.title,fullTitle:this.fullTitle,pic:this.pic,date:this.date,desc:this.desc,shareButton:this.sharebar,expandMovieId:this.expandMovieId,shareContainer:this.sharebox,callback:this.removeClassName.bind(this)}])}},instanceCollectControl:function(){if(!this.favoriteButtonControl){this.favoriteButtonControl=new FavoriteButtonControl({shareRelatedObjType:this.shareRelatedObjType,isLogin:this.isLogin,signInUrl:this.signInUrl,relatedObjId:this.relatedObjId,relatedObjType:this.relatedObjType,hasFavorited:this.hasFavorited,favoriteButton:this.favoritebar,favoriteContainer:this.favoritbox,callback:this.removeClassName.bind(this)})}},builderCodeMethod:function(){var h,j={},m=new Template(this.codeTemplate),g=new StringBuilder(),l="";if(this.conversionUrl!==""){l=encodeURIComponent(this.conversionUrl)}else{if(getNewValue){l=encodeURIComponent(getNewValue(location.href))}else{l=encodeURIComponent(location.href)}}j.codeUrl=siteServiceUrl+"/GetQrCodeHandler.ashx?qrCodeStr="+l;h=m.evaluate(j);var k=Builder.build(h);this.codebox.appendChild(k);this.codebox.show()},setClassName:function(){for(var b=0;b<=5;b++){if(this.rightFloatControls[b]!==this.clickElement){this.rightFloatControls[b].addClassName("notcurr")}else{this.rightFloatControls[b].addClassName("curr")}}},removeClassName:function(e){var f,g=9,h=9;if(e){if(e===this.sharebar){g=1;h=6}else{if(e===this.favoritebar){g=2;h=7}}}for(f=0;f<=5;f++){if(g!==f){if(this.rightFloatControls[f].hasClassName("notcurr")){this.rightFloatControls[f].removeClassName("notcurr")}if(this.rightFloatControls[f].hasClassName("curr")){this.rightFloatControls[f].removeClassName("curr")}}}for(f=6;f<=8;f++){if(h!==f){this.rightFloatControls[f].hide()}}this.codebox.innerHTML="";f=g=h=null},setIntervalTimer:function(){var c,d;d=document.documentElement.scrollTop||document.body.scrollTop;if(this.scrolltop!==d&&this.topbar&&this.lockTopBar){this.topbarAnimate()}if(d<200){if(this.searchbar){this.searchbar.hide()}if(this.tooltopbar){this.tooltopbar.style.visibility="hidden"}}else{if(this.searchbar){this.searchbar.show()}if(this.tooltopbar){this.tooltopbar.style.visibility="visible"}}c=d=null;this.myTimer=setTimeout(function(){this.setIntervalTimer()}.bind(this),2000)},topbarAnimate:function(){this.topbar.style.top=-this.topbarHeight+"px";FunctionExt.defer(function(){this.topbar.removeClassName("transition6");this.topbar.removeClassName("scrolltop");this.topbar.style.top="0px";this.topbar.style.position="";document.body.style.paddingTop="";this.lockTopBar=false;this.isSearch=true},600,this)},close:function(){this.destroyEvent();this.destroyDOM();this.destroyField()},destroyField:function(){},destroyEvent:function(){if(this.rightFloatControl){Event.stopObserving(this.rightFloatControl,"click",this.onClickRigtFloatHandler)}Event.stopObserving(document.body,"click",this.onClickBodyHandler)},destroyDOM:function(){this.rightFloatControl=null;this.myTimer&&clearTimeout(this.myTimer);this.myTimer=null}});var CrosswiseTools=Class.create();Object.extend(CrosswiseTools.prototype,RightFloatToolsControl.prototype);Object.extend(CrosswiseTools.prototype,{options:{slidesRegion:"",slidesRegionEl:null,editorComment:"",editorUrl:"",hasShareButton:true,hasFavoriteButton:true,expandMovieId:0,shareRelatedObjType:"",relatedId:0,expandId:0,autoLoad:"",screenshotImageUrl:"",movieTitle:"",cityName:"",imageUrl:"",imagePath:"",link:"",videoId:0,title:"",fullTitle:"",pic:"",desc:"",shareSuccessCallBack:null,date:new Date(),isLogin:false,signInUrl:"",relatedObjId:0,relatedObjType:0,hasFavorited:false},initializeEvent:function(){if(this.rightFloatControl){this.onClickRigtFloatHandler=this.onClickRigtFloat.bind(this);Event.observe(this.rightFloatControl,"click",this.onClickRigtFloatHandler)}Event.observe(window,"unload",this.close.bind(this))},load:function(){},addDOM:function(){this.slidesRegion=$(this.slidesRegion);if(!this.slidesRegion&&this.slidesRegionEl){this.slidesRegion=this.slidesRegionEl}this.showButtonMethod(this.rightFloatControls);this.rightFloatControl=$(Builder.node("div",{className:"smtimebar"},[this.sharebar,this.favoritebar,this.messagebar,this.sharebox,this.favoritbox]));if(this.slidesRegion){this.slidesRegion.appendChild(this.rightFloatControl)}},showButtonMethod:function(){var d=$(Builder.node("div",{style:"display:none"}));if(!this.hasShareButton){this.sharebar=$(Builder.node("div",{className:"sharebar",title:"分享",style:"display:none"}))}else{this.sharebar=$(Builder.node("div",{className:"sharebar",title:"分享",method:"share"},[Builder.node("b",{className:"baron",method:"share"},["分享"])]))}if(!this.hasFavoriteButton){this.favoritebar=$(Builder.node("div",{className:"collectbar",title:"收藏",style:"display:none"}))}else{this.favoritebar=$(Builder.node("div",{className:"collectbar",title:"收藏",method:"favorite"},[Builder.node("b",{className:"baron",method:"favorite"},["收藏"])]))}if(!this.editorUrl){this.messagebar=$(Builder.node("div",{className:"messagebar",title:"留言",style:"display:none"}))}else{var c=this.editorComment===""?this.editorUrl:this.editorUrl+"#"+this.editorComment;this.messagebar=Builder.node("div",{className:"messagebar",title:"留言"},[Builder.node("a",{className:"baron",href:c,target:"_blank"},["留言"])]);c=null}this.sharebox=$(Builder.node("div",{className:"sharebox",style:"display:none;"}));this.favoritbox=$(Builder.node("div",{className:"collectbox",style:"display:none;"}));d=null},onClickRigtFloat:function(c){this.clickElement=Event.element(c);if(!this.clickElement.readAttribute){return}var d=this.clickElement.readAttribute("method");switch(d){case"share":this.removeClassName();if(typeof ShareControlManager!=="undefined"){this.instanceShareControl()}else{$loadJs("/js/2014/share.js",function(){this.instanceShareControl()}.bind(this))}this.sharebar.addClassName("curr");this.sharebox.show();break;case"favorite":this.removeClassName();if(typeof FavoriteButtonControl!=="undefined"){this.instanceCollectControl()}else{$loadJs("/js/2014/favorite.js",function(){this.instanceCollectControl()}.bind(this))}break}},instanceShareControl:function(){if(typeof ToolBannerShareControlManager=="undefined"){ToolBannerShareControlManager=new ShareControlManager()}if(!this.shareControlManager){this.shareControlManager=ToolBannerShareControlManager.initShareControl([{shareRelatedObjType:this.shareRelatedObjType,expandId:this.expandId,relatedId:this.relatedId,autoLoad:this.autoLoad,screenshotImageUrl:this.screenshotImageUrl,movieTitle:this.movieTitle,cityName:this.cityName,imageUrl:this.imageUrl,imagePath:this.imagePath,link:this.link,videoId:this.relatedId,title:this.title,fullTitle:this.fullTitle,pic:this.pic,date:this.date,desc:this.desc,shareButton:this.sharebar,shareContainer:this.sharebox,expandMovieId:this.expandMovieId,shareControlStyleType:2,callback:this.removeClassName.bind(this),shareSuccessCallBack:this.shareSuccessCallBack}])}},instanceCollectControl:function(){if(!this.favoriteButtonControl){this.favoriteButtonControl=new FavoriteButtonControl({shareRelatedObjType:this.shareRelatedObjType,isLogin:this.isLogin,signInUrl:this.signInUrl,relatedObjId:this.relatedObjId,relatedObjType:this.relatedObjType,hasFavorited:this.hasFavorited,favoriteButton:this.favoritebar,favoriteContainer:this.favoritbox,favoriteControlStyleType:2,callback:this.removeClassName.bind(this)})}},setClassName:function(){},removeClassName:function(b){num1=9,num2=9;if(b){if(b===this.sharebar){num1=0;num2=3}else{if(b===this.favoritebar){num1=1;num2=4}}}for(i=0;i<3;i++){if(num1!==i){if(this.rightFloatControls[i].hasClassName("notcurr")){this.rightFloatControls[i].removeClassName("notcurr")}if(this.rightFloatControls[i].hasClassName("curr")){this.rightFloatControls[i].removeClassName("curr")}}}for(i=3;i<5;i++){if(num2!==i){this.rightFloatControls[i].hide()}}}});var ProductTools=Class.create();Object.extend(ProductTools.prototype,CrosswiseTools.prototype);Object.extend(ProductTools.prototype,{options:{slidesRegion:"",hasShareButton:true,hasFavoriteButton:true,hasCodeButton:true,slidesRegionEl:null,shareRelatedObjType:"",relatedId:0,link:"",title:"",pic:"",goodsId:0,pageName:"",sharePan:"",favoritePan:"",codePan:""},hasIsLogin:function(f,e,d){if(siteCommunityServiceUrl){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","HasIsLogin",[f,e],d,"/community.api?Ajax_CallBack=true","post","20000")}},initializeEvent:function(){if(this.rightFloatControl){this.onClickRigtFloatHandler=this.onClickRigtFloat.bind(this);Event.observe(this.rightFloatControl,"click",this.onClickRigtFloatHandler)}Event.observe(window,"unload",this.close.bind(this));this.onClickBodyHandler=this.onClickBody.bind(this);Event.observe(document.body,"click",this.onClickBodyHandler)},load:function(){if(this.hasFavoriteButton){this.hasIsLogin(this.goodsId,true,function(b){if(b&&b.value){if(b.value.isLogin&&b.value.hasFavorited&&this.favoritebar){this.favoritebar.addClassName("on");this.favoritebar.title="已收藏"}}}.bind(this))}if(typeof ShareControlManager!=="undefined"){this.instanceShareControl()}else{$loadJs("/js/2014/share.js",function(){this.instanceShareControl()}.bind(this))}},onClickBody:function(b){this.bodyClickRigtFloat(b)},addDOM:function(){this.slidesRegion=$(this.slidesRegion);if(!this.slidesRegion&&this.slidesRegionEl){this.slidesRegion=this.slidesRegionEl}this.showButtonMethod();this.rightFloatControl=$(Builder.node("dl",{},[this.codebar,this.favoritebar,this.sharebar,this.favoritbox]));if(this.slidesRegion){this.slidesRegion.appendChild(this.rightFloatControl)}},trackClick:function(b){if(typeof tracker!="undefined"){tracker.trackClick(this.pageName,b)}},showButtonMethod:function(){this.sharebox=$(Builder.node("div",{className:"sharebox",style:"display:none;"}));this.shareBtn=$(Builder.node("a",{className:"s_share",title:"分享"},[Builder.node("b",{className:"baron",method:"share"},["分享"]),Builder.node("i")]));if(!this.hasShareButton){this.sharebar=$(Builder.node("dd",{style:"display:none"}))}else{this.sharebar=$(Builder.node("dd",{method:"share"},[this.shareBtn,this.sharebox]))}if(this.sharePan!=""){Event.observe(this.sharebar,"click",function(){this.trackClick(this.sharePan)}.bind(this))}if(!this.hasFavoriteButton){this.favoritebar=$(Builder.node("dd",{className:"",title:"收藏",style:"display:none"}))}else{this.favoritebar=$(Builder.node("dd",{className:"",title:"收藏",method:"favorite"}));new Insertion.Bottom(this.favoritebar,'<a method="favorite" href="javascript:void(0)" class="s_fav" title="收藏"><i method="favorite"></i></a>')}if(this.favoritePan!=""){Event.observe(this.favoritebar,"click",function(){this.trackClick(this.favoritePan)}.bind(this))}if(!this.hasCodeButton){this.codebar=$(Builder.node("dd",{title:"二维码",style:"display:none"}))}else{this.codebar=$(Builder.node("dd",{title:"二维码",method:"code"}));new Insertion.Bottom(this.codebar,'<a method="code" href="javascript:void(0)" class="s_code" title="二维码"><b method="code">二维码</b><i method="code"></i></a><div style="display: none" class="codebox"><p class="codeImgBox_"></p><p class="mt9">扫描二维码<br />手机浏览页面</p></div>')}if(this.codePan!=""){Event.observe(this.codebar,"click",function(){this.trackClick(this.codePan)}.bind(this))}this.favoritbox=$(Builder.node("div",{className:"collectbox",style:"display:none;"}))},onClickRigtFloat:function(c){this.clickElement=Event.element(c);if(!this.clickElement.readAttribute){return}if(this.clickElement.previous("b")&&this.clickElement.previous("b").hasAttribute("method")){this.clickElement=this.clickElement.previous("b")}var d=this.clickElement.readAttribute("method");switch(d){case"share":break;case"favorite":if(typeof FavoriteButtonControl!=="undefined"){this.instanceCollectControl()}else{$loadSubJs("/js/2014/favorite.js",function(){this.instanceCollectControl()}.bind(this))}break;case"code":if(this.codebar.hasClassName("on")){this.closeCode()}else{this.codebar.addClassName("on");this.builderCodeNode(this.codebar.down(".codeImgBox_"))}break}},closeCode:function(){this.codebar.removeClassName("on");this.codebar.down(".codebox").hide()},closeShare:function(){this.sharebar.removeClassName("on");this.sharebar.down(".sharebox").hide()},bodyClickRigtFloat:function(c){this.clickElement=Event.element(c);if(!this.clickElement.readAttribute){return}var d=this.clickElement.readAttribute("method");switch(d){case"share":this.closeCode();break;case"favorite":this.closeCode();this.closeShare();break;case"code":this.closeShare();break;default:this.closeCode();this.closeShare();break}},instanceShareControl:function(){if(typeof ToolBannerShareControlManager=="undefined"){ToolBannerShareControlManager=new ShareControlManager()}if(!this.shareControlManager){this.shareControlManager=ToolBannerShareControlManager.initShareControl([{shareRelatedObjType:this.shareRelatedObjType,expandId:this.expandId,relatedId:this.relatedId,autoLoad:this.autoLoad,screenshotImageUrl:this.screenshotImageUrl,movieTitle:this.movieTitle,cityName:this.cityName,imageUrl:this.imageUrl,imagePath:this.imagePath,link:this.link,videoId:this.relatedId,title:this.title,fullTitle:this.fullTitle,pic:this.pic,date:this.date,desc:this.desc,shareButton:this.shareBtn,shareContainer:this.sharebox,expandMovieId:this.expandMovieId,callback:this.removeClassName.bind(this),shareSuccessCallBack:this.shareSuccessCallBack}])}},instanceCollectControl:function(){if(!this.favoriteButtonControl){this.favoriteButtonControl=new FavoriteButtonControlSCM({goodsId:this.goodsId,favoriteButton:this.favoritebar})}else{this.favoriteButtonControl.clickFavorite()}},builderCodeNode:function(e){var d="",f="";this.conversionUrl=this.link;if(this.conversionUrl!==""){f=encodeURIComponent(this.conversionUrl)}else{if(getNewValue){f=encodeURIComponent(getNewValue(location.href))}else{f=encodeURIComponent(location.href)}}d=siteServiceUrl+"/GetQrCodeHandler.ashx?qrCodeStr="+f;e.innerHTML='<img class="codeImg" src="'+d+'" width="110" height="110" alt="二维码" />';this.codebar.down(".codebox").show()},removeClassName:function(b){this.closeCode()}});var IndexShareToolsControl=Class.create();Object.extend(IndexShareToolsControl.prototype,{name:"IndexShareToolsControl",initialize:function(){this.initializeField();this.initializeDOM();this.initializeControl();this.initializeEvent();this.load()},initializeField:function(){},initializeDOM:function(){this.ShareContrainerList=$$(".i_share")},destroyDOM:function(){this.ShareContrainerList=null},initializeControl:function(){this.rightCtrl=new RightFloatToolsControl({hasShareButton:false,hasFavoriteButton:false,hasMessageButton:false,hasCodeButton:false})},destroyControl:function(){if(this.ShareControlList){this.ShareControlList.each(function(b){b.close();b=null})}},initializeEvent:function(){},destroyEvent:function(){},load:function(){if(this.ShareContrainerList){var b=siteMcUrl+"/member/signin";this.ShareControlList=[];this.ShareContrainerList.each(function(z){var w=0;var D=z.readAttribute("method");switch(D){case"newsimgshare":var F=z.readAttribute("newsid");var I=z.readAttribute("newstitle");var H=z.readAttribute("newslink");var L=z.readAttribute("pic");var x="[今日时光网头条精选]："+I;var G=new CrosswiseTools({shareRelatedObjType:9981,slidesRegionEl:z,link:H,title:I,fullTitle:x,pic:L,isLogin:false,signInUrl:b,relatedId:F,relatedObjId:F,relatedObjType:51,hasFavorited:false});this.ShareControlList.push(G);break;case"hotplayimgshare":var E=z.readAttribute("movieid");var y=new CrosswiseTools({slidesRegionEl:z,shareRelatedObjType:1111,relatedId:E,isLogin:false,signInUrl:b,relatedObjId:E,relatedObjType:1,hasFavorited:false});this.ShareControlList.push(y);break;case"communityimgshare":var K=z.readAttribute("objtype");var J=z.readAttribute("objid");var M;var A=true;switch(K){case"9991":M=6;w=1;break;case"7001":M=10;break;case"6001":M=6;break;case"2201":M=22;A=false;break;default:return}var v=new CrosswiseTools({slidesRegionEl:z,shareRelatedObjType:K,relatedId:J,isLogin:false,signInUrl:b,relatedObjId:J,relatedObjType:M,hasFavorited:false,expandId:w,hasFavoriteButton:A});this.ShareControlList.push(v);break;case"communitycommentshare":var K=z.readAttribute("objtype");var J=z.readAttribute("objid");var C="";if(z.hasAttribute("title")){C=z.readAttribute("title")}var B="";if(z.hasAttribute("link")){B=z.readAttribute("link")}var M;var A=true;switch(K){case"9991":M=6;w=1;break;case"9992":M=78;break;case"9993":M=78;break;case"6001":M=6;break;case"7001":M=10;break;case"2201":M=22;A=false;break;case"6401":M=78;default:return}var a=new CrosswiseTools({slidesRegionEl:z,link:B,title:C,shareRelatedObjType:K,relatedId:J,isLogin:false,signInUrl:b,relatedObjId:J,relatedObjType:M,hasFavorited:false,expandId:w,hasFavoriteButton:A});this.ShareControlList.push(a);break}}.bind(this))}},close:function(){if(!this.closed){this.closed=true;this.destroyControl();this.destroyEvent();this.destroyDOM()}}});var movieDictionary=[{key:"http://movie.mtime.com/(\\d+)/reviews/(\\d+).[\\w\\W*?]",value:"http://m.mtime.cn/#!/review/detail/{1}/",isAppendGreedyValue:false},{key:"http://movie.mtime.com/(\\d+)/posters_and_images/(\\d+)([\\w\\W*?])",value:"http://m.mtime.cn/#!/movie/{0}/posters_and_images/{1}{2}/",isAppendGreedyValue:true},{key:"http://movie.mtime.com/(\\d+)/posters_and_images[\\w\\W*?]",value:"http://m.mtime.cn/#!/movie/{0}/posters_and_images/",isAppendGreedyValue:false},{key:"http://movie.mtime.com/(\\d+)([\\w\\W+?])",value:"http://m.mtime.cn/#!/movie/{0}{1}/",isAppendGreedyValue:true}];var personDictionary=[{key:"http://people.mtime.com/(\\d+)/photo_gallery/(\\d+)([\\w\\W*?])",value:"http://m.mtime.cn/#!/person/concreteImage/{0}/{1}{2}/",isAppendGreedyValue:true},{key:"http://people.mtime.com/(\\d+)/photo_gallery[\\w\\W*?]",value:"http://m.mtime.cn/#!/person/personImages/{0}/",isAppendGreedyValue:false},{key:"http://people.mtime.com/(\\d+)([\\w\\W*?])",value:"http://m.mtime.cn/#!/person/{0}{1}/",isAppendGreedyValue:true}];var newsDictionary=[{key:"http://news.mtime.com/(\\d+)/(\\d+)/(\\d+)/(\\d+).[\\w\\W*?]",value:"http://m.mtime.cn/#!/news/movie/{3}/",isAppendGreedyValue:false},{key:"http://news.mtime.com/pix/(\\d+)/(\\d+)/(\\d+)/(\\d+).[\\w\\W*?]",value:"http://m.mtime.cn/#!/news/gallery/{3}/",isAppendGreedyValue:false}];var otherDictionary=[{key:"http://i.mtime.com/(\\d+)/blog/(\\d+)([\\w\\W*?])",value:"http://m.mtime.cn/#!/review/detail/{1}{2}/",isAppendGreedyValue:true}];var goodsDictionary=[{key:"http://item.mall.mtime.com/(\\d+)/",value:"http://m.mtime.cn/#!/commerce/item/{0}/",isAppendGreedyValue:false}];var dicArray=[movieDictionary,personDictionary,newsDictionary,otherDictionary,goodsDictionary];function stringFormat(f,k,j){for(var h=0;h<k.length;h++){var g="{"+h.toString()+"}";if(j&&h==k.length-1){if(isNaN(Number(k[h]))){k[h]=""}}f=f.replace(g,k[h])}return f}function getNewValue(e){var f="";for(var d=0;d<dicArray.length;d++){f=dictionaryMatch(e,dicArray[d]);if(f!==""){break}}return f===""?e:f}function dictionaryMatch(j,f){for(var g=0;g<f.length;g++){var k=new RegExp(f[g].key);var h=k.exec(j);if(typeof h!="undefined"&&h!=null&&h!=""){if(h.length!=0){h.splice(0,1);if(h.length!=0){return stringFormat(f[g].value,h,f[g].isAppendGreedyValue)}}}continue}return""}var Card=Class.create();Object.extend(Object.extend(Card.prototype),{information:{},followBool:false,options:{mytimeContentRegion:"",loadTemplate:'<div class="inner w270" style="min-height:120px;"><span class="load48"></span></div>',leftCardTemplate:"",callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.load();this.initializeEvent()},initializeDOM:function(){this.mytimeContentRegion=$(this.mytimeContentRegion);this.collectBoxTimeout=null;cardFollowBool=false},destroyDOM:function(){this.mytimeContentRegion=null;this.collectBoxId=null;cardFollowBool=null},initializeEvent:function(){if(this.mytimeContentRegion){this.onOverHandler=this.onOver.bind(this);this.mytimeContentRegion.observe("mouseover",this.onOverHandler);this.onOutHandler=this.onOut.bind(this);this.mytimeContentRegion.observe("mouseout",this.onOutHandler)}Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){if(this.mytimeContentRegion){this.mytimeContentRegion.stopObserving("mouseover",this.onOverHandler);this.mytimeContentRegion.stopObserving("mouseout",this.onOutHandler)}},load:function(){},render:function(){},onOver:function(e){var d=Event.element(e),f;this.method=d.getAttribute("method");this.cardElement=d;if(!this.method){f=d.up();this.method=f.getAttribute("method");this.cardElement=f}if(this.method){this.clientx=e.clientX;this.clienty=e.clientY;switch(this.method){case"usercard":this.userMethod(this.method);break;case"useridcard":this.userMethod(this.method);break;case"personcard":this.personMethod(this.method);break;case"personidcard":this.personMethod(this.method);break;case"moviecard":this.movieMethod(this.method);break;case"movieidcard":this.movieMethod(this.method);break;case"badgecard":this.badgeMethod(this.method);break;case"moviecard-left":this.movieMethod(this.method);break;case"tvcard":this.movieMethod(this.method);break}}d=f=null},builderHtml:function(b){this.overMy_leftMethod(this.cardElement,b)},userMethod:function(b){this.handleOutTimer();this.collectBoxTimeout=FunctionExt.defer(function(){var a;if(b==="usercard"){a=this.cardElement.readAttribute("ftwitterid")}else{if(b==="useridcard"){a=this.cardElement.readAttribute("userid")}}this.twitterId=a;this.key=b+a;this.cardElement.makePositioned();this.overMy_leftMethod(this.cardElement,this.loadTemplate);new UserLayerControl({id:this.twitterId,callback:this.builderHtml.bind(this)})},500,this)},movieMethod:function(b){this.handleOutTimer();this.collectBoxTimeout=FunctionExt.defer(function(){var a;if(b==="moviecard"){a=this.cardElement.readAttribute("ftwitterid")}else{if(b==="movieidcard"||b==="moviecard-left"){a=this.cardElement.readAttribute("movieid")}else{if(b==="tvcard"){a=this.cardElement.readAttribute("tvid")}}}this.twitterId=a;this.key=b+a;this.cardElement.makePositioned();this.overMy_leftMethod(this.cardElement,this.loadTemplate);if(b==="moviecard-left"){var d=this.cardElement.readAttribute("layerpan");new MovieLayerControl({id:this.twitterId,pagetype:1,callback:this.builderHtml.bind(this),pan:d?d:""})}else{if(b==="tvcard"){new TvLayerControl({id:this.twitterId,pagetype:1,callback:this.builderHtml.bind(this)})}else{new MovieLayerControl({id:this.twitterId,callback:this.builderHtml.bind(this)})}}},500,this)},personMethod:function(b){this.handleOutTimer();this.collectBoxTimeout=FunctionExt.defer(function(){var a;if(b==="personcard"){a=this.cardElement.readAttribute("ftwitterid")}else{if(b==="personidcard"){a=this.cardElement.readAttribute("personid")}}this.twitterId=a;var d=b+a;this.cardElement.makePositioned();this.overMy_leftMethod(this.cardElement,this.loadTemplate);new PersonLayerControl({id:this.twitterId,callback:this.builderHtml.bind(this)})},500,this)},badgeMethod:function(b){this.handleOutTimer();this.collectBoxTimeout=FunctionExt.defer(function(){var f=this.cardElement.readAttribute("userid");var e=this.cardElement.readAttribute("medaltype");var a=b+e;this.cardElement.makePositioned();if(this.information[a]===undefined){this.overMy_leftMethod(this.cardElement,this.loadTemplate);this.server.GetBadgeLayerInfo(f,e,function(d){if(d&&d.value){var c=d.value.value;this.information[a]=c;this.overMy_leftMethod(this.cardElement,c)}}.bind(this))}else{this.overMy_leftMethod(this.cardElement,this.information[a])}},500,this)},onOut:function(f){var e=Event.element(f),h;var g=e.getAttribute("method");if(!g){h=e.up();g=h.getAttribute("method")}if(g==="usercard"||g==="moviecard"||g==="personcard"||g==="useridcard"||g==="movieidcard"||g==="personidcard"||g==="badgecard"||g==="moviecard-left"||g==="tvcard"){this.handleOutTimer();if(this.collectBox!=null){this.collectBoxTimeout=FunctionExt.defer(function(){if(cardFollowBool==false){this.closeCard()}},500,this)}}e=h=g=null},timedCount:function(){if(this.isChanger){this.contentEnd=$("contentEnd");if(this.contentEnd){this.movieRating=this.contentEnd.down(".w330");if(this.movieRating){setTimeout(function(){this.timedCount()}.bind(this),1000)}else{if(this.collectBox!=null){this.closeCard();cardFollowBool=false}this.isChanger=false}}}else{setTimeout(function(){this.timedCount()}.bind(this),1000);this.isChanger=true}},closeCardIeMethod:function(){if(Mtime.browser.ie&&Mtime.browser.ie<7&&this.collectBox!=null){this.closeCard()}},overMy_leftMethod:function(c,d){if(this.collectBox!=null){this.closeCard()}this.isAutoClose=true;if(this.method==="moviecard"||this.method==="movieidcard"){this.isAutoClose=false}if(this.method!=="moviecard-left"&&this.method!=="tvcard"){this.collectBox=new DialogBox({element:c,content:d,arrowNew:true,isAutoClose:this.isAutoClose,setupDimensions:function(){var y=0,A=0;var C=this.windowElement.getDimensions();var D=C.width;var B=C.height;var w=this.elementX+this.elementWidth/2;var x=this.elementY;var t=w;var u=x+this.elementHeight;if(this.arrowNew){var b=this.cardId.down("em."+this.indicationStyle)}else{var b=this.cardId.down("p."+this.indicationStyle)}var a;if(b===undefined||b===null){a=17}else{a=b.getHeight()}switch(this.positionType){case 0:y=t-47;A=u+a;break;case 1:y=t-(D-47);A=u+a;break;case 2:y=w-47;A=x-a-B;break;case 3:y=w-(D-47);A=x-a-B;break;default:y=t-47;A=u+a;break}var E=0;if(this.overlay){E=parseInt(this.overlay.getStyle("zIndex"),10)+1}else{E=Windows.getZIndex()+1}if(Mtime.browser.ie&&Mtime.browser.ie>=7){var s=this.element.getHeight();var v=this.element.getStyle("fontSize");var z=parseInt(v.slice(0,2),10);if(this.element.innerHTML!==""&&s>z+10){y=200}}this.windowElement.setStyle({position:"absolute",top:A+"px",left:y+"px",zIndex:E})}});this.collectBoxId=$(this.collectBox.id);this.isWordWrap(c)}else{this.collectBox=new LeftCardControl({element:c,content:d});this.collectBoxId=$(this.collectBox.id)}if(this.collectBoxId){if(d==""){this.collectBoxId.down("em",0).className=""}this.overCollectBoxIdHandler=this.overCollectBox.bind(this);this.outCollectBoxIdHandler=this.outCollectBox.bind(this);this.collectBoxId.observe("mouseover",this.overCollectBoxIdHandler);this.collectBoxId.observe("mouseout",this.outCollectBoxIdHandler)}},overCollectBox:function(b){Event.stop(b);this.handleOutTimer()},outCollectBox:function(b){Event.stop(b);this.collectBoxTimeout=FunctionExt.defer(function(){if(cardFollowBool==false){this.closeCard()}},500,this)},handleOutTimer:function(){if(this.collectBoxTimeout!=null){clearTimeout(this.collectBoxTimeout);this.collectBoxTimeout=null;this.collectBoxId=null}},isWordWrap:function(B){var C=B.getHeight();var H=B.getStyle("fontSize");var R=parseInt(H.slice(0,2),10);if(B.innerHTML!==""&&C>R+10){var O=B.up(0);var Q=O.getWidth();var D=B.getWidth();var P=Position.cumulativeOffset(O);var J=Position.cumulativeOffset(B);var E=Q-(this.collectBox.elementX-P[0]);var A;var M;var L;var G;var z=this.collectBoxId.down("em",0);if(this.collectBox.elementX<=this.clientx){A=Math.round(E/2);M=this.collectBox.elementX;L=J[1];G=L+C/2}else{var I=B.innerHTML.length;var S=(R*I-E)+(Q-D);A=20;M=P[0];L=J[1]+C/2+5;G=this.collectBox.elementY+this.collectBox.elementHeight;if(this.collectBox.positionType===1){this.collectBox.positionType=0;if(z!==undefined||z!==null){z.className="tl_arrow"}}if(this.collectBox.positionType===3){this.collectBox.positionType=2;if(z!==undefined||z!==null){z.className="bl_arrow"}}}var N=0,T=0;var V=this.collectBoxId.getDimensions();var W=V.width;var U=V.height;var K=M+A;var F=K;if(z!==undefined||z!==null){arrowHeight=z.getHeight()}else{arrowHeight=10}switch(this.collectBox.positionType){case 0:N=F-67;T=G+arrowHeight;break;case 1:N=F-(W-47);T=G+arrowHeight;break;case 2:N=K-67;T=L-arrowHeight-U;break;case 3:N=K-(W-47);T=L-arrowHeight-U;break;default:N=F-67;T=G+arrowHeight;break}this.collectBoxId.setStyle({top:T+"px",left:N+"px"})}},closeCard:function(){if(this.collectBoxId){this.collectBoxId.stopObserving("mouseover",this.overCollectBoxIdHandler);this.collectBoxId.stopObserving("mouseout",this.outCollectBoxIdHandler)}this.collectBoxId=null;this.collectBox.close()},closed:false,close:function(){if(!this.closed){this.closed=true;this.destroyEvent();this.destroyDOM();this.information=null}}});var LeftCardControl=Class.create();Object.extend(LeftCardControl.prototype,{options:{element:null,content:"",closed:false},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.builderLeftCard(this.element,this.content)},builderLeftCard:function(u,v){if(!u){return}var A=u.readAttribute("method");if(A=="tvcard"){u=u.up("dd")}var y=this.getXY(u),s=document.documentElement.clientWidth||document.body.clientWidth,x=u.getWidth(),w=u.getHeight(),B=(s/2)>=y.x?0:1,r=y.y+Math.round(w/2)-60,z=B==1?"r_arrow":"l_arrow",q=B==1?y.x-291:y.x+x+20,C=new Date().getTime();if(A=="tvcard"){q=B==1?y.x-285:y.x+x+14}this.id="dialogBox_"+C;this.windowElement=$(Builder.node("div",{id:this.id,className:"my_layer",style:"top:"+r+"px;left:"+q+"px"},[Builder.node("em",{className:z},[" "]),typeof v=="string"?Builder.build(v):v]));var t=this.getContainer();t.appendChild(this.windowElement);var p=this.windowElement.getHeight();r=y.y+Math.round(w/2)-Math.round(p/2);this.windowElement.style.top=r+"px"},getContainer:function(){var b=$("contentEnd");if(typeof b==="undefined"||b===null){b=document.getElementsByTagName("body")[0]}return b},destroyWindowElement:function(){if(this.windowElement!==null){var b=this.getContainer();b.removeChild(this.windowElement);this.windowElement=null;this.content=null;this.element=null}},getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=Math.round(a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft);k=Math.round(a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop)}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},close:function(){if(!this.closed){this.destroyWindowElement()}}});var MovieLayerControl=Class.create();Object.extend(Object.extend(MovieLayerControl.prototype),{Server:{GetMovieLayerInfoByMovieId:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetMovieLayerInfoByMovieId",[d],c,"/Community.api","get","20000")}},options:{id:0,pagetype:0,callback:null,pan:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent();this.load()},initializeField:function(){},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},close:function(){movieCache=null},load:function(){if(this.id>0){if(typeof movieCache=="undefined"){movieCache={}}if(movieCache[this.id+"_"+this.pagetype]){this.callback&&this.callback(movieCache[this.id+"_"+this.pagetype])}else{this.Server.GetMovieLayerInfoByMovieId(this.id,function(b){if(b&&b.value){movieCache[this.id+"_"+this.pagetype]=this.render(b.value);this.callback&&this.callback(this.render(b.value))}else{this.callback&&this.callback("")}}.bind(this))}}},render:function(e){var d=new StringBuilder();if(this.pagetype==0){d.append('<div class="inner w340">')}else{if(this.pagetype==1){d.append('<div class="inner w270">')}else{}}if(e.movielabel&&e.movielabel!=""){if(this.pagetype==0){d.append(String.format('<i class="ico_thefilm">{0}</i>',e.movielabel))}}if(this.options.pan){d.append('<div class="minfo __r_c_" pan="').append(this.options.pan).append('">')}else{d.append('<div class="minfo">')}if(this.pagetype==0){d.append('<div class="moviepic clearfix">');d.append(String.format('<a href="{0}" class="pic" target="_blank"><img src="{1}" width="96" height="128"></a>',e.moviepage,e.cover))}d.append('<div class="infomovie">');d.append(String.format('<h2><a href="{0}" target="_blank">{1} {2}</a>',e.moviepage,e.titlecn,e.year));if(e.ratingfinal&&e.ratingfinal>0){d.append(String.format('<em class="score">{0}</em>',e.ratingfinal))}d.append("</h2>");if(e.titleen!=""){d.append(String.format("<h3>{0}</h3>",e.titleen))}if(e.runtime==""||e.propertys==""){d.append(String.format('<p class="infocolor">{0}{1}</p>',e.runtime,e.propertys))}else{d.append(String.format('<p class="infocolor">{0} - {1}</p>',e.runtime,e.propertys))}if(this.pagetype==0){if(typeof e.showtimecount!="undefined"&&e.showtimecount>0){d.append(String.format("<p>{0}</p>",e.releasedate));d.append(String.format('<p><a href="{0}" target="_blank">{1}家影院上映{2}场</a><span class="song slink">&gt;</span></p>',e.movieshowtimepage,e.cinemacount,e.showtimecount))}else{if(e.director!=""){d.append(String.format('<p class="infocolor">导演：{0}</p>',e.director))}if(e.actor1!=""||e.actor2!=""){d.append(String.format('<p class="infocolor">主演：{0} {1}</p>',e.actor1,e.actor2))}}}else{if(this.pagetype==1){var f=(typeof e.cinemacount=="undefined"||e.cinemacount<=0)?"":String.format("{0}家影院",e.cinemacount);f+=((typeof e.showtimecount=="undefined"||e.showtimecount<=0)?"":String.format("上映{0}场",e.showtimecount));if(e.releasedate==""||typeof e.showtimecount=="undefined"||e.showtimecount<=0){d.append(String.format("<p>{0}{1}</p>",e.releasedate,f))}else{d.append(String.format("<p>{0} - {1}</p>",e.releasedate,f))}}else{}}if(this.pagetype==0){}else{if(this.pagetype==1){if(e.comments!=""){d.append(String.format('<p class="txtinfo"><i class="ico_quot">&nbsp;</i>{0}</p>',e.comments))}}else{}}d.append("</div>");if(this.pagetype==0){d.append("</div>")}if(typeof e.btntext!="undefined"&&e.btntext!=""){d.append('<div class="mticket">');d.append(String.format('<a href="{0}" target="_blank" class="bm_ticket">{1}</a>',e.movieshowtimepage,e.btntext));if(typeof e.onlineticketcount!="undefined"&&e.onlineticketcount>0){d.append(String.format(" <b>{0}</b> 元起",e.lowestprice))}d.append("</div>")}d.append("</div></div>");return d.toString()}});var TvLayerControl=Class.create();Object.extend(Object.extend(TvLayerControl.prototype),{Server:{GetTvLayerInfoByTvId:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetTvLayerInfoByTvId",[d],c,"/Community.api","get","20000")}},options:{id:0,pagetype:1,callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent();this.load()},initializeField:function(){},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},close:function(){tvCache=null},load:function(){if(this.id>0){if(typeof tvCache=="undefined"){tvCache={}}if(tvCache[this.id+"_"+this.pagetype]){this.callback&&this.callback(tvCache[this.id+"_"+this.pagetype])}else{this.Server.GetTvLayerInfoByTvId(this.id,function(b){if(b&&b.value){tvCache[this.id+"_"+this.pagetype]=this.render(b.value);this.callback&&this.callback(this.render(b.value))}else{this.callback&&this.callback("")}}.bind(this))}}},render:function(B){var s=new StringBuilder();if(this.pagetype==0){s.append('<div class="inner w340">')}else{if(this.pagetype==1){s.append('<div class="inner w270">')}else{}}if(B===null){return}s.append('<div class="tostar">');if(B.actors.length!=0){s.append('<div class="starbox"><h2>主演：</h2>');var p=B.actors;for(var t=0;t<p.length;t++){var q=p[t].alt;var r=p[t].cover;var u=p[t].nameCn;var v=p[t].nameEn;var w=p[t].roleDesc;var y=p[t].roleImage;var A=p[t].roleUrl;var C=p[t].url;var x="";if(w.length>0){if(A.length>0){x=String.format('  <p>饰&nbsp;<a href="{0}" target="_self">{1}</a></p>',A,w)}else{x=String.format("  <p>饰&nbsp;{0}</p>",w)}}var z="";if(y.length>0){if(A.length>0){z=String.format('<a href="{0}" target="_self" title="{1}"><img src="{2}" width="50" height="50" alt="{1}" class="cha" /></a>',A,w,y)}else{z=String.format('<img src="{0}" width="50" height="50" alt="{1}" class="cha" />',y,w)}}s.append(String.format('<dl class="main_actor"><dd>   <a href="{4}" target="_blank" title="{2} {3}"><img src="{1}" width="50" height="50" alt="{0}" class="per"></a>'+(u.length>0?'  <p> <a href="{4}" target="_blank" rel="v:starring">{2}</a> </p>':"")+(v.length>0?'  <p><a href="{4}" target="_blank" rel="v:starring">{3}</a></p>':"")+x+z+"</dd></dl>",q,r,u,v,C))}s.append(String.format('<p class="tr mt15 px12"><a href="{0}">更多<i class="gt"></i></a></p>',B.moreUrl))}else{s.append('<div class="plot"><h2>剧情：</h2>');s.append(String.format('<p class="txtinfo">{0}</p><p class="tr mt15 px12"><a href="{1}">更多<i class="gt"></i></a></p>',B.plot,B.moreUrl))}s.append("</div></div>");return s.toString()}});var PersonLayerControl=Class.create();Object.extend(Object.extend(PersonLayerControl.prototype),{Server:{GetPersonLayerInfoByPersonId:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetPersonLayerInfoByPersonId",[d],c,"/Community.api","get","20000")}},options:{id:0,callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeField();this.initializeEvent();this.load()},initializeField:function(){},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},close:function(){personCache=null},load:function(){if(this.id>0){if(typeof personCache=="undefined"){personCache={}}if(personCache[this.id]){this.callback&&this.callback(personCache[this.id])}else{this.Server.GetPersonLayerInfoByPersonId(this.id,function(b){if(b&&b.value){personCache[this.id]=this.render(b.value);this.callback&&this.callback(this.render(b.value))}else{this.callback&&this.callback("")}}.bind(this))}}},render:function(d){var c=new StringBuilder();c.append('<div class="inner w340">');c.append('<div class="minfo mpeople">');c.append('<div class="moviepic clearfix">');if(d.cover!=""){c.append(String.format('<a href="{0}" class="pic" target="_blank"><img src="{1}" width="96" height="128"></a>',d.personpage,d.cover))}c.append('<div class="infomovie">');c.append("<h2>");if(d.namecn!=""){c.append(String.format('<a href="{0}" target="_blank">{1}</a>',d.personpage,d.namecn))}if(d.ratingfinal!=""&&d.ratingfinal>0){c.append(String.format('<em class="like"><i class="ico_like">&nbsp;</i>{0}%</em>',d.ratingfinal*10))}c.append("</h2>");if(d.nameen!=""){c.append(String.format("<h3>{0}</h3>",d.nameen))}if(d.sex==""||d.constellation==""){c.append(String.format('<p class="infocolor">{0}{1}</p>',d.sex,d.constellation))}else{c.append(String.format('<p class="infocolor">{0}， {1}</p>',d.sex,d.constellation))}if(d.job!=""){c.append(String.format('<p class="infocolor">职业：{0}</p>',d.job))}c.append("</div>");c.append("</div>");if(typeof d.movietitle!="undefined"){c.append(String.format('<div class="mticket link_thefilm "><a href="{0}" target="_blank">{1}：{2}</a><span class="song slink">&gt;</span></div>',d.movieshowtimepage,d.movielabel,d.movietitle))}c.append("</div>");return c.toString()}});var UserLayerControl=Class.create();Object.extend(Object.extend(UserLayerControl.prototype),{Server:{GetUserLayerInfoByUserId:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteCommunityServiceUrl,"Mtime.Community.Services.CommunityService","GetUserLayerInfoByUserId",[d],c,"/Community.api","get","20000")}},options:{id:0,callback:null},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeField();this.initializeEvent();this.load()},initializeDOM:function(){if(typeof cardIsLogin==="undefined"){cardIsLogin=false}},initializeField:function(){},destroyDOM:function(){this.userLayerRegion=null;userCache=null;cardIsLogin=null},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this))},destroyEvent:function(){this.userLayerRegion&&this.userLayerRegion.stopObserving("click",this.clickControlHandler)},load:function(){if(this.id>0){if(typeof(Follow)=="undefined"){$loadJs("/js/2014/Follow.js")}if(typeof userCache=="undefined"){userCache={}}if(userCache[this.id]){this.callback&&this.callback(userCache[this.id]);this.initEvent()}else{this.Server.GetUserLayerInfoByUserId(this.id,function(d){if(d&&d.value){cardIsLogin=d.value.islogin;var c=this.render(d.value);userCache[this.id]=c;this.callback&&this.callback(c);this.initEvent()}else{this.callback&&this.callback("")}}.bind(this))}}},render:function(h){var e=new StringBuilder();e.append('<div id="userLayerRegion" class="inner w340">');e.append('<div class="minfo">');e.append('<div class="moviepic clearfix peoppic">');e.append(String.format('<a href="{0}" class="pic" target="_blank"><img src="{1}" width="70" height="70"></a>',h.mytimepage,h.cover));e.append('<div class="infomovie">');e.append(String.format('<h2><a href="{0}" target="_blank">{1}</a> </h2>',h.mytimepage,h.nickname));e.append(String.format('<p class="infocolor">{0}  {1}</p>',h.address,h.sex));e.append(String.format('<p class="glink">关注<a href="#" target="_blank">{0}</a>粉丝<a href="#" target="_blank">{1}</a>微评<a href="#" target="_blank">{2}</a></p>',h.followcount,h.fanscount,h.tweetcount));e.append("</div>");e.append("</div>");e.append('<div class="movietip">');if(h.intro!=""){e.append(String.format("<p>简介：{0}</p>",h.intro))}if(typeof h.movies!="undefined"&&h.movies.length>0){e.append("<p>最近看过：");for(var f=0;f<h.movies.length;f++){var g=h.movies[f];e.append("《");e.append(g.moviename);e.append("》")}e.append("</p>")}e.append("</div>");if(h.twitterid>0){e.append('<div class="mticket">');if(h.relation==0||h.relation==1){e.append(String.format('<a href="#" method="cFollow" ftwitterid="{0}" nickname="{1}" target="_blank" class="bm_ticket" onclick="return false;">+ 加关注</a><span method="at" nickname="{1}" class="mtxt">@TA</span>',h.twitterid,h.nickname))}else{if(h.relation==2){e.append(String.format('<b class="bm_ticket not_bm_ticket"><i>√</i>已关注<span><a atype="a" method="aFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">取消</a></span></b>',h.twitterid,h.nickname));e.append(String.format('<span class="mtxt"><a method="message" nickname="{1}" href="#" target="_blank" onclick="return false;">发消息</a> | <a method="group" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">分组</a> | <a method="at" nickname="{1}" href="#" target="_blank" onclick="return false;">@TA</a></span>',h.twitterid,h.nickname))}else{if(h.relation==3){e.append(String.format('<b class="bm_ticket not_bm_ticket">粉丝<span><a method="dFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">加关注</a></span></b>',h.twitterid,h.nickname));e.append(String.format('<span class="mtxt"><a method="at" nickname="{0}" href="#" target="_blank" onclick="return false;">@TA</a></span>',h.nickname))}else{if(h.relation==4){e.append(String.format('<b href="#" target="_blank" class="bm_ticket not_bm_ticket">相互关注<span><a atype="a" method="bFollow" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">取消</a></span></b>',h.twitterid,h.nickname));e.append(String.format('<span class="mtxt"><a method="message" nickname="{1}" href="#" target="_blank" onclick="return false;">发消息</a> | <a method="group" ftwitterid="{0}" nickname="{1}" href="#" target="_blank" onclick="return false;">分组</a> | <a method="at" nickname="{1}" href="#" target="_blank" onclick="return false;">@TA</a></span>',h.twitterid,h.nickname))}else{}}}}e.append("</div>")}e.append("</div>");e.append("</div>");return e.toString()},initEvent:function(){this.userLayerRegion=$("userLayerRegion");if(this.userLayerRegion){this.clickControlHandler=this.clickControl.bind(this);this.userLayerRegion.observe("click",this.clickControlHandler);this.follow=new Follow({container:"userLayerRegion",autoGetFollowInfo:false,ischange:true,iscard:true,isuser:true,callback:this.getFollowBool.bind(this)})}},getFollowBool:function(e,d,f){cardFollowBool=d;if(this.id){userCache[this.id]=undefined;this.id=null}},clickControl:function(g){var f=Event.element(g);var j=f.readAttribute("method");switch(j){case"at":if(!cardIsLogin){if(typeof UserLoginDialog!=="undefined"){new UserLoginDialog({callback:function(){location.reload()}})}else{$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}return}var k=f.readAttribute("nickname");new Weibo.TwitterDialog({content:"对@"+k+" 说:"});break;case"message":var k=f.readAttribute("nickname");new Weibo.SendMessageDialog({user:{nickname:k}});break;case"group":var h=f.readAttribute("ftwitterid");var k=f.readAttribute("nickname");new Weibo.FollowSuccDialog({user:{id:h,name:k}});break;case"aFollow":cardFollowBool=true;break;case"bFollow":cardFollowBool=true;break}},close:function(){this.destroyEvent();this.destroyDOM()}});if(typeof(Weibo)=="undefined"){var Weibo=Class.create()}Weibo.PopupUtil=(function(){var a={};a.LoadEditorJs=function(b){if(!Weibo.Editor||!Weibo.Face||!Weibo.Image||!Weibo.Sync||!Weibo.Syntax||!Weibo.Topic||!Weibo.Video||!Weibo.MovieLinker){if(debug){$loadJs(["/js/2011/weibo/editor/editor.js","/js/2011/weibo/editor/image.js","/js/2011/weibo/editor/face.js","/js/2011/weibo/editor/sync.js","/js/2011/weibo/editor/syntax.js","/js/2011/weibo/editor/movieLinker.js","/js/2011/weibo/editor/video.js","/js/2011/weibo/editor/topic.js"],function(){b()})}else{$loadJs("/js/2011/weiboEditor.js",function(){b()})}}else{b()}};var d=Class.create();Object.extend(Object.extend(d.prototype,Window.TooltipWindow.prototype),{addDOM:function(){var b='<div class="eject_outer" style="position: absolute;display:none; "><div class="eject"><p class="directiontag"></p>{0}</div></div>';this.windowElement=Builder.build(String.format(b,this.tipContent))}});a.Tip=function(c,b,f){return new d({element:c,tipContent:b,zIndex:f})};a.Dialog=Class.create();Object.extend(Object.extend(a.Dialog.prototype,Dialog.prototype),{addOverlay:function(){if(typeof this.uniqueId=="undefined"){this.uniqueId=new Date().getTime()}var f="overlay"+this.uniqueId;this.overlay=$(f);if(!this.overlay){var b=this.getContainer();var c=Element.extend(document.createElement("div"));c.id=f;c.setStyle({background:"#000000",filter:"alpha(opacity=80)",opacity:0.8,zoom:1,zIndex:Windows.getZIndex(),position:"absolute",margin:"0px",padding:"0px",top:"0px",left:"0px",width:this.pageDimensions.width+"px",height:this.pageDimensions.height+"px"});b.appendChild(c);this.overlay=c}}});return a})();Weibo.GroupUtil=(function(){var a={};var d=function(h,c,g,b){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService",g,h,c,"/Service/Twitter.msi","get","20000",b)};a.add=function(f,c,b){return d([f],c,"CreateTwitterGroup",b)};a.del=function(f,c,b){return d([f],c,"DeleteTwitterGroup",b)};a.update=function(g,h,c,b){return d([g,h],c,"UpdateTwitterGroup",b)};a.order=function(f,c,b){return d([f],c,"MoveGroupRank",b)};a.groups=function(c,b){if(typeof(scope)!="undefined"&&scope.groups){c&&c()}else{d(null,function(f){if(f&&f.value){typeof(scope)!="undefined"||(scope={});scope.groups=f.value;c&&c(f.value)}},"GetTwitterFollowGroupInfo",b)}};return a})();Weibo.FollowUtil=(function(){var a={};var d=function(h,c,g,b){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService",g,h,c,"/Service/Twitter.msi","get","20000",b)};a.updateGroup=function(h,g,c,b){return d([h,g],c,"UpdateGroupIdsForFTwitter",b)};a.updateRemark=function(h,g,c,b){return d([h,g],c,"UpdateRemarkForFTwitter",b)};a.updateRemarkAndGroups=function(k,h,j,c,b){return d([k,h,j],c,"UpdateRemarkAndGroups",b)};a.getGroupInfo=function(f,c,b){return d([f],c,"GetFTwitterFollowGroupInfo",b)};return a})();Weibo.Dialog=Class.create();Object.extend(Weibo.Dialog.prototype,{options:{},initialize:function(b){this.setOptions(b);this.initializeDom()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},setCursor:function(h,g,e){g=(g==null?h.value.length:g);e=(e==null?0:e);h.focus();if(h.createTextRange){var f=h.createTextRange();f.move("character",g);f.moveEnd("character",e);f.select()}else{h.setSelectionRange(g,g+e)}},initializeDom:function(){},onReady:function(b){},initializeEvent:function(){},onSubmit:function(){this.callback&&this.callback();this.close()},close:function(){this.dialog&&this.dialog.close();this.destroyEvent();this.destroyDOM();this.destroyField()},destroyField:function(){},destroyEvent:function(){},destroyDOM:function(){}});Weibo.FollowSuccDialog=Class.create();Object.extend(Object.extend(Weibo.FollowSuccDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,groupTemplate:'<input name="groupname" class="mr6" type="checkbox" value="#{id}" #{belonged}><label for="groupname">#{name}</label>',dialogTemplate:'<div><p class="clearfix"><span id="title"></span><span class="fr ico_twen" id="help" title="帮助">&nbsp;</span></p><div class="tip_foculist"><ul class="clearfix" id="groups"></ul></div><p class="mt15"><a href="#" onclick="return false;" id="newgroup"><span class="ico_tadd mr6">+</span> 创建分组</a></p><p class="mt5 box_yellow" id="addgroupcontainer"><input name="listname" type="text" class="t_text" id="groupname"><input name="" id="addgroup" type="submit" value="创建" class="btn_gray2 mlr10"><a href="#" onclick="return false;" id="canceladd">取消</a></p><p class="mt9  clearfix"><label for="remarkName" class="fl  mt3">备注姓名：</label><input name="remarkname" type="text" class="t_text w200" id="remarkname"></p></div>',helpTemplate:'<ul><li><span class="song">·</span>在首页可以按规定的分组查看微评</li><li class="mt6"><span class="song">·</span>将已经关注的人进行分组，方便管理</li><li class="mt6"><span class="song">·</span>分组信息是保密的，只有自已可见</li></ul>'},initialize:function(b){this.setOptions(b);if(this.groups&&this.groups.length>0){this.initializeDom()}else{Weibo.FollowUtil.getGroupInfo(this.user.id,function(a){if(a&&a.value){this.groups=a.value;this.initializeDom()}}.bind(this))}},initializeDom:function(){this.dialog=new Dialog({title:"关注成功!",windowClassName:"w420",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(d){this.submitBtn=d.buttonNodes[0];d.getEl("title").innerHTML="为“"+this.user.name+"”选择分组：";this.cancelAdd=d.getEl("canceladd");this.groupul=d.getEl("groups");var j=[];var m=new Template("<li>"+this.groupTemplate+"</li>");for(var k=0,l=this.groups.length,h;k<l;++k){h=this.groups[k];j.push(m.evaluate({id:h.id,name:h.name,belonged:(h.belonged?' checked="checked" ':' "" ')}))}this.groupul.innerHTML=j.join("");if(this.groups.length>16){this.groupul.up().setStyle({height:"235px",overflowX:"hidden",overflowY:"auto"})}this.newGroupButton=d.getEl("newgroup");this.addGroupButton=d.getEl("addgroup");this.addGroupContainer=d.getEl("addgroupcontainer");this.addGroupContainer.hide();this.groupnameInput=d.getEl("groupname");this.helpButton=d.getEl("help");this.remarkNameInput=d.getEl("remarkname");this.helpTip=Weibo.PopupUtil.Tip(this.helpButton,this.helpTemplate,10000);this.initializeEvent()},initializeEvent:function(){this.onAddGroupHandler=this.onAddGroup.bind(this);Event.observe(this.addGroupButton,"click",this.onAddGroupHandler);this.onCancelAddHandler=this.onCancelAdd.bind(this);Event.observe(this.cancelAdd,"click",this.onCancelAddHandler);this.onNewGroupHandler=this.onNewGroup.bind(this);Event.observe(this.newGroupButton,"click",this.onNewGroupHandler)},onSubmit:function(){var k=$$('input[name="groupname"]',this.groupul);var l=[];for(var g=0,h=k.length,j;g<h;++g){j=k[g];if(j.checked){l.push(j.value)}}var m=this.remarkNameInput.value;if(l.length>0||m.length>0){Weibo.FollowUtil.updateRemarkAndGroups(this.user.id,l.join(","),m.trim(),function(a){if(a&&a.value){this.close();this.callback&&this.callback(l,m)}}.bind(this),this.submitBtn)}else{this.close();this.callback&&this.callback(l,m)}},onCancel:function(){this.close()},getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft;k=a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},onShowHelp:function(c){var d=this.getXY(this.helpButton);this.helpDiv.style.left=d.x+30+"px";this.helpDiv.style.top=d.y-55+"px";this.helpDiv.show()},onHideHelp:function(b){this.helpDiv.hide()},onNewGroup:function(b){this.newGroupButton.hide();this.addGroupContainer.show();this.groupnameInput.value=""},onCancelAdd:function(b){this.newGroupButton.show();this.addGroupContainer.hide()},onAddGroupErrorCheck:function(d){var c=null;switch(d.value.groupId){case 0:c="创建分组失败,只能输入英文字母和汉字";break;case -1:c="创建分组失败,分组数量已达上限";break;case -2:c="创建分组失败";break;case -3:c="创建分组失败,分组名称已存在";break}if(c){$alert(c,null,null,4);return false}else{return true}},onAddGroup:function(d){var e=this.groupnameInput.value;var f=Math.ceil(e.bytelength()/2);if(f>0&&f<=10){Weibo.GroupUtil.add(e,function(c){if(c&&Mtime.isValue(c.value)&&this.onAddGroupErrorCheck(c)){this.groupnameInput.value="";var a=c.value.groupId;var b=$(Builder.node("li"));this.groupul.appendChild(b);b.innerHTML=new Template(this.groupTemplate).evaluate({id:a,name:e});this.newGroupButton.show();this.addGroupContainer.hide()}}.bind(this),this.addGroupButton)}else{$alert("请确定分组名不超过20个字符，10个汉字",null,null,4)}},destroyEvent:function(){Event.stopObserving(this.addGroupButton,"click",this.onAddGroupHandler)},destroyDOM:function(){if(this.helpTip){this.helpTip.close();this.helpTip=null}},destroyField:function(){this.onAddGroupHandler=null;this.helpTip=null;this.groupul=null;this.addGroupButton=null;this.groupnameInput=null;this.helpButton=null;this.remarkNameInput=null;this.dialog=null}});Weibo.AddOrUpdateGroupDialog=Class.create();Object.extend(Object.extend(Weibo.AddOrUpdateGroupDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,dialogTemplate:'<div><div class="clearfix"><label for="groupname" class="fl mt3">分组名：</label><span class="fl"><input name="groupname" id="groupname" type="text" class="t_text w155"><br><span class="c_666">不能超过20个字符，10个汉字</span></span></div></div>'},initializeDom:function(){this.dialog=new Dialog({title:(!!this.group?"修改分组":"创建分组"),windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"保存",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.submitBtn=b.buttonNodes[0];this.groupnameInput=b.getEl("groupname");if(!!this.group){this.groupnameInput.value=this.group.name}this.initializeEvent()},initializeEvent:function(){},onAddGroupErrorCheck:function(d){var c=null;switch(d.value.groupId){case 0:c="创建分组失败,只能输入英文字母和汉字";break;case -1:c="创建分组失败,分组数量已达上限";break;case -2:c="创建分组失败";break;case -3:c="创建分组失败,分组名称已存在";break}if(c){$alert(c,null,null,4);return false}else{return true}},onUpdateGroupErrorCheck:function(d){var c=null;switch(d.value){case 0:c="创建分组失败,只能输入英文字母和汉字";break;case -1:case -2:c="创建分组失败";break;case -3:c="创建分组失败,分组名称已存在";break}if(c){$alert(c,null,null,4);return false}else{return true}},onSubmit:function(){this.groupname=this.groupnameInput.value;var b=Math.ceil(this.groupname.bytelength()/2);if(b>0&&b<=10){if(!!this.group){if(this.groupnameInput.value==this.group.name){this.close();return}Weibo.GroupUtil.update(this.group.id,this.groupname,function(a){if(a&&Mtime.isValue(a.value)&&this.onUpdateGroupErrorCheck(a)){this.saveCallback()}}.bind(this),this.submitBtn)}else{Weibo.GroupUtil.add(this.groupname,function(a){if(a&&a.value&&this.onAddGroupErrorCheck(a)){this.saveCallback(a.value.groupId)}}.bind(this),this.submitBtn)}}else{$alert("请确定分组名不超过20个字符，10个汉字",null,null,4)}},saveCallback:function(b){if(this.group){this.group.name=this.groupname}else{this.group={id:b,name:this.groupname}}this.close();this.callback&&this.callback(this.group)},destroyField:function(){this.groupnameInput=null;this.dialog=null}});Weibo.BlackDialog=Class.create();Object.extend(Object.extend(Weibo.BlackDialog.prototype,Weibo.Dialog.prototype),{server:{black:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","AddToBlackList",[f],e,"/Service/Twitter.msi","get","20000",d)}},options:{callback:null,dialogTemplate:'<div><dl class="clearfix"><dt class="fl"><span class="t_worning"></span></dt><dd class="fl w295 ml15"><h4 class="px14">确认将“<span id="blackName"></span>”加入到我的黑名单中吗？</h4><p class="mt5 c_666">你和他将自动解除关注关系，并且他不能在关注你，他不能再给你发评论、私信、@通知</p></dd></dl></div>'},initializeDom:function(){this.dialog=new Dialog({title:"提示",windowClassName:"w425",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.submitBtn=b.buttonNodes[0];b.getEl("blackName").innerHTML=this.person.nickName;this.initializeEvent()},blackErrorCheck:function(d){var c=null;switch(d.value){case -1:c="加入黑名单失败,黑名单已满";break;case 1:c=null;break;default:c="加入黑名单失败";break}if(c){$alert(c,null,null,4);return false}else{return true}},onSubmit:function(){this.server.black(this.person.userId,function(b){if(b&&Mtime.isValue(b.value)&&this.blackErrorCheck(b)){this.close();this.callback&&this.callback()}}.bind(this),this.submitBtn)},onCancel:function(){this.close()}});Weibo.DeleteGroupDialog=Class.create();Object.extend(Object.extend(Weibo.DeleteGroupDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,group:{id:1,name:"Mtime"},dialogTemplate:'<div><h4 class="px14 tc">确定要删除“<span id="groupname"></span>”分组吗？</h4><p class="c_666 mt5 tc">此分组下的人不会被取消关注</p></div>'},initializeDom:function(){this.dialog=new Dialog({title:"提示",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.submitBtn=b.buttonNodes[0];b.getEl("groupname").innerHTML=this.group.name;this.initializeEvent()},onSubmit:function(){Weibo.GroupUtil.del(this.group.id,this.deleteCallback.bind(this),this.submitBtn)},deleteCallback:function(b){if(b&&b.value){this.close();this.callback&&this.callback(this.group)}},onCancel:function(){this.close()}});Weibo.RemoveReplyDialog=Class.create();Object.extend(Object.extend(Weibo.RemoveReplyDialog.prototype,Weibo.Dialog.prototype),{server:{black:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","AddToBlackList",[f],e,"/Service/Twitter.msi","get","20000",d)},DeleteTweetComment:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","DeleteTweetComment",[f],e,"/Service/Twitter.msi","get","20000",d)}},options:{ftwitterid:null,tweetCommentId:null,isShowBlack:true,dialogTemplate:'<div><h4 class="px14 tc">确定要删除该回复吗？</h4><p class="c_666 mt5 tc" _type="blackCtn"><input name="isblack" id="isblack" type="checkbox" value=""><label>同时将此用户加入黑名单</label></p></div>'},initializeDom:function(){this.dialog=new Dialog({title:"提示",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.submitBtn=b.buttonNodes[0];this.blackCtn=b.windowElement.down('p[_type="blackCtn"]');if(this.isShowBlack){this.blackCtn.show();this.isBlackInput=b.getEl("isblack")}else{this.blackCtn.hide()}this.initializeEvent()},blackErrorCheck:function(d){var c=null;switch(d.value){case -1:c="加入黑名单失败,黑名单已满";break;case 1:c=null;break;default:c="加入黑名单失败";break}if(c){$alert(c,null,null,4);return false}else{return true}},onSubmit:function(){this.server.DeleteTweetComment(this.tweetCommentId,function(b){if(b&&b.value){if(this.isShowBlack&&this.isBlackInput.checked){this.server.black(this.ftwitterid,function(a){if(a&&Mtime.isValue(a.value)&&this.blackErrorCheck(a)){}this.close();this.callback&&this.callback()}.bind(this),this.submitBtn)}else{this.close();this.callback&&this.callback()}}else{$alert("删除回复失败",null,null,4)}}.bind(this),this.submitBtn)},onCancel:function(){this.close()},destroyField:function(){this.isBlackInput=null;this.dialog=null}});Weibo.UpdateRemarkDialog=Class.create();Object.extend(Object.extend(Weibo.UpdateRemarkDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,dialogTemplate:'<div><p>给朋友加个备注名，方便认出他是谁</p><p class="mt5 clearfix"><input type="text" id="remark" name=""></p><p class="mt5 c_666">不能超过20个字符，10个汉字</p></div>'},initializeDom:function(){this.dialog=new Dialog({title:!!this.user.remark?"修改备注":"添加备注",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.submitBtn=b.buttonNodes[0];this.remarkInput=b.getEl("remark");this.remarkInput.value=!!this.user.remark?this.user.remark:"";this.initializeEvent()},initializeEvent:function(){},onSubmit:function(){var d=this.remarkInput.value;var c=Math.ceil(d.bytelength()/2);if(c>=0&&c<=10){Weibo.FollowUtil.updateRemark(this.user.id,d,function(a){if(a&&a.value){this.close();this.callback&&this.callback(d)}}.bind(this),this.submitBtn)}else{$alert("备注过长,请修改后提交",null,null,4)}},onCancel:function(){this.close()},destroyField:function(){this.remarkInput=null;this.dialog=null}});Weibo.RTSuccessDialog=Class.create();Object.extend(Object.extend(Weibo.RTSuccessDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,dialogTemplate:'<div><p class="tc bold pt20 px14"><span class="ico_tright">&nbsp;</span> 转发成功</p></div>'},initializeDom:function(){this.dialog=new Dialog({title:"提示",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.initializeEvent()},initializeEvent:function(){},onCancel:function(){this.close()}});Weibo.RepeatRTDialog=Class.create();Object.extend(Object.extend(Weibo.RepeatRTDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,dialogTemplate:'<div><p class="tc px14 bold pt20"><span class="t_worning" style="vertical-align:bottom">&nbsp;</span> 已经转发了,请不要在重复转发!</p></div>'},initializeDom:function(){this.dialog=new Dialog({title:"提示",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.initializeEvent()},initializeEvent:function(){},onCancel:function(){this.close()}});Weibo.SendMessageDialog=Class.create();Object.extend(Object.extend(Weibo.SendMessageDialog.prototype,Weibo.Dialog.prototype),{server:{search:function(f,e,d){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetTwitterUserList",f,e,"/Service/Twitter.msi","get","20000",d)},sendUserMessageToNickName:function(e,d,f){return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.MessageService","SendUserMessageToNicknameCrossDomainByFlash",e,d,"/Service/Message.msi","post","20000",f)}},options:{callback:null,timer:0.5,dialogTemplate:'<div><ul class="t_message"><li><label class="t_txt">收件人：</label><input type="text" class="t_text w295" name="nickname" id="nickname" /><ul class="t_message_box" id="nicknamelist"></ul></li><li class="clearfix mt12"><div class="fr c_orange" id="feedback"></div></li><li class="mt6"><label class="t_txt">内&nbsp;&nbsp;&nbsp;容：</label><textarea name="editor" id="editor" cols="" rows="9" class="wp99"></textarea></li></ul></div>'},initializeDom:function(){this.dialog=new Dialog({title:"发消息",windowClassName:"w580",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"发送",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this),closeCallback:this.close.bind(this)})},getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft;k=a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}},onReady:function(b){this.submitBtn=b.buttonNodes[0];this.nicknameInput=b.getEl("nickname");this.faceButton=b.getEl("face");this.feedback=b.getEl("feedback");this.editorInput=b.getEl("editor");setTimeout(function(){this.setCursor(this.editorInput)}.bind(this),500);Weibo.PopupUtil.LoadEditorJs(function(){this.editor=new Weibo.Editor({editor:this.editorInput,notShortUrl:true});this.editorFeedback=new Weibo.Feedback({editor:this.editor,digitFeedback:{target:this.feedback,normalTemplate:"还可以输入{2}个汉字",warnTemplate:'<span style="color:red"><strong>还可以输入{2}个汉字</strong></span>'}})}.bind(this));if(!!this.user){this.nicknameInput.value=this.user.nickname}this.nicknameList=b.getEl("nicknamelist");this.nicknameList.up().style.zIndex=10000;this.nicknameList.hide();this.nicknameAutoComplete=new SearchAutoComplete({text:this.nicknameInput,textWatermarkText:"请输入会员昵称",listRegion:this.nicknameList,itemTemplate:'<li value="#{Id}" title="#{Nickname}"><a href="#" onclick="return false;" value="#{Id}">#{Nickname}</a></li>',idFieldName:"Id",titleFieldName:"Nickname",searchDatas:null,getSearchDataCallback:function(a){this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout(this.search.bind(this,a),this.timer*1000)}.bind(this),choiceCount:8,onChangeInputCallback:null,onChangeCallback:null,onEnterCallback:null});this.initializeEvent()},initializeEvent:function(){},getError:function(c){var d=null;switch(c){case 0:d="未登录";break;case 10:d="对方拒收信件";break;case 1:d=null;break;case 6:d="收信人不能是你自已";break;case 9:d="对方拒绝接收此类型消息";break;case 12:d="验证码错误";break;case 14:d="内容中含不允许发送的关键字";break;case 15:d="标题中含不允许发送的关键字";break;case 20:d="标题为空";break;case 21:d="内容为空";break;case 22:d="未找到接收用户";break;case 23:d="信息内容长度超过限制";break;case 24:d="发送太频繁，请休息一下";break;default:d="未知错误码："+c;break}if(d){$alert(d,null,null,4);return false}else{return true}},search:function(b){this.server.search([this.nicknameInput.value],function(a){if(a&&a.value){b(a.value)}}.bind(this))},onSubmit:function(){var b=this.editor.getLength();if(this.nicknameInput.value.length>0&&b>0&&b<=this.editor.lengthExp.max){this.server.sendUserMessageToNickName([this.nicknameInput.value,this.editorInput.value],function(a){if(!a){$alert("操作失败，请重试。");return}if(!a.error&&this.getError(a.value)){$alert('<span class="ico_tright">&nbsp;</span> 发送成功',null,null,2);this.close();this.callback&&this.callback()}}.bind(this),this.submitBtn)}else{if(this.nicknameInput.value.length==0){$alert("请输入收件人.",null,null,2)}else{if(b==0){$alert("请输入信息内容.",null,null,2)}else{$alert("信息内容长度超过限制.",null,null,2)}}}},onCancel:function(){this.editor.destroy();this.editor=null;this.dialog.close()},close:function(){if(this.editor){this.editor.destroy();this.editor=null}this.dialog&&this.dialog.close();this.destroyEvent();this.destroyDOM();this.destroyField()},destroyDOM:function(){this.nicknameList&&this.nicknameList.remove()},destroyField:function(){this.nicknameAutoComplete&&(this.nicknameAutoComplete=null);this.nicknameList&&(this.nicknameList=null);this.nicknameInput=null;this.faceButton=null;this.feedback=null;this.dialog=null}});Weibo.GroupRecommendDialog=Class.create();Object.extend(Object.extend(Weibo.GroupRecommendDialog.prototype,Weibo.Dialog.prototype),{server:{getUserJoinedGroups:function(c,d){Mtime.Component.Ajax.callBack("Mtime.MemberCenter.Pages.GroupService","GetUserJoinedGroups",[],c,"/service/group.mc","get","20000",d)}},options:{groups:null,callback:null,dialogTemplate:'<div><p>小提示：</p><p class="line_both mt6">&nbsp;</p><p class=" mt6">请推送到与你日志主题最为接近的群组，最多2个</p><p class="mt6"><input name="groupname" type="text" id="groupname" class="t_text" style="width:280px;" value=""></p><div class="t_glisthidden"><ul class="clearfix col2 mt6" id="groupul"></ul></div><p class="c_red tc mt15">推荐到群组功能需要消耗1个积分</p><p class="mt15">已选群组：</p><p class="line_solid mt6">&nbsp;</p><ul id="selectedGroupUl"></ul></div>',groupTemplate:new Template('<li groupid="#{Id}" groupname="#{Title}"><input type="checkbox" value="#{Id}" name="groupnames" class="mr6"><label for="groupnames">#{Title}</label></li>'),selectedGroupTemplate:new Template('<li class="mt6" groupid="#{Id}" groupname="#{Title}"><input type="checkbox" checked="checked" value="#{Id}" class="mr6"><label>#{Title}</label></li>'),RECOMMEND_GROUP_MAXCOUNT:2},initializeDom:function(){this.dialog=new Dialog({title:"推荐到群组",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(d){var f=d.titleBar.down("h2");var e=Builder.build('<span class="ml15 ico_twen" title="名词解番">&nbsp;</span>');if(f){f.appendChild(e)}this.descTip=Weibo.PopupUtil.Tip(e,"<p>你可以同时将此日志推送到你的群组中，与更多朋友一起分享！</p>",10000);this.groupnameInput=d.getEl("groupname");this.groupul=d.getEl("groupul");if(this.groups){this.editModel=true}this.selectedGroupUl=d.getEl("selectedGroupUl");this.selectHandler=this.select.bind(this);this.server.getUserJoinedGroups(function(m){if(m&&m.value){var c=m.value.List;if(c&&c.length>0){this.searchBox=new SearchBox({textId:this.groupnameInput,textWatermarkText:"请输入群组名称进行搜索",resultRegionId:this.groupul,itemTemplate:this.groupTemplate,searchDatas:c,onClickResultRegion:this.selectHandler});if(this.groups){for(var k=0,l=this.groups.length,b,a;k<l;++k){b=this.groups[k];a=this.groupul.down('li[groupid="'+b.Id+'"]');if(a){this.searchBox.removeSearchData(a,b.Id);this.selectedGroupUl.appendChild(Builder.build(this.selectedGroupTemplate.evaluate(b)))}}}}}}.bind(this));this.cancelSelectHandler=this.cancelSelect.bind(this);this.initializeEvent()},initializeEvent:function(){Event.observe(this.selectedGroupUl,"click",this.cancelSelectHandler)},onSubmit:function(){var f=[];var k=$$("li",this.selectedGroupUl);if((k.length>0&&k.length<=2)||this.editModel){for(var g=0,h=k.length,j;g<h;++g){j=k[g];f.push({Id:j.getAttribute("groupid"),Title:j.getAttribute("groupname")})}this.close();this.callback&&this.callback(f)}},onCancel:function(){this.close()},destroyEvent:function(){this.descTip&&this.descTip.dispose()},destroyField:function(){this.groupnameInput=null;this.groupul=null;this.descTip=null},cancelSelect:function(h){var j=Event.element(h);if(j.tagName.toLowerCase()!="li"){j=j.up("li")}if(j&&j.hasAttribute("groupid")){var e=j.down("input");var l=j.getAttribute("groupid");var m=j.getAttribute("groupname");var k={Id:l,Title:m};this.searchBox.addSearchData(k);j.remove()}},select:function(h){var j=Event.element(h);if(j.tagName.toLowerCase()!="li"){j=j.up("li")}if(j&&j.hasAttribute("groupId")){var e=j.down("input");var l=j.getAttribute("groupid");var m=j.getAttribute("groupname");if($$("li",this.selectedGroupUl).length<this.RECOMMEND_GROUP_MAXCOUNT){var k={Id:l,Title:m};this.searchBox.removeSearchData(j,l);this.selectedGroupUl.appendChild(Builder.build(this.selectedGroupTemplate.evaluate(k)))}else{if(e.checked){e.checked=false}}}}});Weibo.GroupOrderDialog=Class.create();Object.extend(Object.extend(Weibo.GroupOrderDialog.prototype,Weibo.Dialog.prototype),{server:{order:function(f,e,d){return appManager.$callback("/Service/Twitter.mt",f,e,d,"MovieGroupRank")}},options:{callback:null,selected:0,groupTemplate:'<li class="#{class}"><a href="#" onclick="return false;" idx="#{idx}">#{name}</a></li>',dialogTemplate:'<div><p class="mt9">分组名</p><p class="mt6 line_solid">&nbsp;</p><div class="clearfix"><ul class="t_gedit" id="group"></ul><div class="t_geditbar"> <span class="ico_twup" title="上移" id="up">&nbsp;</span> <span class="ico_twdown" title="下移" id="down">&nbsp;</span> </div></div></div>'},initializeDom:function(){this.dialog=new Dialog({title:"调整分组顺序",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){Weibo.GroupUtil.groups(function(){this.groups=scope.groups.clone();this.groupul=b.getEl("group");this.submitBtn=b.buttonNodes[0];this.upbtn=b.getEl("up");this.downbtn=b.getEl("down");this.renderGroup();this.initializeEvent()}.bind(this),null)},initializeEvent:function(){this.upHandler=this.up.bind(this);this.downHandler=this.down.bind(this);this.selectHandler=this.select.bind(this);Event.observe(this.upbtn,"click",this.upHandler);Event.observe(this.downbtn,"click",this.downHandler);Event.observe(this.groupul,"click",this.selectHandler)},select:function(c){var d=Event.element(c);this.selected=parseInt(d.getAttribute("idx"));this.renderGroup()},up:function(){var f,d=this.groups[this.selected];if(this.selected==0){d=this.groups.shift();this.groups.push(d);f=this.groups.length-1}else{f=this.selected-1;var e=this.groups[f];this.groups.splice(this.selected,1,this.groups.splice(f,1,d)[0])}this.selected=f;this.renderGroup()},down:function(){var d,c=this.groups[this.selected];if(this.selected==this.groups.length-1){c=this.groups.pop();this.groups.unshift(c);d=0}else{d=this.selected+1;this.groups.splice(this.selected,1,this.groups.splice(d,1,c)[0])}this.selected=d;this.renderGroup()},renderGroup:function(){var g=[];for(var h=0,j=this.groups.length,k=new Template(this.groupTemplate),f;h<j;h++){f=Object.clone(this.groups[h]);f.idx=h;if(this.selected==h){f["class"]="on"}g.push(k.evaluate(f))}this.groupul.innerHTML=g.join("")},onSubmit:function(){var f=[];for(var g=0,h=this.groups.length,e;g<h;++g){e=this.groups[g];f.push(e.id)}Weibo.GroupUtil.order(f.join(","),this.orderCallback.bind(this),this.submitBtn)},orderCallback:function(b){if(b&&b.value){this.close();scope.groups=this.groups;this.callback&&this.callback(this.groups)}},onCancel:function(){this.close()},destroyEvent:function(){Event.stopObserving(this.upbtn,"click",this.upHandler);Event.stopObserving(this.downbtn,"click",this.downHandler);Event.stopObserving(this.groupul,"click",this.selectHandler)},destroyField:function(){this.upHandler=null;this.downHandler=null;this.selectHandler=null;this.groupul=null;this.upbtn=null;this.downbtn=null}});Weibo.DadgeDialog=Class.create();Object.extend(Object.extend(Weibo.DadgeDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,dadge:{id:1,name:"手机达人",desc:"邀请10人开通微评并绑定手机，即可获得这枚勋章。现在就去邀请",time:new Date()},dialogTemplate:'<div><div class="p12 bg_e8e8e8"><p class="tc"><span class="ico_tele"></span></p><p class="tc c_green mt9" id="time"></p></div><p class="tc p12" id="desc"></p><p class="tc"><span class="ico_set"></span><a class="c_000" href="#">显示设置</a></p></div>'},initializeDom:function(){this.dialog=new Dialog({title:this.dadge.name,windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"查看我的勋章",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){b.getEl("desc").innerHTML=this.dadge.desc;b.getEl("time").innerHTML="于 "+this.dadge.time.toString()+" 获得";this.initializeEvent()},initializeEvent:function(){},onCancel:function(){this.close()}});Weibo.RTDialog=Class.create();Object.extend(Object.extend(Weibo.RTDialog.prototype,Weibo.Dialog.prototype),{server:{GetTweetRenderHtml:function(d,c){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetTweetRenderHtml",d,c,"/Service/Twitter.msi","get","20000")},GetForwardToFriendTweetRender:function(d,c){Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetForwardToFriendTweetRender",d,c,"/Service/Twitter.msi","get","20000")},ForwardTweet:function(f,e,d){return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.TwitterService","ForwardTweetCrossDomainByFlash",f,e,"/Service/Twitter.msi","post","20000",d)},searchNickname:function(d,c){return Mtime.Component.Ajax.get("Mtime.Service.Pages.TwitterService","GetTwitterUserList",d,c,"/Service/Twitter.msi","get","20000")},sendUserMessageToNickName:function(e,d,f){return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.MessageService","SendUserMessageToNicknameCrossDomainByFlash",e,d,"/Service/Message.msi","post","20000",f)}},options:{callback:null,channel:"weibo",tweetId:null,timer:1,friendTweetContent:"",dialogTemplate:'<div><div class="my_ttab"><ul class="clearfix"><li class="on"><a href="#" onclick="return false;" id="weibort">转发到微评</a><span></span></li><li class=""><a href="#" onclick="return false;" id="friendrt">消息给好友</a><span></span></li></ul></div><p class="line_both">&nbsp;</p><div class="bg_fff p12 mt12 wbr" id="weibortc" style=""></div><ul class="t_message" id="friendrtc" style="display: none; "><li class="mt15"><label class="t_txt mt3">收件人：</label><input type="text" name="" class="t_text w200" _type="nickname"><ul class="t_message_box" _type="nicknamelist"></ul></li></ul><ul class="t_message"><li class="mt15 clearfix"><div class="fl" id="face"><span class="select_faces mr3" style="display:inline-block;"></span>&nbsp;表情</div><div id="feedback" class="fr c_orange"></div></li><li class="mt9"><label class="t_txt">内&nbsp;&nbsp;&nbsp;容：</label><textarea id="editor" class="wp99" rows="6" cols="" name=""></textarea><div id="isReplyCtn"><p class="mt6"><input type="checkbox" class="mr6" id="isReply" />同时回复给&nbsp;原作者</p></div></li></ul></div>'},initializeDom:function(){this.dialog=new Dialog({title:"",windowClassName:"w580",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"发送",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this),closeCallback:this.close.bind(this)})},onReady:function(b){this.submitBtn=b.buttonNodes[0];this.weibortButton=b.getEl("weibort");this.friendrtButton=b.getEl("friendrt");this.weibortContainer=b.getEl("weibortc");this.friendrtContainer=b.getEl("friendrtc");this.faceBtn=b.getEl("face");this.editorInput=b.getEl("editor");this.isReply=b.getEl("isReply");this.isReplyCtn=b.getEl("isReplyCtn");Weibo.PopupUtil.LoadEditorJs(function(){this.editor=new Weibo.Editor({editor:this.editorInput});setTimeout(function(){this.setCursor(this.editor.editor)}.bind(this),500);this.editorFeedback=new Weibo.Feedback({editor:this.editor,digitFeedback:{target:b.getEl("feedback"),normalTemplate:"<span>{0}</span>/<strong>{1}</strong>字",warnTemplate:'<span style="color:red">{0}</span>/<strong>{1}</strong>字'}});new Weibo.AtSyntax({editor:this.editor});new Weibo.MovieSyntax({editor:this.editor});new Weibo.Face({editor:this.editor,addButton:this.faceBtn})}.bind(this));this.nicknameInput=this.friendrtContainer.down('input[_type="nickname"]');this.nicknameList=this.friendrtContainer.down('ul[_type="nicknamelist"]');this.nicknameList.up().style.zIndex=10;this.nicknameList.hide();this.nicknameAutoComplete=new SearchAutoComplete({text:this.nicknameInput,listRegion:this.nicknameList,itemTemplate:'<li value="#{Id}" title="#{Nickname}"><a href="#" onclick="return false;" value="#{Id}">#{Nickname}</a></li>',idFieldName:"Id",titleFieldName:"Nickname",searchDatas:null,getSearchDataCallback:function(a){this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout(this.searchNickname.bind(this,a),this.timer*1000)}.bind(this),choiceCount:8,onChangeInputCallback:null,onChangeCallback:null,onEnterCallback:null});this.switchChannel();this.renderTweet();this.renderFriendTweet();this.initializeEvent()},initializeEvent:function(){this.switchWeiboChannelHandler=this.switchChannel.bind(this,"weibo");this.switchFriendChannelHandler=this.switchChannel.bind(this,"friend");Event.observe(this.weibortButton,"click",this.switchWeiboChannelHandler);Event.observe(this.friendrtButton,"click",this.switchFriendChannelHandler)},searchNickname:function(b){this.server.searchNickname([this.nicknameInput.value],function(a){if(a&&a.value){b(a.value)}}.bind(this))},renderFriendTweet:function(){this.server.GetForwardToFriendTweetRender([this.tweetId],function(b){if(b&&b.value){this.friendTweetContent="转发微评"+b.value}}.bind(this))},onWeiboErrorCheck:function(d){var c=null;switch(d.value){case -5:c="原作者微评正在审核中，如有不便敬请谅解!";break;case -9:case -4:case -3:case -2:case 0:c="转发微评失败";break;case -1:c="转发微评失败,内容过长";break;case -11:c="转发微评失败,您被禁言";break;case -10:c="转发微评失败,内容包含敏感词";break;case -20:c="你发布的速度太快了，休息一下吧：）";break}if(c){$alert(c,null,null,4);return false}else{return true}},onSubmit:function(){var b=this.editor.getLength();switch(this.channel){case"weibo":if(b>=0&&b<=this.editor.lengthExp.max){if(b==0){this.editorInput.value="转发微评"}this.server.ForwardTweet([this.editorInput.value,this.tweetId,this.isReply.checked,(this.isReplyRT?this.isReplyRT.checked:false)],function(a){if(a&&a.value&&this.onWeiboErrorCheck(a)){$alert('<span class="ico_tright">&nbsp;</span> 转发成功',null,null,2);this.close();this.callback&&this.callback(a.value)}}.bind(this),this.submitBtn)}else{this.editorFeedback.flickerWarn()}break;case"friend":if(this.nicknameInput.value.length>0&&b>0&&b<=this.editor.lengthExp.max){this.server.sendUserMessageToNickName([this.nicknameInput.value,this.editorInput.value],function(a){if(!a){$alert("操作失败，请重试。");return}if(!a.error&&Mtime.isValue(a.value)&&this.sendMessageErrorCheck(a.value)){$alert('<span class="ico_tright">&nbsp;</span> 发送成功',null,null,2);this.close();this.callback&&this.callback()}}.bind(this),this.submitBtn)}else{if(this.nicknameInput.value.length==0){$alert("请输入收件人.",null,null,2)}else{if(b==0){$alert("请输入信息内容.",null,null,2)}else{$alert("信息内容长度超过限制.",null,null,2)}}}break;default:break}},sendMessageErrorCheck:function(c){var d=null;switch(c){case 0:d="未登录";break;case 10:d="对方拒收信件";break;case 1:d=null;break;case 6:d="收信人不能是你自已";break;case 9:d="对方拒绝接收此类型消息";break;case 12:d="验证码错误";break;case 14:d="内容中含不允许发送的关键字";break;case 15:d="标题中含不允许发送的关键字";break;case 20:d="标题为空";break;case 21:d="内容为空";break;case 22:d="未找到接收用户";break;default:d="未知错误码："+c;break}if(d){$alert(d,null,null,4);return false}else{return true}},onCancel:function(){this.editor.destroy();this.editor=null;this.dialog.close()},close:function(){if(this.editor){this.editor.destroy();this.editor=null}this.dialog.close()},renderTweet:function(){this.server.GetTweetRenderHtml([this.tweetId],function(d){if(d&&d.value){this.weibortContainer.innerHTML=d.value.renderHtml;if(d.value.nickname){var c=$(Builder.build(String.format('<p class="mt6"><input type="checkbox" class="mr6" />同时回复给&nbsp;{0}</p>',d.value.nickname)));this.isReplyCtn.insertBefore(c,this.isReplyCtn.firstChild);this.isReplyRT=c.down("input")}}}.bind(this))},switchChannel:function(c,d){if(c==null||this.channel!=c){!c&&(c=this.channel);this.weibortContainer.hide();this.friendrtContainer.hide();this.weibortButton.up("li").className="";this.friendrtButton.up("li").className="";switch(this.channel){case"weibo":this.weiboTweetContent=this.editorInput.value;break;case"friend":this.friendTweetContent=this.editorInput.value;break}switch(c){case"weibo":this.weibortButton.up("li").className="on";this.weibortContainer.show();this.editorInput.value=this.weiboTweetContent;this.faceBtn.show();this.isReplyCtn.show();break;case"friend":this.friendrtButton.up("li").className="on";this.friendrtContainer.show();this.editorInput.value=this.friendTweetContent;this.faceBtn.hide();this.isReplyCtn.hide();break;default:break}setTimeout(function(){this.setCursor(this.editorInput,0)}.bind(this),100);this.channel=c}},destroyEvent:function(){Event.stopObserving(this.weibortButton,"click",this.switchWeiboChannelHandler);Event.stopObserving(this.friendrtButton,"click",this.switchFriendChannelHandler)},destroyDOM:function(){},destroyField:function(){this.switchWeiboChannelHandler=null;this.switchFriendChannelHandler=null;this.weibortButton=null;this.friendrtButton=null;this.weibortContainer=null;this.friendrtContainer=null}});Weibo.InformDialog=Class.create();Object.extend(Object.extend(Weibo.InformDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,weibo:{id:1,text:"Hello MTime",user:{id:1,name:"anhulife",nick:"猫鱼酱"}},types:[{id:1,name:"违法信息"},{id:2,name:"恶意广告"},{id:3,name:"色情暴力"}],waterMarkText:"您可以详细描述恶意行为(如图片中的不良信息)",typeTemplate:'<li><input type="checkbox" name="type" value="#{id}" id="type#{id}" /><label for="type#{id}">#{name}</label></li>',dialogTemplate:'<div><p id="title"></p><p class="mt3"><textarea name="" cols="" rows="6" class="mt3 wp99" id="text" disabled="disabled"></textarea></p><p class="mt9">举报类型：</p><ul class="clearfix col3 mt6" id="type"></ul><p class="mt9">举报说明(可填)：</p><p class="mt5 clearfix  "><input type="text" value="" class="t_text" style="width:280px;" id="desc" name="desc"/></p></div>'},initializeDom:function(){this.dialog=new Dialog({title:"举报不良信息",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(d){this.title=d.getEl("title");this.text=d.getEl("text");this.type=d.getEl("type");this.desc=d.getEl("desc");this.title.innerHTML=String.Format("你举报的{0}(@{1})的微评：",[this.weibo.user.nick,this.weibo.user.name]);var k=[];for(var g=0,h=this.types.length,j=new Template(this.typeTemplate);g<h;++g){k.push(j.evaluate(this.types[g]))}this.type.innerHTML=k.join("");this.text.value=this.weibo.text;this.desc.value=this.waterMarkText;this.waterMarkFlag=true;this.initializeEvent()},initializeEvent:function(){this.waterMarkBlur.bind(this);this.waterMarkFocus.bind(this);Event.observe(this.desc,"blur",this.waterMarkBlur.bind(this));Event.observe(this.desc,"focus",this.waterMarkFocus.bind(this))},waterMarkBlur:function(b){if(this.desc.value.length==0){this.desc.value=this.waterMarkText;this.waterMarkFlag=true}else{this.waterMarkFlag=false}},waterMarkFocus:function(b){if(this.waterMarkFlag){this.desc.value="";this.waterMarkFlag=false}},onSubmit:function(){var k=[],j=$$('input[name="type"]',this.type);for(var f=0,g=j.length,h;f<g;++f){h=j[f];if(h.checked){k.push(h.value)}}if(k.length>0){this.callback&&this.callback(k,(this.waterMarkFlag?"":this.desc.value));this.close()}},onCancel:function(){this.close()},destroyEvent:function(){},destroyDOM:function(){},destroyField:function(){}});Weibo.UserLoginDialog=Class.create();Object.extend(Object.extend(Weibo.UserLoginDialog.prototype,Weibo.Dialog.prototype),{server:{getUser:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","GetUserInfo2",[],b,"/utility/managerservice.m","get","10000")},signIn:function(j,m,l,k,o,n,h){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","SignIn",[j,m,l,k,o,n],h,"/utility/managerservice.m","get","10000")},refreshVcode:function(b){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","RefreshVcode",[],b,"/utility/managerservice.m","get","10000")}},options:{callback:null,dialogTemplate:'<form><dl class="login_userinfo"><dd><label data-login="account-label">登录帐号：</label><input type="text" name="account" class="t_text w175"></dd><dd><label>登录密码：</label><input type="password" name="password" class="t_text w175"><a href="http://my.mtime.com/member/forget_password/" class="ml6">忘记密码？</a></dd><dd data-login="vcode-input-ctn" style="display: none;"><label>验证码：</label><input type="text" name="vcode" class="t_text c_a5" value="" style="width:115px;"></dd><dd data-login="vcode-image-ctn" style="display: none;"><img src="" data-login="vcode-image" class="mr12 v_m"><a href="#" onclick="return false;" data-login="vcode-refresh-btn">刷新</a></dd><dd><input type="checkbox" data-login="auto" name="" value="">下次自动登录</dd></dl><p class="tc mt15 "><input type="button" value="免费注册" data-login="signup" class="t_btn_gray_i bold mr8 "><input type="submit" data-selector="submit" value="登录" class="t_btn_blue_i bold "></p></form>'},initialize:function(b){this.setOptions(b);this.initializeUser()},initializeUser:function(){this.server.getUser(function(){if(typeof getUserInfoResult!=="undefined"&&Mtime.isValue(getUserInfoResult)){var b=getUserInfoResult.value;this.user={id:b.userId,nickname:b.nickName,homeUrl:b.homeUrl,headSrc:b.headSrc,isSaveEmail:b.isSaveEmail,isAutoExit:b.isAutoExit,email:b.email,enableMobileLogin:b.enableMobileLogin||false,customizeMenus:typeof b.CustomizeMenus==="undefined"?null:b.CustomizeMenus}}this.initializeDom()}.bind(this))},initializeDom:function(){this.dialog=new Dialog({title:"会员登录",windowClassName:"w375",content:this.dialogTemplate,readyCallback:this.onReady.bind(this)})},onReady:function(e){var f=e.windowElement;this.emailLabel=f.down('label[data-login="account-label"]');this.emailInput=f.down('input[name="account"]');this.passInput=f.down('input[name="password"]');this.isAutoSign=f.down('input[data-login="auto"]');this.signInBtn=f.down('input[data-selector="submit"]');this.signUpBtn=f.down('input[data-login="signup"]');this.vcodeInputCtn=f.down('dd[data-login="vcode-input-ctn"]');this.vcodeInput=f.down('input[name="vcode"]');this.vcodeImageCtn=f.down('dd[data-login="vcode-image-ctn"]');this.vcodeImage=f.down('img[data-login="vcode-image"]');this.vcodeRefreshBtn=f.down('a[data-login="vcode-refresh-btn"]');this.form=f.down("form");e.buttonRegion.hide();var d=this.emailInput;if(this.user){if(this.user.enableMobileLogin){this.emailLabel.innerHTML="登录帐号："}if(this.user.isSaveEmail){this.emailInput.value=this.user.email;d=this.passInput}}setTimeout(function(){this.setCursor(d)}.bind(this),500);this.initializeEvent()},initializeEvent:function(){this.signinHandler=this.signin.bind(this);Event.observe(this.form,"submit",this.signinHandler);this.signupHandler=this.signup.bind(this);Event.observe(this.signUpBtn,"click",this.signupHandler);this.checkAccountHandler=this.checkAccount.bind(this);Event.observe(this.emailInput,"change",this.checkAccountHandler);this.checkPasswordHandler=this.checkPassword.bind(this);Event.observe(this.passInput,"change",this.checkPasswordHandler);this.refreshVcodeHandler=this.refreshVcode.bind(this);Event.observe(this.vcodeRefreshBtn,"click",this.refreshVcodeHandler)},refreshVcode:function(b){this.server.refreshVcode(function(a){if(a&&a.value&&a.value.id){this.vcodeImageCtn.show();this.vcodeInput.value="";this.vcodeInput.focus();this.vcodeId=a.value.id;this.vcodeImage.src=a.value.src}}.bind(this))},checkAccount:function(){var c=this.emailInput.value.trim(),d=true;if(this.user&&this.user.enableMobileLogin){if(!Validator.Email.test(c)&&!Validator.MobilePhone.test(c)){this.emailInput.addClassName("new_input_false");d=false}else{this.emailInput.removeClassName("new_input_false")}}else{if(!Validator.Email.test(c)){this.emailInput.addClassName("new_input_false");d=false}else{this.emailInput.removeClassName("new_input_false")}}return d},checkPassword:function(){var c=this.passInput.value,d=true;if(!Validator.Password.test(c)){this.passInput.addClassName("new_input_false");d=false}else{this.passInput.removeClassName("new_input_false")}return d},checkVcode:function(){var d=this.vcodeInput.value.trim(),c=true;if(!d){this.vcodeInput.addClassName("new_input_false");c=false}else{this.vcodeInput.removeClassName("new_input_false")}return c},signup:function(){var b=siteMcUrl+"/member/signin/?redirectUrl="+encodeURIComponent(location.href);location.href=b},signin:function(e){Event.stop(e);var d=this.emailInput.value;var f=$encodePassword(this.passInput.value);if(this.checkAccount()&&this.checkPassword()&&(!this.vcodeId||this.checkVcode())&&!this.lock){this.lock=true;this.signInBtn.setAttribute("disabled","disabled");this.server.signIn(d,f,true,false,this.vcodeId||"",this.vcodeId?this.vcodeInput.value:"",function(a){this.lock=false;this.signInBtn.removeAttribute("disabled");if(a&&a.value){if(a.value.success){this.close();this.callback&&this.callback(a.value)}else{if(a.value.isShieldStatus){this.close();this.showSecurityRiskDialog(a.value.shieldTip)}else{if(a.value.needResetPassword){this.close();this.showResetPwdDialog(a.value.resetPasswordUrl)}else{if(a.value.redirect){$redirect(a.value.message)}else{if(a.value.isRobot){this.vcodeInputCtn.show();if(!a.value.vcodeValid){this.vcodeInput.addClassName("new_input_false")}this.refreshVcode();return}else{this.vcodeInputCtn.hide();this.vcodeImageCtn.hide();this.vcodeId=null}this.emailInput.addClassName("new_input_false");this.passInput.addClassName("new_input_false")}}}}}}.bind(this))}},showSecurityRiskDialog:function(b){this.securityRiskDialog=new Dialog({title:"提示",windowClassName:"w375",content:'<div class="yahei px14 tc bold">'+b+"</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){a.close()}.bind(this)}]})},showResetPwdDialog:function(b){this.needResetPwdDialog=new Dialog({title:"账户已被保护，请找回密码",windowClassName:"w375",content:'<div class="yahei px14 tc bold"><p>您长时间未登录，账户已被安全保护。</p><p class="mt5">请点击按钮激活账户，然后去注册邮箱找回密码。</p></div>',buttonRegionClass:"tip_btnbox",buttons:[{title:"激活并找回密码",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){location.href=b}.bind(this)}]})},onCancel:function(){this.close()},destroyEvent:function(){Event.stopObserving(this.form,"submit",this.signinHandler);Event.stopObserving(this.signUpBtn,"click",this.signupHandler);Event.stopObserving(this.emailInput,"change",this.checkAccountHandler);Event.stopObserving(this.passInput,"change",this.checkPasswordHandler);Event.stopObserving(this.vcodeRefreshBtn,"click",this.refreshVcodeHandler)},destroyDOM:function(){},destroyField:function(){}});Weibo.VoteAddDialog=Class.create();Object.extend(Object.extend(Weibo.VoteAddDialog.prototype,Weibo.Dialog.prototype),{server:{createVote:function(o,m,l,h,k,j,n){Mtime.Component.Ajax.callBack("Mtime.MemberCenter.Pages.SimpleVoteService","CreateVote",[o,m,l,h,k],j,"/service/simplevote.mc","post","20000",n)}},options:{callback:null,vote:null,dialogTemplate:'<div class="myray" id="container"><p class="mt6 clearfix"><label class="fl mt3 mr6" for="">标题</label><input type="text" class="t_text fl w200" name="" id="title"></p><div id="option"><p class="mt6 clearfix"><label class="fl mt3 mr6" for="">选项</label><input type="text" name="option" class="t_text fl w200"></p><p class="mt6 clearfix"><input type="text" name="option" class="t_text fl w200 ml30"></p><p class="mt6 clearfix"><input type="text" name="option" class="t_text fl w200 ml30"></p></div><p class="mt12"><label class="fl mr6" for="">类型</label><input name="type" type="radio" value="single" id="single" checked="checked">单选<input name="type" type="radio" value="muti" id="muti" class="ml6">多选<span id="optionCount" style="" class="ml3">最多选项数<span class="ml3"><input id="optionCountInput" type="text" class="t_text w40"></span></span></p><p class="mt12">结束时间</p><p class=" mt5"><input name="voteExpirDay" type="radio" value="1" checked="checked">7天<input name="voteExpirDay" type="radio" value="2" class="ml6">10天<input name="voteExpirDay" type="radio" value="3" class="ml6">30天<input name="voteExpirDay" type="radio" value="4" class="ml6">60天<input name="voteExpirDay" type="radio" value="5" class="ml6">不限制</p><span id="feedback" class="c_orange"></span></div>',optionTemplate:'<p class="mt6 clearfix"><input type="text" name="option" value="{0}" class="t_text fl w200 ml30"></p>'},initializeDom:function(){this.dialog=new Dialog({title:"添加一个投票",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.submitBtn=b.buttonNodes[0];this.container=b.getEl("container");this.title=this.container.down("#title");this.optionContainer=this.container.down("#option");this.options=$$('input[name="option"]',this.container);this.single=this.container.down("#single");this.muti=this.container.down("#muti");this.optionCount=this.container.down("#optionCount");this.optionCountInput=this.container.down("#optionCountInput");this.feedback=this.container.down("#feedback");this.optionCount.hide();this.addOptionHandler=this.addOption.bind(this);this.toggleOptionCountHandler=this.toggleOptionCount.bind(this);if(this.vote){this.renderVote()}setTimeout(function(){this.setCursor(this.title)}.bind(this),500);this.initializeEvent()},initializeEvent:function(){Event.observe(this.options[this.options.length-1],"click",this.addOptionHandler);Event.observe(this.muti,"click",this.toggleOptionCountHandler);Event.observe(this.single,"click",this.toggleOptionCountHandler)},onSubmit:function(){var m=[];var u=this.title.value.trim();var s=[];for(var o=0,q=this.options.length,t;o<q;++o){t=this.options[o];if(t.value.trim().length>0){s.push(t.value.trim())}}var p=this.single.checked;if(u.length===0){m.push("请输入投票标题！")}if(u.bytelength()>30){m.push("标题不要超过30个字！")}if(s.length<2){m.push("请至少输入两个投票选项！")}else{for(var o=0,l=s.lenngth;o<l;o++){if(s[o].bytelength()>20){m.push(String.Format("选项{0}不要超过20个字！",o))}}}var r=this.optionCountInput.value;if(!p){if(/^\d+$/.test(r)){r=parseInt(r,10);if(r>s.length||r<0){m.push("最大允许投票项数应大于０且不超过最大项数！")}}else{m.push("最大允许投票项数请输入数字！")}}var n=Utility.Dom.getSelectedValues("voteExpirDay",1);if(m.length>0){this.feedback.innerHTML=m.join("<br />")}else{this.feedback.innerHTML="";this.server.createVote(u,s.join("|"),p,r,n,function(a){if(a&&a.value&&a.value.success){this.close();this.callback&&this.callback(a.value.vote)}else{this.feedback.innerHTML="创建投票失败，请稍候重试！"}}.bind(this),this.submitBtn)}},renderVote:function(){this.title.value=this.vote.Title;var f=[];for(var d=0,e=this.vote.VoteItems.length;d<e;++d){if(d==0){f.push(String.format('<p class="mt6 clearfix"><label for="" class="fl mt3 mr6">选项</label><input type="text" class="t_text fl w200" value="{0}" name="option"></p>',this.vote.VoteItems[d].Description))}else{f.push(String.format(this.optionTemplate,this.vote.VoteItems[d].Description))}}this.optionContainer.innerHTML=f.join("");this.options=$$('input[name="option"]',this.container);this.muti.checked=!this.vote.Type;this.single.checked=!!this.vote.Type;this.toggleOptionCount()},onCancel:function(){this.close()},addOption:function(){Event.stopObserving(this.options[this.options.length-1],"click",this.addOptionHandler);var b=$(Builder.build(String.format(this.optionTemplate,"")));this.optionContainer.appendChild(b);this.options.push(b.down("input"));Event.observe(this.options[this.options.length-1],"click",this.addOptionHandler)},toggleOptionCount:function(){if(this.muti.checked){this.optionCountInput.value="";this.optionCount.show()}else{this.optionCount.hide()}}});Weibo.TwitterDialog=Class.create();Object.extend(Object.extend(Weibo.TwitterDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,content:null,imagePath:null,imageUrl:null,dialogTemplate:'<div><div class="my_overall"><div class="my_editor"><div class="my_textarea_region" _type="bg_feedback"><textarea _type="weibo_editor" class="my_textarea"></textarea></div><div class="mt6 clearfix"><div class="my_post fl"><div class="my_options"><ul><li _type="movie_linker"><span class="select_movie"></span><a href="#" onclick="return false;">电影/影人</a></li><li _type="imageregion"><div><span class="select_image"></span>图片</div></li><li _type="face_select"><span class="select_faces"></span><a href="#" onclick="return false;">表情</a></li><li _type="weibo_video"><span class="select_video"></span><a href="#" onclick="return false;">视频</a></li><li _type="weibo_topic"><span class="select_topic"></span><a href="#" onclick="return false;">话题</a></li></ul></div></div><div class="fr mt6"><p class="tr" _type="digit_feedback"></p><p class="mt3 song tr"><input type="checkbox" _type="weibo_sync"><label class="ml6">同步</label><a _type="sync_config" onclick="return false;" href="#">[设置]</a></p></div></div></div></div><div class="my_movie" style="display:none;" _type="linkedMovie"></div></div>',relatedId:0,relatedObjId:0},initializeDom:function(){this.dialog=new Dialog({title:"写微评",windowClassName:"w660",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"发布",buttonStyle:"btn_blue mr12",callback:function(){}},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this),closeCallback:this.close.bind(this)})},onReady:function(d){var f=d.windowElement;if(typeof f.down(".myray")!="undefined"){f.down(".myray").style.paddingBottom="40px"}var e=f.down('[_type="weibo_editor"]');this.content&&(e.value=this.content);setTimeout(function(){this.setCursor(e)}.bind(this),500);Weibo.PopupUtil.LoadEditorJs(function(){this.editor=new Weibo.Editor({editor:e,cacheable:(this.content?false:true)});new Weibo.Feedback({editor:this.editor,backgroundFeedback:{target:f.down('[_type="bg_feedback"]'),normalColor:"#FFF",warnColor:"#FD9999",start:-620,end:0},digitFeedback:{target:f.down('[_type="digit_feedback"]'),normalTemplate:"<span>{0}</span>/<strong>{1}</strong>字",warnTemplate:'<span style="color:red">{0}</span>/<strong>{1}</strong>字'}});new Weibo.Publisher({editor:this.editor,pubButton:d.buttonNodes[0],callback:this.onSubmit.bind(this)});new Weibo.AtSyntax({editor:this.editor});new Weibo.MovieSyntax({editor:this.editor});new Weibo.Face({editor:this.editor,addButton:f.down('[_type="face_select"]')});new Weibo.MovieLinker({editor:this.editor,linkButton:f.down('[_type="movie_linker"]'),linkedMovieContainer:f.down('[_type="linkedMovie"]'),relatedId:this.relatedId,relatedObjId:this.relatedObjId});setTimeout(function(){new Weibo.Image({editor:this.editor,imageRegion:f.down('[_type="imageregion"]'),initImagePath:this.imagePath,initImageUrl:this.imageUrl})}.bind(this),500);new Weibo.Video({editor:this.editor,addButton:f.down('[_type="weibo_video"]')});new Weibo.Topic({editor:this.editor,addButton:f.down('[_type="weibo_topic"]')});new Weibo.Sync({editor:this.editor,configButton:f.down('[_type="sync_config"]'),syncButton:f.down('[_type="weibo_sync"]')})}.bind(this));this.initializeEvent()},initializeEvent:function(){},onSubmit:function(){this.close();this.callback&&this.callback()},onCancel:function(){this.editor.destroy();this.editor=null;this.dialog.close()},close:function(){if(this.editor){this.editor.destroy();this.editor=null}this.dialog&&this.dialog.close();this.destroyEvent();this.destroyDOM();this.destroyField()},destroyEvent:function(){},destroyDOM:function(){},destroyField:function(){}});Weibo.SyncConfigDialog=Class.create();Object.extend(Object.extend(Weibo.SyncConfigDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,syncContent:null,contentTemplate:new Template('<li><input name="" type="checkbox" #{check} sync="#{sync}" value=""><label for="">&nbsp;#{label}</label></li>'),dialogTemplate:'<div><div class="tip_foculist" style="margin-top:0;"><ul class="clearfix" id="content"></ul></div></div>'},initializeDom:function(){this.dialog=new Dialog({title:"同步到站外的内容",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(h){this.content=h.getEl("content");var d=[];for(var j=0,k=this.syncContent.length,c;j<k;++j){c=this.syncContent[j];d.push(this.contentTemplate.evaluate({sync:c.id,label:c.label,check:c.check?'checked="checked"':""}))}this.content.innerHTML=d.join("");this.syncChk=$$('input[type="checkbox"]',this.content);this.initializeEvent()},initializeEvent:function(){},onSubmit:function(){var h={};for(var e=0,f=this.syncChk.length,g;e<f;++e){g=this.syncChk[e];h[g.getAttribute("sync")]=g.checked}this.close();this.callback&&this.callback(h)},onCancel:function(){this.close()}});Weibo.FollowTopicDialog=Class.create();Object.extend(Object.extend(Weibo.FollowTopicDialog.prototype,Weibo.Dialog.prototype),{server:{followTopic:function(f,e,d){return appManager.$callback("/service/twitter.mt",{topic:f},e,d,"AddFollowTopic")}},options:{callback:null,dialogTemplate:'<div><div class="clearfix"><label for="topic" class="fl mt3">话题名：</label><span class="fl"><input name="topic" id="topic" type="text" class="t_text w155"><br><span class="c_666">不能超过30个字符，15个汉字</span></span></div></div>'},initializeDom:function(){this.dialog=new Dialog({title:"添加关注的话题",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.onSubmit.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.onCancel.bind(this)}],readyCallback:this.onReady.bind(this)})},onReady:function(b){this.submitBtn=b.buttonNodes[0];this.topicInput=b.getEl("topic");this.initializeEvent()},initializeEvent:function(){},followErrorCheck:function(d){var c=null;switch(d.value){case -3:c="关注的话题数量已达上限";break;case -1:c="非法的话题内容";break;case -2:case 0:c="添加失败";break}if(c){$alert(c,null,null,4);return false}else{return true}},onSubmit:function(){var d=this.topicInput.value;var c=Math.ceil(d.bytelength()/2);if(c>0&&c<=15){this.server.followTopic(d,function(a){if(a&&Mtime.isValue(a.value)&&this.followErrorCheck(a)){this.close();this.callback&&this.callback(d)}else{$alert("关注话题失败.",null,null,4)}}.bind(this),this.submitBtn)}else{if(c==0){$alert("请输入话题.",null,null,4)}else{$alert("话题长度超过规定.",null,null,4)}}},onCancel:function(){this.close()},destroyField:function(){this.remarkInput=null;this.dialog=null}});Weibo.AlertDialog=Class.create();Object.extend(Object.extend(Weibo.AlertDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,delay:null,message:"",dialogTemplate:'<div><dl class="clearfix"><dt class="fl"><span class="t_worning"></span></dt><dd class="fl w295 ml15">{0}</dd></dl></div>'},initializeDom:function(){this.dialog=new Dialog({title:"提示",windowClassName:"w425",content:String.format(this.dialogTemplate,this.message),buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.close.bind(this)}],readyCallback:this.onReady.bind(this),closeCallback:this.close.bind(this)})},onReady:function(b){this.initializeEvent()},initializeEvent:function(){if(this.delay){setTimeout(this.close.bind(this),this.delay*1000)}},close:function(){this.dialog&&this.dialog.close();this.dialog=null;this.callback&&this.callback();this.callback=null}});Weibo.ConfirmDialog=Class.create();Object.extend(Object.extend(Weibo.ConfirmDialog.prototype,Weibo.Dialog.prototype),{options:{callback:null,message:"",dialogTemplate:'<div><dl class="clearfix"><dt class="fl"><span class="t_worning"></span></dt><dd class="fl w295 ml15">{0}</dd></dl></div>'},initializeDom:function(){this.dialog=new Dialog({title:"提示",windowClassName:"w425",content:String.format(this.dialogTemplate,this.message),buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue mr12",callback:this.okclose.bind(this)},{title:"取消",buttonStyle:"btn_gray",callback:this.cancelclose.bind(this)}],readyCallback:this.onReady.bind(this),closeCallback:this.close.bind(this)})},onReady:function(b){this.initializeEvent()},initializeEvent:function(){},okclose:function(){this.dialog&&this.dialog.close();this.dialog=null;this.callback&&this.callback();this.callback=null},cancelclose:function(){this.dialog&&this.dialog.close();this.dialog=null}});Weibo.BirthdayDialog=Class.create();Object.extend(Object.extend(Weibo.BirthdayDialog.prototype,Weibo.Dialog.prototype),{server:{send:function(f,e,d){return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.MessageService","SendUserMessageToNicknameCrossDomainByFlash",f,e,"/Service/Message.msi","post","20000",d)}},options:{callback:null,nickname:null,dialogTemplate:'<div><p>赠言</p><p class="mt3"><textarea name="" cols="" rows="6" class="mt3 wp99" _type="text"></textarea></p><p class="mt9 tr" _type="countfeedback">0/210字</p></div>'},initializeDom:function(){this.dialog=new Dialog({title:"提示",windowClassName:"w345",content:this.dialogTemplate,buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",buttonStyle:"btn_blue",callback:this.send.bind(this)}],readyCallback:this.onReady.bind(this),closeCallback:this.close.bind(this)})},onReady:function(d){var f=d.windowElement;this.sendBtn=d.buttonNodes[0];var e=this;Weibo.PopupUtil.LoadEditorJs(function(){e.editor=new Weibo.Editor({editor:f.down('[_type="text"]')});new Weibo.Feedback({editor:e.editor,digitFeedback:{target:f.down('[_type="countfeedback"]'),normalTemplate:"<span>{0}</span>/<strong>{1}</strong>字",warnTemplate:'<span style="color:red">{0}</span>/<strong>{1}</strong>字'}});setTimeout(function(){e.editor.insertText("dear "+e.nickname+"，祝你生日快乐")},200)})},initializeEvent:function(){},destroyEvent:function(){this.editor&&this.editor.destroy();this.editor=null},getError:function(c){var d=null;switch(c){case 0:d="未登录";break;case 10:d="对方拒收信件";break;case 1:d=null;break;case 6:d="收信人不能是你自已";break;case 9:d="对方拒绝接收此类型消息";break;case 12:d="验证码错误";break;case 14:d="内容中含不允许发送的关键字";break;case 15:d="标题中含不允许发送的关键字";break;case 20:d="标题为空";break;case 21:d="赠言内容为空";break;case 22:d="未找到接收用户";break;case 23:d="赠言内容长度超过限制";break;default:d="未知错误码："+c;break}if(d){$alert(d,null,null,4);return false}else{return true}},send:function(){var b=this.editor.getLength();if(b>0&&b<=this.editor.lengthExp.max){this.server.send([this.nickname,this.editor.editor.value],function(a){if(!a){$alert("发送失败，请重试。");return}if(!a.error&&this.getError(a.value)){$alert('<span class="ico_tright">&nbsp;</span> 发送赠言成功',null,null,2);this.close();this.callback&&this.callback()}}.bind(this),this.submitBtn)}else{if(b==0){$alert("请输入赠言内容.",null,null,2)}else{$alert("赠言内容长度超过限制.",null,null,2)}}}});Weibo.OnlineTicketUserLoginDialog=Class.create();Object.extend(Object.extend(Weibo.OnlineTicketUserLoginDialog.prototype,Weibo.UserLoginDialog.prototype),{options:{callback:null,anonymousCallback:null,dialogTemplate:'<form><dl class="login_userinfo"><dd><label data-login="account-label">登录帐号：</label><input type="text" name="account" class="t_text w175"></dd><dd><label>登录密码：</label><input type="password" name="password" class="t_text w175"><a href="http://my.mtime.com/member/forget_password/" class="ml6">忘记密码？</a></dd><dd data-login="vcode-input-ctn" style="display: none;"><label>验证码：</label><input type="text" name="vcode" class="t_text c_a5" value="" style="width:115px;"></dd><dd data-login="vcode-image-ctn" style="display: none;"><img src="" data-login="vcode-image" class="mr12 v_m"><a href="#" onclick="return false;" data-login="vcode-refresh-btn">刷新</a></dd><dd><input type="checkbox" data-login="auto" name="" value="">下次自动登录</dd></dl><p class="tc mt15 "><input type="button" value="免费注册" data-login="signup" class="t_btn_gray_i bold mr8 "><input type="submit" value="登录" data-selector="submit" class="t_btn_blue_i bold "></p><p class="mt10 tr mr25 c_666"><span class="c_red dib v_m mr6 ">* </span>会员登录后，可查询订单，享受更多会员服务</p></form>'},initializeDom:function(){this.dialog=new Dialog({title:"会员登录",windowClassName:"w375",content:this.dialogTemplate,readyCallback:this.onReady.bind(this),addTitleDOM:function(){return Builder.build('<div><h2 class="share_tit  edit_s_t">会员购票<em class="s_t_jiao">&nbsp;</em></h2><p class="tick_btn"><a href="#" data-login="anonymous" onclick="return false;" class="px14">非会员购票<em class="s_t_buy">&nbsp;</em></a></p></div>')}})},onReady:function(b){this.anonymousBtn=b.windowElement.down('a[data-login="anonymous"]');Weibo.UserLoginDialog.prototype.onReady.apply(this,[b])},initializeEvent:function(){Weibo.UserLoginDialog.prototype.initializeEvent.apply(this);this.anonymousHandler=this.anonymous.bind(this);Event.observe(this.anonymousBtn,"click",this.anonymousHandler)},anonymous:function(){this.close();this.anonymousCallback&&this.anonymousCallback()},destroyEvent:function(){Weibo.UserLoginDialog.prototype.destroyEvent.apply(this);Event.stopObserving(this.anonymousBtn,"click",this.anonymousHandler)},destroyDOM:function(){},destroyField:function(){}});var CommunityHeadImgLoginControl=Class.create();Object.extend(CommunityHeadImgLoginControl.prototype,{vcodeId:null,EMAIL_TIP:"输入电子邮箱地址或手机号",PASSWORD_TIP:"输入密码",VCODE_TIP:"输入验证码",server:{refreshVcode:function(c,d){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","RefreshVcode",[],c,"/utility/managerservice.m","get","10000",d)},signIn:function(k,n,m,l,q,p,j,o){return Mtime.Component.Ajax.get("Mtime.Community.Controls.CommunityPages.ManagerService","SignIn",[k,n,m,l,q,p],j,"/utility/managerservice.m","get","10000",o)}},options:{mcUrl:""},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeDOM();this.initializeEvent();this.initializeControl();this.load()},initializeDOM:function(){this.titleCn=$("communityLoginTitleCn");this.titleEn=$("communityLoginTitleEn");this.noTitle=$("communityLoginNoTitle");this.emailInput=$("communityLoginEmail");this.passInput=$("communityLoginPassword");this.isAutoSign=$("communityLoginIsAutoSign");this.signInBtn=$("communityLoginSignIn");this.vcodeRegion=$("communityLoginVcodeRegion");this.vcodeInput=$("communityLoginVcodeText");this.vcodeImage=$("communityLoginVcodeImage");this.vcodeRefreshBtn=$("communityLoginVcodeRefresh")},destroyDOM:function(){this.titleCn=null;this.titleEn=null;this.emailInput=null;this.passInput=null;this.isAutoSign=null;this.signInBtn=null;this.vcodeRegion=null;this.vcodeInput=null;this.vcodeImage=null;this.vcodeRefreshBtn=null},initializeEvent:function(){this.blurTextHandler=this.blurText.bind(this);Event.observe(this.emailInput,"blur",this.blurTextHandler);Event.observe(this.passInput,"blur",this.blurTextHandler);Event.observe(this.vcodeInput,"blur",this.blurTextHandler);this.focusTextHandler=this.focusText.bind(this);Event.observe(this.emailInput,"mouseup",this.focusTextHandler);Event.observe(this.emailInput,"focus",this.focusTextHandler);Event.observe(this.passInput,"mouseup",this.focusTextHandler);Event.observe(this.passInput,"focus",this.focusTextHandler);Event.observe(this.vcodeInput,"mouseup",this.focusTextHandler);Event.observe(this.vcodeInput,"focus",this.focusTextHandler);this.checkAccountHandler=this.checkAccount.bind(this);Event.observe(this.emailInput,"change",this.checkAccountHandler);this.checkPasswordHandler=this.checkPassword.bind(this);Event.observe(this.passInput,"change",this.checkPasswordHandler);this.checkIsAutoSignHandler=this.checkIsAutoSign.bind(this);Event.observe(this.isAutoSign,"click",this.checkIsAutoSignHandler);this.refreshVcodeHandler=this.refreshVcode.bind(this);Event.observe(this.vcodeRefreshBtn,"click",this.refreshVcodeHandler);this.signinHandler=this.signin.bind(this);Event.observe(this.signInBtn,"click",this.signinHandler)},destroyEvent:function(){Event.stopObserving(this.emailInput,"blur",this.blurTextHandler);Event.stopObserving(this.passInput,"blur",this.blurTextHandler);Event.stopObserving(this.vcodeInput,"blur",this.blurTextHandler);Event.stopObserving(this.emailInput,"mouseup",this.focusTextHandler);Event.stopObserving(this.emailInput,"focus",this.focusTextHandler);Event.stopObserving(this.passInput,"mouseup",this.focusTextHandler);Event.stopObserving(this.passInput,"focus",this.focusTextHandler);Event.stopObserving(this.vcodeInput,"mouseup",this.focusTextHandler);Event.stopObserving(this.vcodeInput,"focus",this.focusTextHandler);Event.stopObserving(this.emailInput,"change",this.checkAccountHandler);Event.stopObserving(this.passInput,"change",this.checkPasswordHandler);Event.stopObserving(this.isAutoSign,"click",this.checkIsAutoSignHandler);Event.stopObserving(this.vcodeRefreshBtn,"click",this.refreshVcodeHandler);Event.stopObserving(this.signInBtn,"click",this.signinHandler)},initializeControl:function(){},destroyControl:function(){if(this.securityRiskDialog){this.securityRiskDialog.close();this.securityRiskDialog=null}if(this.needResetPwdDialog){this.needResetPwdDialog.close();this.needResetPwdDialog=null}},load:function(){},blurText:function(j){var g=Event.element(j),f=g.value.trim();if(f===""){if(g===this.emailInput){g.value=this.EMAIL_TIP}else{if(g===this.passInput){g.removeAttribute("type");g.value=this.PASSWORD_TIP}else{if(g===this.vcodeInput){g.value=this.VCODE_TIP}}}var k=g.up();var h=k.down("em");if(h.hasClassName("ico_false")){h.removeClassName("ico_false")}}},focusText:function(f){var e=Event.element(f),d=e.value.trim();if(d===this.EMAIL_TIP){e.value=""}else{if(d===this.PASSWORD_TIP){e.value="";e.setAttribute("type","password")}else{if(d===this.VCODE_TIP){e.value=""}}}},checkAccount:function(){var d=this.emailInput.value.trim(),e=this.emailInput.up().down("em"),f=true;if(!Validator.Email.test(d)&&!Validator.MobilePhone.test(d)){e.addClassName("ico_false");f=false}else{e.removeClassName("ico_false")}return f},checkPassword:function(){var e=this.passInput.value,d=this.passInput.up().down("em"),f=true;if(!Validator.Password.test(e)){d.addClassName("ico_false");f=false}else{d.removeClassName("ico_false")}return f},checkVcode:function(){var f=this.vcodeInput.value.trim(),d=this.vcodeInput.up().down("em"),e=true;if(!f){d.addClassName("ico_false");e=false}else{d.removeClassName("ico_false")}return e},checkIsAutoSign:function(){if(this.isAutoSign.className==="i_loginchecked"){this.isAutoSign.removeClassName("i_loginchecked");this.isAutoSign.addClassName("i_logincheck")}else{this.isAutoSign.removeClassName("i_logincheck");this.isAutoSign.addClassName("i_loginchecked")}},refreshVcode:function(b){this.server.refreshVcode(function(a){if(a&&a.value&&a.value.id){this.vcodeInput.value="";this.vcodeInput.focus();this.vcodeId=a.value.id;this.vcodeImage.src=a.value.src}}.bind(this),this.vcodeRefreshBtn)},signin:function(e){Event.stop(e);var d=this.emailInput.value;var f=$encodePassword(this.passInput.value);if(this.checkAccount()&&this.checkPassword()&&(!this.vcodeId||this.checkVcode())){this.server.signIn(d,f,true,false,this.vcodeId||"",this.vcodeId?this.vcodeInput.value:"",function(a){if(a&&a.value){if(a.value.success){$redirect(this.mcUrl)}else{if(a.value.isShieldStatus){this.showSecurityRiskDialog(a.value.shieldTip)}else{if(a.value.needResetPassword){this.showResetPwdDialog(a.value.resetPasswordUrl)}else{if(a.value.redirect){$redirect(a.value.message)}else{if(a.value.isRobot){this.titleCn.hide();this.titleEn.hide();this.noTitle.show();this.vcodeRegion.show();if(!a.value.vcodeValid){this.vcodeInput.up().down("em").addClassName("ico_false")}this.refreshVcode();return}else{this.noTitle.hide();this.vcodeRegion.hide();this.vcodeId=null;this.titleCn.show();this.titleEn.show()}this.emailInput.up().down("em").addClassName("ico_false");this.passInput.up().down("em").addClassName("ico_false")}}}}}}.bind(this),this.signInBtn)}},showSecurityRiskDialog:function(b){this.securityRiskDialog=new Dialog({title:"提示",windowClassName:"w375",content:'<div class="yahei px14 tc bold">'+b+"</div>",buttonRegionClass:"tip_btnbox",buttons:[{title:"确定",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){a.close()}.bind(this)}]})},showResetPwdDialog:function(b){this.needResetPwdDialog=new Dialog({title:"账户已被保护，请找回密码",windowClassName:"w375",content:'<div class="yahei px14 tc bold"><p>您长时间未登录，账户已被安全保护。</p><p class="mt5">请点击按钮激活账户，然后去注册邮箱找回密码。</p></div>',buttonRegionClass:"tip_btnbox",buttons:[{title:"激活并找回密码",keyCode:Event.KEY_RETURN,buttonStyle:"t_btn_blue_i bold",callback:function(a){location.href=b}.bind(this)}]})},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM();this.vcodeId=null}});var CityMenuControl=Class.create();Object.extend(CityMenuControl.prototype,{server:{getData:function(b){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){b&&b()}else{$loadJs("/Utility/Data/TheaterListBoxData.m",b)}},getTheaterCityHomeURL:function(c,d){if(typeof theaterService==="undefined"){return Mtime.Component.Ajax.callBack("Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}else{return Mtime.Component.Ajax.request(theaterService,"Mtime.Showtime.Pages.ShowtimeService","GetTheaterCityHomeURL",[c],d,"/service/showtime.ms","get","25000")}}},options:{items:[],hotSearchItems:[290,292,293,365,974,366,561,880,791],HOTROWSIZE:10,order:"热门",container:"",isTip:true,triggerElement:"",optionTS:"<li><a value=#{Id}>#{NameCn}</a></li>",boxLimitHeight:false,clickCallBack:null,callBack:null,content:{regRxpAG:["A","B","C","D","E","F","G"],regRxpHL:["H","I","J","K","L"],regRxpMT:["M","N","O","P","Q","R","S","T"],regRxpWZ:["U","V","W","X","Y","Z"]}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.optionTemplate=new Template(this.optionTS);this.initializeDOM();this.initializeEvent();this.getItems()},initializeDOM:function(){var p="";this.firstBool=false;this.isTip1=this.isTip;if(this.isTip){this.headPanel=$(this.triggerElement);var m=this.getXY(this.headPanel);var k=m.y;var j=0;if(m.x>=560){j=m.x-560}else{j=m.x}var q=Windows.getZIndex()+1;p="display: none; width: 560px; position: absolute; top: "+k+"px; left: "+j+"px;z-index:"+q;this._parentNode=Builder.node("div",{className:"showfilm userbar",style:p});m=k=j=q=null}else{this.container=$(this.container);this._parentNode=Builder.node("div",{className:"showfilm userbar",style:"display: none;"})}this.closeNode=Builder.node("span",{className:"btn_close fr"},["关闭"]);this.contentBox=Builder.node("div");this.searchCityText=Builder.node("input",{type:"text",className:"text"});this.tab=Builder.node("span",{className:"cityletter"},[Builder.node("a",{href:"#",onclick:"return false;",className:"on",_v:"热门"},["热门",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"A-G"},["A-G",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"H-L"},["H-L",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"M-T"},["M-T",Builder.node("b",[" "])]),Builder.node("a",{href:"#",onclick:"return false;",_v:"W-Z"},["W-Z",Builder.node("b",[" "])])]);this.span=Builder.node("span",{className:"fl w30 bold mt5"});this.bodyPanel=$(Builder.node("div",{id:"showtime_tip",className:"showtime_tip"},[Builder.node("div",{className:"share_tit clearfix"},[this.closeNode,Builder.node("div",{className:"citysearch"},[this.searchCityText]),this.tab]),Builder.node("div",{className:"p15"},[this.contentBox])]));if(this.headPanel){this._parentNode.appendChild(this.bodyPanel);document.body.appendChild(this._parentNode)}else{if(this.container){this._parentNode.appendChild(this.bodyPanel);var o=this.container.up();o.appendChild(this._parentNode)}}var l=this.tab.childNodes;for(var n=0;n<l.length;n++){Event.observe(l[n],"click",function(c){var a=c.target||c.srcElement;if(a.innerHTML!==this.order){$A(this.tab.childNodes).each(function(d){d.className=""});a.className="on";var b=a.readAttribute("_v");this.order=b;this.reload(b)}}.bind(this))}if(!this.isTip&&this.container){this.headPanel=this.container}},initializeEvent:function(){this.ononSearchCityTextFocusHandler=this.onSearchCityTextFocus.bind(this);this.onSearchCityTextBlurHandler=this.onSearchCityTextBlur.bind(this);this.onCloseHandler=this.hide.bind(this);Event.observe(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);Event.observe(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);if(this.headPanel){this.onHeadPanelClickHandler=this.onHeadPanelClick.bind(this);Event.observe(this.headPanel,"click",this.onHeadPanelClickHandler)}Event.observe(this.closeNode,"click",this.onCloseHandler);this.onClickPageHandler=this.onClickPage.bindAsEventListener(this);Event.observe(document.body,"click",this.onClickPageHandler)},destroyEvent:function(){this.ononSearchCityTextFocusHandler&&Event.stopObserving(this.searchCityText,"focus",this.ononSearchCityTextFocusHandler);this.onSearchCityTextBlurHandler&&Event.stopObserving(this.searchCityText,"blur",this.onSearchCityTextBlurHandler);this.onCloseHandler&&Event.stopObserving(this.closeNode,"click",this.onCloseHandler)},destroyPanel:function(){this.closeNode=null;this.contentBox=null;this.searchCityText=null;this.tab=null;this.span=null;this.bodyPanel=null;this.headPanel=null;this._parentNode=null},close:function(){this.destroyEvent();this.destroyPanel()},onClickPage:function(e){var d=Event.element(e);var f=d.up(".showtime_tip");if(this.isTip&&f!==this.bodyPanel){if(this.isShowing()){this.hide()}}},getHotItems:function(){if(!this.hotItems){this.hotItems=this.items.sortBy(function(b){return -b.OTicketCinemaCount}).slice(0,40).sortBy(function(b){return -b.VisitedTimes}).collect(function(b){return b.Id})}return this.hotItems},reload:function(k){this.contentBox.update();var f=null;switch(k){case"热门":if(!this.content.HOT){this.content.HOT=this.createOptions(this.getCitys(this.items,this.getHotItems())," ",true)}this.contentBox.update(this.content.HOT);if(this.boxLimitHeight){this.contentBox.style.overflowY="";this.contentBox.style.height=""}break;case"A-G":if(!this.content.AG){f=this.items.findAll(function(a){var b=/[A-G]/.test(a.initial);return b});this.content.AG=this.makeNodes(f,this.content.regRxpAG)}this.contentBox.update(this.content.AG);if(this.boxLimitHeight){this.contentBox.style.overflowY="auto";this.contentBox.style.height="410px"}break;case"H-L":if(!this.content.HL){f=this.items.findAll(function(a){var b=/[H-L]/.test(a.initial);return b});this.content.HL=this.makeNodes(f,this.content.regRxpHL)}this.contentBox.update(this.content.HL);if(this.boxLimitHeight){this.contentBox.style.overflowY="auto";this.contentBox.style.height="410px"}break;case"M-T":if(!this.content.MT){f=this.items.findAll(function(a){var b=/[M-T]/.test(a.initial);return b});this.content.MT=this.makeNodes(f,this.content.regRxpMT)}this.contentBox.update(this.content.MT);if(this.boxLimitHeight){this.contentBox.style.overflowY="auto";this.contentBox.style.height="410px"}break;case"W-Z":if(!this.content.WZ){f=this.items.findAll(function(a){var b=/[M-Z]/.test(a.initial);return b});this.content.WZ=this.makeNodes(f,this.content.regRxpWZ)}this.contentBox.update(this.content.WZ);if(this.boxLimitHeight){this.contentBox.style.overflowY="auto";this.contentBox.style.height="410px"}break;default:break}var j=this.contentBox.getElementsByTagName("li");for(var h=0,g=j.length;h<g;h++){Event.observe(j[h],"click",function(b){var a=b.target||b.srcElement;this.command(a.getAttribute("value"))}.bind(this))}},makeNodes:function(h,k){var o=new StringBuilder();for(var l=0,j=k.length;l<j;l++){var n=k[l];var m=h.findAll(function(a){return a.initial===n}).sortBy(function(a){return -a.VisitedTimes});if(m.length>0){o.append(this.createOptions(m,n))}}return o.toString()},getItems:function(){this.locations=[];this.server.getData(function(){if(typeof threaterListBoxData!=="undefined"&&threaterListBoxData.locations){this.locations=threaterListBoxData.locations.List}this.items=[];this.locations.each(function(c){var d={Id:c.Id,NameCn:c.NameCn,NameEn:c.NameEn,initial:c.NameEn.charAt(0).toLocaleUpperCase(),PinyinShort:c.PinyinShort||"",VisitedTimes:c.VisitedTimes,OTicketCinemaCount:c.OTicketCinemaCount};this.items.push(d)}.bind(this));this.reload("热门");this.cityAutoComplete=new CityAutoCompleteControl({text:this.searchCityText,textWatermarkText:"直接输入城市或城市拼音",listRegion:this.contentBox,itemTemplate:'<li value="#{Id}"><span class="fl">#{NameEn}</span><span class="fr">#{NameCn}</span></li>',idFieldName:"Id",titleFieldName:"NameCn",searchDatas:this.items,defaultSearchDatas:this.getCitys(this.items,this.hotSearchItems),choiceCount:9,doCommand:this.command.bind(this),onEnterCallback:function(f){var h=this.contentBox.getElementsByTagName("li");for(var g=0,e=h.length;g<e;g++){if(h[g].className==="on"){this.command(h[g].getAttribute("value"));break}}}.bind(this)})}.bind(this))},createOptions:function(k,h,j){var l=Builder.node("div");var m=new StringBuilder();m.append('<div class="city_list2 clearfix">');m.append('<span class="fl w30 bold mt5">'+h+"</span>");m.append("<ul>");for(var g=0;g<k.length;g++){if(j&&g!==0&&(g%this.HOTROWSIZE===0)){m.append('</ul><span class="fl w30 bold mt5"> </span><ul>')}m.append(this.optionTemplate.evaluate(k[g]))}m.append("</ul>");m.append("</div>");return m.toString()},onSearchCityTextFocus:function(){$A(this.tab.childNodes).each(function(b){b.className=""})},onSearchCityTextBlur:function(b){this.order=null},onHeadPanelClick:function(f){f&&Event.stop(f);if(this.isShowing()){this.hide()}else{if(this.isTip1&&!this.firstBool&&this.headPanel&&this._parentNode){this.firstBool=true;var e=this.getXY(this.headPanel);var d=e.y;this._parentNode.style.top=d+"px"}this.show()}this.clickCallBack&&this.clickCallBack()},isShowing:function(){return(this._parentNode.style.display!="none")},show:function(){this._parentNode.show()},hide:function(){this._parentNode.hide()},command:function(b){if(b!==null){this.callBack&&this.callBack(b)}},getCitys:function(o,l){var m=[];for(var n=0;n<l.length;n++){var k=l[n];var j=this.getCity(o,k);if(j!==null){m.push(j)}}if(m.length<l.length){var q=l.length-m.length;for(var p=0;p<o.length;p++){if(q===0){break}if(!l.include(o[p].Id)){m.push(o[p]);q--}}}return m},getCity:function(h,e){for(var f=0,g=h.length;f<g;f++){if(e==h[f].Id){return h[f]}}return null},getXY:function(h){var j=0,k=0;if(h.getBoundingClientRect){var a=h.getBoundingClientRect();var b=document.documentElement;j=Math.round(a.left+Math.max(b.scrollLeft,document.body.scrollLeft)-b.clientLeft);k=Math.round(a.top+Math.max(b.scrollTop,document.body.scrollTop)-b.clientTop)}else{for(;h!=document.body;j+=h.offsetLeft,k+=h.offsetTop,h=h.offsetParent){}}return{x:j,y:k}}});var CityAutoCompleteControl=Class.create();Object.extend(Object.extend(CityAutoCompleteControl.prototype,AutoCompleteBase.prototype),{initialize:function(b){this.baseInitialize(b)},initializeField:function(){this.firstRender=true;this.isShowMoreResult=false;this.isAutoMatchSuggest=true},initializeDOM:function(){},destroyDOM:function(){this.listTipText=null},initializeEvent:function(){},destroyEvent:function(){},baseInitializeEvent:function(){},getEntry:function(e){this.active=false;var f=this.listRegion.getElementsByTagName("li");var d=f.length;if(d>e&&e>=0){return $(f[e])}return null},onEnterText:function(){if(this.onEnterCallback){this.onEnterCallback()}},onObserverEvent:function(){var b=this.getSearchKeyword();if(b.length>=this.minChars){if(b!=this.keyword){this.keyword=b;this.render()}}else{this.keyword="";this.active=false;this.render()}},onBlurText:function(d,c){this.active=false;this.hasFocus=false;this.removeObserver()},reset:function(){this.selectedValue=null;this.index=0;this.searchIndex=0;this.entryCount=0},onClick:function(){},onClickText:function(){},onFocusText:function(b){this.hasFocus=true;this.active=true;this.render()},match:function(c,d){if((d.PinyinShort.toLowerCase().indexOf(c.toLowerCase())===0)){return true}else{if((d.NameCn.toLowerCase().indexOf(c.toLowerCase())===0)||(d.NameEn.toLowerCase().indexOf(c.toLowerCase())===0)){return true}}return false},onKeydownText:function(b){if(this.handled){this.handled=false;return}this.handled=true;switch(b.keyCode){case Event.KEY_RETURN:this.onEnterText();Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();Event.stop(b);return;default:this.addObserver();this.onChangeInput();break}},doRender:function(){if(this.isEnable){if(this.changed){this.reset()}var c=this.getSearchKeyword();if(c.length===0){this.removeObserver();this.renderDefaultList();if(Prototype.Browser.Gecko&&this.hasFocus){setTimeout(function(){var a=this.getSearchKeyword();if(a!=this.keyword){var b=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(a,this.entryCount);this.renderList(this.changed,b)}}}.bind(this),1000)}}else{var d=this.getMoreLists();if(this.isAlwayShowList||this.entryCount>0){this.renderTip(c,this.entryCount);this.renderList(this.changed,d);this.showSelectList()}else{this.hideSelectList()}}}},renderTip:function(c,d){if(this.firstRender||c===""){this.firstRender=false;this.listTipText="输入中文/拼音或按&uarr;&darr;选择"}else{if(d>0){this.listTipText=c+"，按拼音数排序"}else{this.listTipText="对不起，找不到："+c}}},renderList:function(l,o){var j='<div class="sou_window"><div class="sou_note">'+this.listTipText+'</div><div class="sou_city"><ul>'+o+"</ul></div></div>";this.listRegion.update(j);var n=this.listRegion.getElementsByTagName("li");for(var k=0,h=n.length;k<h;k++){var m=n[k];m.style.cursor="pointer";Event.observe(m,"click",function(b){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){a=a.parentNode}this.doCommand(a.getAttribute("value"))}.bind(this));Event.observe(m,"mouseover",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}$A(c.parentNode.childNodes).each(function(d){d.className=""});c.className="on"});Event.observe(m,"mouseout",function(b){var c=this;if(Prototype.Browser.IE){var a=b.target||b.srcElement;if(a.nodeName=="SPAN"){c=a.parentNode}else{c=a}}c.className=""})}if(n.length>0){n[0].className="on"}}});var TicketSearchBox=Class.create();Object.extend(TicketSearchBox.prototype,{options:{container:"",cityId:null},CINEMA_NAME_SIZE:14,CINEMA_NAME_SIZE_BOX:7,oldMovieId:0,oldTheaterId:0,currentMeunIndex:0,onlineTicketShowtimeMenuNumber:3,server:{GetOnlineMoviesInCity:function(e,d,f){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineMoviesInCity",[e],d,"/Cinema.api","get","60000",f)},GetOnlineTheatersInCity:function(f,g,e,h){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineTheatersInCity",[f,g],e,"/Cinema.api","get","60000",h)},GetOnlineTheatersByMovieIdInCity:function(g,h,j,f,k){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineTheatersByMovieIdInCity",[g,h,j],f,"/Cinema.api","get","60000",k)},GetOnlineMoviesInTheater:function(f,g,e,h){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineMoviesInTheater",[f,g],e,"/Cinema.api","get","60000",h)},GetOnlineTicketShowtime:function(g,f,e,h){return Mtime.Component.Ajax.crossDomainCallBack(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineTicketShowtime",[g,f],e,"/Cinema.api","get","60000",h)}},initialize:function(b){this.setOptions(b);this.initializeDom();this.load()},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initializeDom:function(){this.container=$(this.container)},load:function(){if(this.cityId&&this.container){this.getOnlineMoviesInCity()}},builderHtml:function(){this.movieBoxTxt=Builder.node("span",{},["选电影"]);this.movieBox=Builder.node("div",{className:"moviemid m_movie __r_c_",pan:"M14_TheaterIndex_Search_Movie"},[this.movieBoxTxt,Builder.node("a",{href:"javaScript:;",className:"ico_select"},[])]);this.theaterBoxTxt=Builder.node("span",{},["选影院"]);this.theaterBox=Builder.node("div",{className:"moviemid m_film __r_c_",pan:"M14_TheaterIndex_Search_Cinema"},[this.theaterBoxTxt,Builder.node("a",{href:"javaScript:;",className:"ico_select"},[])]);this.timeBoxTxt=Builder.node("span",{},["选时间"]);this.timeBox=Builder.node("div",{className:"moviemid m_time nottime __r_c_",pan:"M14_TheaterIndex_Search_Showtime"},[this.timeBoxTxt,Builder.node("a",{href:"javaScript:;",className:"ico_select"},[])]);var d=this.hasOnlineTicket?"选座购票":"查影讯";var c=this.hasOnlineTicket?"":"none";this.ticketBtn=Builder.node("a",{href:"javaScript:;",className:"ticket false __r_c_",pan:"M14_TheaterIndex_Search_Button"},[d]);this.picTxt=Builder.node("b",{},[this.lowestPrice]);this.pic=Builder.node("strong",{className:"none"},[this.picTxt,"元起"]);this.ticketInfo=Builder.node("div",{className:"ticketinfo"},[this.ticketBtn,this.pic]);this.container.appendChild(this.movieBox);this.container.appendChild(this.theaterBox);this.container.appendChild(this.timeBox);this.container.appendChild(this.ticketInfo);this.initializeEvent()},initializeEvent:function(){this.onClickContainerHandler=this.onClickContainer.bind(this);Event.observe(this.container,"click",this.onClickContainerHandler);this.onOverContainerHandler=this.onOverContainer.bind(this);Event.observe(this.container,"mouseover",this.onOverContainerHandler);this.onClickBodyHandler=this.onClickBody.bind(this);Event.observe(document.body,"click",this.onClickBodyHandler);Event.observe(window,"unload",this.close.bind(this))},lowestPriceMethod:function(b){if(this.pic&&b>0){$show(this.pic);this.pic.innerHTML="<b>"+b+"</b>元起"}},onOverContainer:function(d){var c=Event.findElement(d,"a");if(c!==document){c.focus();c=null}},onClickContainer:function(l){var k=Event.findElement(l,"li");if(k!==document){this.onClickMovieBoxMethod(k);if(this.movieId&&this.theaterId){this.movieListElement=null;this.theaterListElement=null;this.getOnlineTicketShowtimeMethod()}else{this.server.GetOnlineTheatersByMovieIdInCity(this.cityId,this.movieId,this.hasOnlineTicket,function(a){if(a&&a.value){this.lowestPrice=a.value.lowestPrice;this.lowestPriceMethod(this.lowestPrice)}}.bind(this))}return}var g=Event.findElement(l,"a");if(g!==document&&!g.hasClassName("ico_select")){var m=g.readAttribute("typetarget");if(m==="theater"){this.onClickTheaterBoxMethod(g);if(this.movieId&&this.theaterId){this.movieListElement=null;this.theaterListElement=null;this.getOnlineTicketShowtimeMethod()}else{this.server.GetOnlineMoviesInTheater(this.theaterId,this.hasOnlineTicket,function(a){if(a&&a.value){this.lowestPrice=a.value.lowestPrice;this.lowestPriceMethod(this.lowestPrice)}}.bind(this))}}if(this.leftbtn&&g===this.leftbtn){if(!g.hasClassName("false")){this.onClickLeftbtn()}}if(this.rightbtn&&g===this.rightbtn){if(!g.hasClassName("false")){this.onClickRightbtn()}}if(g.hasClassName("clearinfo")){this.clearBoxMethod()}return}var j=Event.findElement(l,"div");if(j===this.movieBox){if(this.movieListElement&&!this.movieListElement.hasClassName("none")){$hide(this.movieListElement)}else{this.getOnlineMoviesInCity()}return}else{if(j===this.theaterBox){if(this.theaterListElement&&!this.theaterListElement.hasClassName("none")){$hide(this.theaterListElement)}else{this.getOnlineTheatersInCity()}return}else{if(this.movieId&&this.theaterId&&j===this.timeBox){if(this.onlineTicketShowtimeElement&&!this.onlineTicketShowtimeElement.hasClassName("none")){$hide(this.onlineTicketShowtimeElement);if(this.ticketInfo){$show(this.ticketInfo)}}else{this.getOnlineTicketShowtime()}return}}}var h=Event.findElement(l,"dd");if(h!==document){this.onClickTimeBoxMenuMethod(h);return}},clickCityCallBack:function(){if(this.ticketInfo){$show(this.ticketInfo)}if(this.movieListElement){$hide(this.movieListElement)}if(this.theaterListElement){$hide(this.theaterListElement)}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement)}},clearBoxMethod:function(){this.theaterId=null;this.movieId=null;this.movies=null;this.districts=null;this.favCinemas=null;this.cinemasLen=null;this.theaterBoxTxt.innerHTML="选影院";this.movieBoxTxt.innerHTML="选电影";this.ticketBtn.href="javaScript:;";if(!this.ticketBtn.hasClassName("false")){this.ticketBtn.addClassName("false")}if(!this.timeBox.hasClassName("nottime")){this.timeBox.addClassName("nottime")}this.addId=null;$show(this.ticketInfo);if(this.movieListElement){$hide(this.movieListElement);this.movieListElement.remove();this.movieListElement=null;if(this.movieFilterTextCtrl){this.movieFilterTextCtrl.close();this.movieFilterTextCtrl=null}}if(this.theaterListElement){$hide(this.theaterListElement);this.theaterListElement.remove();this.theaterListElement=null;if(this.theaterFilterTextCtrl){this.theaterFilterTextCtrl.close();this.theaterFilterTextCtrl=null}}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement);this.onlineTicketShowtimeElement.remove();this.onlineTicketShowtimeElement=null}this.pic.innerHTML="";this.lowestPrice=this.firstLowestPrice},onClickMovieBoxMethod:function(c){var d=c.readAttribute("movieid");if(d){this.movieId=d;this.movieTitel=this.strShort(c.down("span").innerHTML,this.CINEMA_NAME_SIZE_BOX);if(this.theaterId){if(this.theaterBoxTxt){this.theaterBoxTxt.innerHTML=this.theaterTitel+'<a href="" onclick="return false;" class="clearinfo">清除</a>'}this.movieBoxTxt.innerHTML=this.movieTitel+'<a href="" onclick="return false;" class="clearinfo">清除</a>'}else{this.movieBoxTxt.innerHTML=this.movieTitel}if(this.movieListElement){$hide(this.movieListElement);this.showElementMethod(this.movieLists)}if(this.ticketBtn.hasClassName("false")){this.ticketBtn.removeClassName("false")}if(this.movieId&&this.theaterId&&this.hasOnlineTicket){this.timeBox.removeClassName("nottime");this.ticketBtn.href=String.format(this.movieShowtimePageCinemaUrl,this.stringId,this.movieId,this.theaterId)}else{this.ticketBtn.href=String.format(this.movieShowtimeUrl,this.stringId,this.movieId);this.ticketBtn.target="_blank"}}},onClickTheaterBoxMethod:function(d){var f=d.readAttribute("value");var e=d.readAttribute("stringId");this.theaterTitel=this.strShort(d.innerHTML,this.CINEMA_NAME_SIZE_BOX);if(this.movieId){this.theaterBoxTxt.innerHTML=this.theaterTitel+'<a href="" onclick="return false;" class="clearinfo">清除</a>';if(this.movieBoxTxt){this.movieBoxTxt.innerHTML=this.movieTitel+'<a href="" onclick="return false;" class="clearinfo">清除</a>'}}else{this.theaterBoxTxt.innerHTML=this.theaterTitel}this.theaterId=f;if(this.theaterListElement){$hide(this.theaterListElement);this.movieLists&&this.showElementMethod(this.movieLists)}if(this.ticketBtn.hasClassName("false")){this.ticketBtn.removeClassName("false")}if(this.movieId&&this.theaterId&&this.hasOnlineTicket){this.timeBox.removeClassName("nottime");this.ticketBtn.href=String.format(this.movieShowtimePageCinemaUrl,this.stringId,this.movieId,this.theaterId)}else{this.ticketBtn.href=String.format(this.showTimeTheaterUrl,e,this.theaterId);this.ticketBtn.target="_blank"}},onClickTimeBoxMenuMethod:function(e){var f=e.readAttribute("menuindex");if(f){if(e.hasClassName("on")){return}f=parseInt(f);var d=this.builderOneDateOnlineTicketShowtimeHtml(this.dateShowtimes,f);this.onlineTicketShowtimeList.innerHTML=d;e.addClassName("on");if(this.dateMenuLists){this.dateMenuLists[this.currentMeunIndex].removeClassName("on")}this.currentMeunIndex=f}},builderMovieListHtml:function(){if(this.theaterListElement){$hide(this.theaterListElement);this.cinemasListElements&&this.showTheaterElementMethod(this.cinemasListElements)}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement)}if(this.movies&&this.movies.length>0){if(this.movieListElement){this.movieListElement.remove();this.movieListElement=null}var l=this.movies.length,m,k=new StringBuilder();this.movieListElement=Builder.node("div",{className:"moviestip __r_c_",pan:"M14_TheaterIndex_Search_Movie"});for(i=0;i<l;i++){m=this.movies[i];m.title=this.strShort(m.title,this.CINEMA_NAME_SIZE);var j=new StringBuilder();var o="";if(this.movies[i].rating!==""){o='<b class="db_point">#{rating}</b>'}j.append('<li movieid="#{movieId}"><a href="javaScript:;">'+o+"<span>#{title}</span></a></li>");var p=new Template(j.toString());k.append(p.evaluate(this.movies[i]))}var q=new Date().getTime();this.movieSelectTextId="movieSelectText_"+q;this.movieListElement.innerHTML='<div class="searcher"><input id="'+this.movieSelectTextId+'" type="text" class="input c_a5" value="输入影片名称快速定位"><i class="sub"></i></div><ul>'+k.toString()+"</ul>";this.container.appendChild(this.movieListElement);var n=this.movieListElement.down("ul");this.movieLists=n.immediateDescendants();this.searchMovieMethod()}},searchMovieMethod:function(){var b=$(this.movieSelectTextId);if(b&&typeof Textbox!=="undefined"){this.movieFilterTextCtrl=new Textbox({text:b,value:"",watermarkText:"输入影片名称快速定位",focusClassName:"",blurClassName:"c_a5",onKeyupCallback:this.filterMovie.bind(this)})}},filterMovie:function(){var h=this.movieFilterTextCtrl.getValue();if(this.movieLists&&this.movieLists.length>0){var f=this.movieLists.length,g,e;if(h.length>0){for(e=0;e<f;e++){g=this.movieLists[e].down("span").innerHTML.toLowerCase();if(g.indexOf(h.toLowerCase())>-1){$show(this.movieLists[e])}else{$hide(this.movieLists[e])}}}else{this.showElementMethod(this.movieLists)}}},onClickBody:function(f){var e=Event.element(f);var h=e.up(".movieselectbox");var g=e.up(".moviemid");if(h!==this.container){if(this.movieListElement){$hide(this.movieListElement);this.showElementMethod(this.movieLists)}if(this.theaterListElement){$hide(this.theaterListElement)}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement)}$show(this.ticketInfo)}else{var g=e.up(".moviemid");if(g===this.movieBox){if(this.theaterListElement){$hide(this.theaterListElement)}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement)}$show(this.ticketInfo)}if(g===this.theaterBox){if(this.movieListElement){$hide(this.movieListElement);this.showElementMethod(this.movieLists)}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement)}$show(this.ticketInfo)}if(g===this.timeBox){if(this.movieListElement){$hide(this.movieListElement);this.showElementMethod(this.movieLists)}if(this.theaterListElement){$hide(this.theaterListElement)}}}},showElementMethod:function(f){var e=f.length;for(var d=0;d<e;d++){$show(f[d])}},getOnlineMoviesInCity:function(){if(this.theaterId){if(this.movieListElement){$show(this.movieListElement)}else{this.oldTheaterId=this.theaterId;if(this.movieListElement){this.movieListElement.remove();this.movieListElement=null}this.server.GetOnlineMoviesInTheater(this.theaterId,this.hasOnlineTicket,function(b){if(b&&b.value){this.lowestPrice=b.value.lowestPrice;this.movies=b.value.movies;this.builderMovieListHtml()}}.bind(this))}}else{if(this.firstMovies){this.movies=this.firstMovies;this.builderMovieListHtml();return}this.server.GetOnlineMoviesInCity(this.cityId,function(b){if(b&&b.value){this.hasOnlineTicket=b.value.hasOnlineTicket;this.firstLowestPrice=b.value.lowestPrice;this.lowestPrice=b.value.lowestPrice;this.firstMovies=b.value.movies;this.movies=b.value.movies;this.stringId=b.value.stringId;this.movieShowtimeUrl=b.value.movieShowtimeUrl;this.showTimeTheaterUrl=b.value.showTimeTheaterUrl;this.movieShowtimePageCinemaUrl=b.value.movieShowtimePageCinemaUrl;this.cinemaCount=b.value.cinemaCount;this.builderHtml()}}.bind(this))}},getOnlineTheatersInCity:function(){if(this.movieId){if(this.theaterListElement){$show(this.theaterListElement)}else{this.oldMovieId=this.movieId;if(this.theaterListElement){this.theaterListElement.remove();this.theaterListElement=null}this.server.GetOnlineTheatersByMovieIdInCity(this.cityId,this.movieId,this.hasOnlineTicket,function(b){if(b&&b.value){this.lowestPrice=b.value.lowestPrice;this.districts=b.value.districts;this.districts.push({districtId:0,name:"其它",cinemas:[]});this.favCinemas=b.value.favCinemas;this.cinemasLen=b.value.cinemas.length;this.getTheaterData(b.value.cinemas);this.builderTheaterListHtml()}}.bind(this))}}else{this.server.GetOnlineTheatersInCity(this.cityId,this.hasOnlineTicket,function(b){if(b&&b.value){this.districts=b.value.districts;this.districts.push({districtId:0,name:"其它",cinemas:[]});this.favCinemas=b.value.favCinemas;this.cinemasLen=b.value.cinemas.length;this.getTheaterData(b.value.cinemas);this.builderTheaterListHtml()}}.bind(this))}},getOnlineTicketShowtime:function(){var b=this.movieId+"_"+this.theaterId;if(this.addId&&this.addId===b){this.builderOnlineTicketShowtimeHtml();$hide(this.ticketInfo);return}this.server.GetOnlineTicketShowtime(this.movieId,this.theaterId,function(a){if(a&&a.value){this.lowestPrice=a.value.lowestPrice;this.addId=this.movieId+"_"+this.theaterId;this.dates=this.getDateConversion(a.value.dates);this.dateShowtimes=a.value.dateShowtimes;this.ticketUrl=a.value.ticketUrl;this.builderOnlineTicketShowtimeHtml();$hide(this.ticketInfo)}}.bind(this))},getOnlineTicketShowtimeMethod:function(){this.server.GetOnlineTicketShowtime(this.movieId,this.theaterId,function(b){if(b&&b.value){this.lowestPrice=b.value.lowestPrice;this.addId=this.movieId+"_"+this.theaterId;this.dates=this.getDateConversion(b.value.dates);this.dateShowtimes=b.value.dateShowtimes;this.ticketUrl=b.value.ticketUrl;this.lowestPriceMethod(this.lowestPrice)}}.bind(this))},builderTheaterListHtml:function(){if(this.movieListElement){$hide(this.movieListElement);this.movieLists&&this.showElementMethod(this.movieLists)}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement)}if(this.theaterListElement){$show(this.theaterListElement)}else{if(this.districts&&this.districts.length>0){if(this.theaterListElement){this.theaterListElement.remove();this.theaterListElement=null}var j=Builder.node("p",{className:"clearfix pb9"});var k=new Date().getTime();this.theaterSelectTextId="theaterSelectText_"+k;j.innerHTML='<span class="searcher"><input id="'+this.theaterSelectTextId+'" type="text" class="input c_a5" value="输入影院名称快速定位"><i class="sub"></i></span><span class="lh25">当前共有'+this.cinemasLen+"家影院</span>";var f,g=this.districts.length;this.cinemasList=Builder.node("div",{className:"arealist"});if(this.favCinemas.length>0){this.favCinemasList=this.getCinemasListP(this.favCinemas,"常去影院");this.favCinemasList.style.borderBottom="1px solid #bababa";this.favCinemasList.style.paddingBottom="10px";this.cinemasList.appendChild(this.favCinemasList)}for(var h=0;h<g;h++){f=this.getCinemasListP(this.districts[h].cinemas,this.districts[h].name);this.cinemasList.appendChild(f)}this.theaterListElement=Builder.node("div",{className:"cinematip __r_c_",style:"left: 400px",pan:"M14_TheaterIndex_Search_Cinema"},[j,this.cinemasList]);this.container.appendChild(this.theaterListElement);this.cinemasLists=this.cinemasList.immediateDescendants();this.cinemasListElements=this.getCinemasArray(this.cinemasLists);this.searchTheaterMethod()}}},searchTheaterMethod:function(){var b=$(this.theaterSelectTextId);if(b&&typeof Textbox!=="undefined"){this.theaterFilterTextCtrl=new Textbox({text:b,value:"",watermarkText:"输入影院名称快速定位",focusClassName:"",blurClassName:"c_a5",onKeyupCallback:this.filterTheater.bind(this)})}},filterTheater:function(){var n=this.theaterFilterTextCtrl.getValue();if(this.cinemasListElements&&this.cinemasListElements.length>0){var l=this.cinemasListElements.length,o,m,h;if(n.length>0){if(this.favCinemasList){$hide(this.favCinemasList)}for(var j=0;j<l;j++){h=this.cinemasListElements[j];m=h.length;$hide(this.cinemasLists[j]);for(var k=1;k<m;k++){o=h[k].innerHTML.toLowerCase();if(o.indexOf(n.toLowerCase())>-1){$show(this.cinemasLists[j]);$show(h[k])}else{$hide(h[k])}}}}else{if(this.favCinemasList){$show(this.favCinemasList)}this.showTheaterElementMethod(this.cinemasListElements)}}},showTheaterElementMethod:function(g){var l=g.length,j,m,h;for(j=0;j<l;j++){h=g[j];m=h.length;$show(this.cinemasLists[j]);for(var k=1;k<m;k++){$show(h[k])}}},getTheaterData:function(f){if(this.districts&&this.districts.length>0&&f&&f.length>0){var h=this.districts.length;var g=f.length;for(var j=0;j<h;j++){this.districts[j].cinemas=[];for(var k=0;k<g;k++){if(this.districts[j].districtId===f[k].districtId){this.districts[j].cinemas.push(f[k])}}}}},getCinemasArray:function(f){var e=[];if(f&&f.length>0){var g=f.length;for(var h=0;h<g;h++){e[h]=f[h].immediateDescendants()}}return e},getCinemasListP:function(f,h){var e;var g=document.createElement("p");g.className="oftenlist alist";if(f&&f.length>0){e=this.getCinemasListA(f);g.innerHTML=String.format("<span>{0}</span>{1}",h,e)}return g},getCinemasListA:function(h){var m=new Template('<a href="#" value="#{cinemaId}" stringId="#{stringId}" typetarget="theater" onclick="return false;">#{name}</a>');var l=new StringBuilder();var g;for(var j=0,k=h.length;j<k;j++){g=h[j];if(g.name.bytelength()>40){g.name=g.name.substr(0,19)+".."}l.append(m.evaluate(g));this.cinemaCount++}return l.toString()},builderOnlineTicketShowtimeHtml:function(){if(this.movieListElement){$hide(this.movieListElement);this.movieLists&&this.showElementMethod(this.movieLists)}if(this.theaterListElement){$hide(this.theaterListElement);this.cinemasListElements&&this.showTheaterElementMethod(this.cinemasListElements)}if(this.dates&&this.dates.length>0){this.datesLen=this.dates.length;var l=this.datesLen>3?"":"false";this.leftbtn=Builder.build('<a class="lastday false" style="left:0;" href="javaScript:;" ><i></i></a>');this.rightbtn=Builder.build('<a class="nextday '+l+'" style="right:0;" href="javaScript:;"><i></i></a>');var p=new StringBuilder(),n,q;var k=200*this.datesLen;for(q=0;q<this.datesLen;q++){var j="";if(q===0){j="on"}p.append('<dd class="'+j+'" menuindex="'+q+'">'+this.dates[q]+"</dd>")}this.dateMenuList=Builder.node("dl",{className:"transition4",style:"width:"+k+"px; left:0px;"});this.dateMenuList.innerHTML=p.toString();this.dateMenuLists=this.dateMenuList.immediateDescendants();var o=Builder.node("div",{className:"i_datetab"},[this.leftbtn,this.rightbtn,Builder.node("div",{className:"i_dates"},[this.dateMenuList])]);var m=this.builderOneDateOnlineTicketShowtimeHtml(this.dateShowtimes,0);this.onlineTicketShowtimeList=Builder.node("ul",{});this.onlineTicketShowtimeList.innerHTML=m;this.onlineTicketShowtimeElement=Builder.node("div",{className:"i_date __r_c_",pan:"M14_TheaterIndex_Search_Showtime"},[o,Builder.node("div",{className:"showdate"},[this.onlineTicketShowtimeList])]);this.container.appendChild(this.onlineTicketShowtimeElement);this.meunIndex=this.onlineTicketShowtimeMenuNumber;this.meunItemWidth=this.dateMenuLists[0].getWidth()}},builderOneDateOnlineTicketShowtimeHtml:function(q,u){if(q&&q.length>0){var r=q[u].showtimes.length,p,v,o,y,A,w,s,z;var t=new StringBuilder();for(i=0;i<r;i++){p=q[u].showtimes[i];A=p.version?p.version+",":"";w=p.language?p.language+",":"";s=p.hallName?p.hallName:"";v=A+w+s;y=p.salePrice;o=p.cinemaPrice;z=String.format(this.ticketUrl,p.showtimeId);var x=p.isNext?"<i>（次日）</i>":"";t.append('<li> <a href="'+z+'" target="_blank" ><span class="time">'+p.timeReal+x+'</span> <span class="ting">'+v+'</span> <span class="mprice">￥'+y+'</span> <span class="yprice">￥'+o+' </span><span class="tbtn">选座购票</span></a> </li>')}return t.toString()}return""},onClickLeftbtn:function(){this.meunIndex--;if(this.meunIndex<=this.onlineTicketShowtimeMenuNumber){this.meunIndex=this.onlineTicketShowtimeMenuNumber;this.leftbtn.addClassName("false")}if(this.rightbtn.hasClassName("false")){this.rightbtn.removeClassName("false")}var b=this.meunItemWidth*(this.onlineTicketShowtimeMenuNumber-this.meunIndex);this.dateMenuList.style.left=b+"px"},onClickRightbtn:function(){this.meunIndex++;if(this.meunIndex>=this.datesLen){this.meunIndex=this.datesLen;this.rightbtn.addClassName("false")}if(this.leftbtn.hasClassName("false")){this.leftbtn.removeClassName("false")}var b=this.meunItemWidth*(this.onlineTicketShowtimeMenuNumber-this.meunIndex);this.dateMenuList.style.left=b+"px"},getDateConversion:function(h){var f=[],k=h.length,g;for(var j=0;j<k;j++){g=new Date(getFomartDateStr(h[j]));f.push(getDateString(g))}return f},strShort:function(n,m){var l=0,h=n.split(""),o=[];m=(m||8)*2;var k=h.length;for(var j=0;j<k;++j){if(h[j].charCodeAt(0)<299){l++}else{l+=2}o.push(h[j]);if(l>=m-2){o.push("..");break}}return o.join("")},close:function(){this.destroyEvent();this.destroyDOM();this.destroyField()},destroyField:function(){},destroyEvent:function(){Event.stopObserving(document.body,"click",this.onClickBodyHandler);Event.stopObserving(this.container,"click",this.onClickContainerHandler)},destroyDOM:function(){this.movieBox=null;this.theaterBox=null;this.timeBox=null;this.ticketInfo=null;this.container=null}});Date.prototype.Format=function(d){var f={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(d)){d=d.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var e in f){if(new RegExp("("+e+")").test(d)){d=d.replace(RegExp.$1,(RegExp.$1.length==1)?(f[e]):(("00"+f[e]).substr((""+f[e]).length)))}}return d};function getWeek(c){var d;if(c.getDay()==0){d="周日"}if(c.getDay()==1){d="周一"}if(c.getDay()==2){d="周二"}if(c.getDay()==3){d="周三"}if(c.getDay()==4){d="周四"}if(c.getDay()==5){d="周五"}if(c.getDay()==6){d="周六"}return d}function getFomartDateStr(strDate){return strDate.replace(eval("/-/gi"),"/")}function getDateString(k){var o=new Date();var m="";var h=o.getDate();var j=k.getDate();var l=j-h;var n=k.Format("M月d日");if(l===0){m="今天 ("+n+")"}else{if(l===1){m="明天 ("+n+")"}else{if(l===2){m="后天 ("+n+")"}else{m=getWeek(k)+"("+n+")"}}}return m}var IndexPageTicketSearchBox=Class.create();Object.extend(IndexPageTicketSearchBox.prototype,TicketSearchBox.prototype);Object.extend(IndexPageTicketSearchBox.prototype,{CINEMA_NAME_SIZE:14,CINEMA_NAME_SIZE_BOX:7,options:{container:"",cityId:null,cityName:""},theatersCache:{},moviesCache:{},server:{GetOnlineMoviesInCity:function(e,d,f){return Mtime.Component.Ajax.request(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineMoviesInCity",[e],d,"/Cinema.api","get","60000",f)},GetOnlineTheatersInCity:function(f,g,e,h){return Mtime.Component.Ajax.request(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineTheatersInCity",[f,g],e,"/Cinema.api","get","60000",h)},GetOnlineTheatersByMovieIdInCity:function(g,h,j,f,k){return Mtime.Component.Ajax.request(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineTheatersByMovieIdInCity",[g,h,j],f,"/Cinema.api","get","60000",k)},GetOnlineMoviesInTheater:function(f,g,e,h){return Mtime.Component.Ajax.request(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineMoviesInTheater",[f,g],e,"/Cinema.api","get","60000",h)},GetOnlineTicketShowtime:function(g,f,e,h){return Mtime.Component.Ajax.request(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetOnlineTicketShowtime",[g,f],e,"/Cinema.api","get","60000",h)},getCinemaChannelPageUrlByCityId:function(e,d,f){return Mtime.Component.Ajax.request(siteTheaterServiceUrl,"Mtime.Cinema.Services","GetCinemaChannelPageUrlByCityId",[e],d,"/Cinema.api","get","60000",f)}},builderHtml:function(){this.container.addClassName("movieselectbox");this.container.innerHTML='<i class="rtjt"><em>▲</em></i><div id="changeCityLink" class="i_citybox __r_c_" pan="M14_Index_Hotplay_TicketSearch_City"><i class="icon_position"></i>'+this.cityName+'<i class="icon_jtup"></i></div><div class="userbar" style="display:none;"></div>';if(this.firstMovies&&this.firstMovies.length>0){this.defaultMovieBoxTxt="<em>共<strong>"+this.firstMovies.length+"</strong>部</em>选影片"}else{this.defaultMovieBoxTxt="选影片"}this.movieBoxTxt=Builder.build('<span class="name">'+this.defaultMovieBoxTxt+"</span>");this.movieBox=Builder.node("div",{className:"movieselect __r_c_",pan:"M14_Index_Hotplay_TicketSearch_Movie"},[this.movieBoxTxt,Builder.node("i",{className:"sharp"})]);if(this.cinemaCount&&this.cinemaCount>0){this.defaultTheaterBoxTxt="<em>共<strong>"+this.cinemaCount+"</strong>家</em>选影院"}else{this.defaultTheaterBoxTxt="选影院"}this.theaterBoxTxt=Builder.build('<span class="name">'+this.defaultTheaterBoxTxt+"</span>");this.theaterBox=Builder.node("div",{className:"movieselect __r_c_",pan:"M14_Index_Hotplay_TicketSearch_Cinema"},[this.theaterBoxTxt,Builder.node("i",{className:"sharp"})]);this.timeBoxTxt=Builder.node("span",{className:"name"},["选时间"]);this.timeBox=Builder.node("div",{className:"movieselect nottime __r_c_",pan:"M14_Index_Hotplay_TicketSearch_Time"},[this.timeBoxTxt,Builder.node("i",{className:"sharp"})]);var d=this.hasOnlineTicket?"选座购票":"查影讯";var c=this.hasOnlineTicket?"M14_Index_Hotplay_TicketSearch_SelectSeat":"M14_Index_Hotplay_TicketSearch_FindMovie";this.ticketBtn=Builder.node("a",{href:"javaScript:;",className:"false __r_c_",pan:c},[d]);this.picTxt=Builder.node("b",{},[""]);this.pic=Builder.node("strong",{className:"none"},["元起"]);this.ticketInfo=Builder.node("div",{className:"i_selectbtn"},[this.ticketBtn]);this.container.appendChild(this.movieBox);this.container.appendChild(this.theaterBox);this.container.appendChild(this.timeBox);this.container.appendChild(this.ticketInfo);this.initializeEvent();if(typeof CityMenuControl!="undefined"){this.newCityMenuControlMethod()}else{$loadJs(["/js/2014/CityMenuControl.js"],function(){this.newCityMenuControlMethod()}.bind(this))}},newCityMenuControlMethod:function(){this.cityMenuCtrl=new CityMenuControl({container:"changeCityLink",isTip:false,clickCallBack:this.clickCityCallBack.bind(this),callBack:this.changeCityMethod.bind(this)});this.cityMenuCtrl.isTip=true},onClickContainer:function(l){var k=Event.findElement(l,"li");if(k!==document){this.onClickMovieBoxMethod(k);if(this.movieId&&this.theaterId){this.movieListElement=null;this.theaterListElement=null;this.getOnlineTicketShowtimeMethod()}else{this.lowestPriceMethod(this.lowestPrice);this.getTheaterLists()}return}var g=Event.findElement(l,"a");if(g!==document&&!g.hasClassName("ico_select")){var m=g.readAttribute("typetarget");if(m==="theater"){this.onClickTheaterBoxMethod(g);if(this.movieId&&this.theaterId){this.movieListElement=null;this.theaterListElement=null;this.getOnlineTicketShowtimeMethod()}else{this.lowestPriceMethod(this.lowestPrice);this.getMovieLists()}}if(this.leftbtn&&g===this.leftbtn){if(!g.hasClassName("false")){this.onClickLeftbtn()}}if(this.rightbtn&&g===this.rightbtn){if(!g.hasClassName("false")){this.onClickRightbtn()}}if(g.hasClassName("clearinfo")){this.clearBoxMethod()}return}var j=Event.findElement(l,"div");if(j===this.movieBox){if(this.movieListElement&&!this.movieListElement.hasClassName("none")){$hide(this.movieListElement)}else{this.getOnlineMoviesInCity()}return}else{if(j===this.theaterBox){if(this.theaterListElement&&!this.theaterListElement.hasClassName("none")){$hide(this.theaterListElement)}else{this.getOnlineTheatersInCity()}return}else{if(this.movieId&&this.theaterId&&j===this.timeBox){if(this.onlineTicketShowtimeElement&&!this.onlineTicketShowtimeElement.hasClassName("none")){$hide(this.onlineTicketShowtimeElement)}else{this.getOnlineTicketShowtime()}return}}}var h=Event.findElement(l,"dd");if(h!==document){this.onClickTimeBoxMenuMethod(h);return}},clearBoxMethod:function(){this.theaterId=null;this.movieId=null;this.movies=null;this.districts=null;this.favCinemas=null;this.cinemasLen=null;this.theaterBoxTxt.innerHTML=this.defaultTheaterBoxTxt;this.movieBoxTxt.innerHTML=this.defaultMovieBoxTxt;if(!this.ticketBtn.hasClassName("false")){this.ticketBtn.addClassName("false")}if(!this.timeBox.hasClassName("nottime")){this.timeBox.addClassName("nottime")}this.addId=null;$show(this.ticketInfo);if(this.movieListElement){$hide(this.movieListElement);this.movieListElement.remove();this.movieListElement=null;if(this.movieFilterTextCtrl){this.movieFilterTextCtrl.close();this.movieFilterTextCtrl=null}}if(this.theaterListElement){$hide(this.theaterListElement);this.theaterListElement.remove();this.theaterListElement=null;if(this.theaterFilterTextCtrl){this.theaterFilterTextCtrl.close();this.theaterFilterTextCtrl=null}}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement);this.onlineTicketShowtimeElement.remove();this.onlineTicketShowtimeElement=null}this.pic.innerHTML="";this.lowestPrice=this.firstLowestPrice},clickCityCallBack:function(){$show(this.ticketInfo);if(this.movieListElement){$hide(this.movieListElement);this.movieListElement.remove();this.movieListElement=null;if(this.movieFilterTextCtrl){this.movieFilterTextCtrl.close();this.movieFilterTextCtrl=null}}if(this.theaterListElement){$hide(this.theaterListElement);this.theaterListElement.remove();this.theaterListElement=null;if(this.theaterFilterTextCtrl){this.theaterFilterTextCtrl.close();this.theaterFilterTextCtrl=null}}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement);this.onlineTicketShowtimeElement.remove();this.onlineTicketShowtimeElement=null}},builderMovieListHtml:function(){if(this.theaterListElement){$hide(this.theaterListElement);this.cinemasListElements&&this.showTheaterElementMethod(this.cinemasListElements)}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement)}if(this.movies&&this.movies.length>0){if(this.movieListElement){this.movieListElement.remove();this.movieListElement=null}var l=this.movies.length,m,k=new StringBuilder();this.movieListElement=Builder.node("div",{className:"moviestip",style:"z-index:20;top:114px;left:15px"});for(i=0;i<l;i++){m=this.movies[i];m.title=this.strShort(m.title,this.CINEMA_NAME_SIZE);var j=new StringBuilder();var o="";if(this.movies[i].rating!==""){o='<b class="db_point">#{rating}</b>'}j.append('<li movieid="#{movieId}"><a href="javaScript:;">'+o+"<span>#{title}</span></a></li>");var p=new Template(j.toString());k.append(p.evaluate(this.movies[i]))}var q=new Date().getTime();this.movieSelectTextId="movieSelectText_"+q;this.movieListElement.innerHTML='<div class="searcher"><input id="'+this.movieSelectTextId+'" type="text" class="input c_a5" value="输入影片名称快速定位"><i class="sub"></i></div><ul>'+k.toString()+"</ul>";this.container.appendChild(this.movieListElement);var n=this.movieListElement.down("ul");this.movieLists=n.immediateDescendants();this.searchMovieMethod()}},builderTheaterListHtml:function(){if(this.movieListElement){$hide(this.movieListElement);this.movieLists&&this.showElementMethod(this.movieLists)}if(this.onlineTicketShowtimeElement){$hide(this.onlineTicketShowtimeElement)}if(this.theaterListElement){$show(this.theaterListElement)}else{if(this.districts&&this.districts.length>0){if(this.theaterListElement){this.theaterListElement.remove();this.theaterListElement=null}var j=Builder.node("p",{className:"clearfix pb9"});var k=new Date().getTime();this.theaterSelectTextId="theaterSelectText_"+k;j.innerHTML='<span class="searcher"><input id="'+this.theaterSelectTextId+'" type="text" class="input c_a5" value="输入影院名称快速定位"><i class="sub"></i></span><span class="lh25">当前共有'+this.cinemasLen+"家影院</span>";var f,g=this.districts.length;this.cinemasList=Builder.node("div",{className:"arealist"});if(this.favCinemas.length>0){this.favCinemasList=this.getCinemasListP(this.favCinemas,"常去影院");this.favCinemasList.style.borderBottom="1px solid #bababa";this.favCinemasList.style.paddingBottom="10px";this.cinemasList.appendChild(this.favCinemasList)}for(var h=0;h<g;h++){f=this.getCinemasListP(this.districts[h].cinemas,this.districts[h].name);this.cinemasList.appendChild(f)}this.theaterListElement=Builder.node("div",{className:"cinematip",style:"z-index:20;top:160px;left:15px"},[j,this.favCinemasList,this.cinemasList]);this.container.appendChild(this.theaterListElement);this.cinemasLists=this.cinemasList.immediateDescendants();this.cinemasListElements=this.getCinemasArray(this.cinemasLists);this.searchTheaterMethod()}}},builderOnlineTicketShowtimeHtml:function(){if(this.movieListElement){$hide(this.movieListElement);this.movieLists&&this.showElementMethod(this.movieLists)}if(this.theaterListElement){$hide(this.theaterListElement);this.cinemasListElements&&this.showTheaterElementMethod(this.cinemasListElements)}if(this.dates&&this.dates.length>0){this.datesLen=this.dates.length;var l=this.datesLen>3?"":"false";this.leftbtn=Builder.build('<a class="lastday false" style="left:0;" href="javaScript:;" ><i></i></a>');this.rightbtn=Builder.build('<a class="nextday '+l+'" style="right:0;" href="javaScript:;"><i></i></a>');var p=new StringBuilder(),n,q;var k=200*this.datesLen;for(q=0;q<this.datesLen;q++){var j="";if(q===0){j="on"}p.append('<dd class="'+j+'" menuindex="'+q+'">'+this.dates[q]+"</dd>")}this.dateMenuList=Builder.node("dl",{className:"transition4",style:"width:"+k+"px; left:0px;"});this.dateMenuList.innerHTML=p.toString();this.dateMenuLists=this.dateMenuList.immediateDescendants();var o=Builder.node("div",{className:"i_datetab"},[this.leftbtn,this.rightbtn,Builder.node("div",{className:"i_dates"},[this.dateMenuList])]);var m=this.builderOneDateOnlineTicketShowtimeHtml(this.dateShowtimes,0);this.onlineTicketShowtimeList=Builder.node("ul",{});this.onlineTicketShowtimeList.innerHTML=m;this.onlineTicketShowtimeElement=Builder.node("div",{className:"i_date",style:"z-index:20; top:204px; left:15px"},[o,Builder.node("div",{className:"showdate __r_c_",pan:"M14_Index_Hotplay_TicketSearch_TimeList"},[this.onlineTicketShowtimeList])]);this.container.appendChild(this.onlineTicketShowtimeElement);this.meunIndex=this.onlineTicketShowtimeMenuNumber;this.meunItemWidth=this.dateMenuLists[0].getWidth()}},getOnlineMoviesInCity:function(){if(this.theaterId){if(this.movieListElement){$show(this.movieListElement)}else{this.oldTheaterId=this.theaterId;if(this.movieListElement){this.movieListElement.remove();this.movieListElement=null}if(this.moviesCache[this.theaterId.toString()]){var b=this.moviesCache[this.theaterId.toString()];this.lowestPrice=b.lowestPrice;this.movies=b.movies;this.builderMovieListHtml()}else{this.server.GetOnlineMoviesInTheater(this.theaterId,this.hasOnlineTicket,function(a){if(a&&a.value){this.lowestPrice=a.value.lowestPrice;this.movies=a.value.movies;this.builderMovieListHtml()}}.bind(this))}}}else{if(this.firstMovies){this.movies=this.firstMovies;this.builderMovieListHtml();return}this.server.GetOnlineMoviesInCity(this.cityId,function(a){if(a&&a.value){this.hasOnlineTicket=a.value.hasOnlineTicket;this.firstLowestPrice=a.value.lowestPrice;this.lowestPrice=a.value.lowestPrice;this.firstMovies=a.value.movies;this.movies=a.value.movies;this.stringId=a.value.stringId;this.movieShowtimeUrl=a.value.movieShowtimeUrl;this.showTimeTheaterUrl=a.value.showTimeTheaterUrl;this.movieShowtimePageCinemaUrl=a.value.movieShowtimePageCinemaUrl;this.cinemaCount=a.value.cinemaCount;this.builderHtml()}}.bind(this))}},getMovieLists:function(){this.server.GetOnlineMoviesInTheater(this.theaterId,this.hasOnlineTicket,function(b){if(b&&b.value){this.moviesCache[this.theaterId.toString()]=b.value;this.movieBoxTxt.innerHTML="<em>共<strong>"+b.value.movies.length+"</strong>部</em>选影片"}}.bind(this))},getOnlineTheatersInCity:function(){if(this.movieId){if(this.theaterListElement){$show(this.theaterListElement)}else{this.oldMovieId=this.movieId;if(this.theaterListElement){this.theaterListElement.remove();this.theaterListElement=null}if(this.theatersCache[this.cityId+"_"+this.movieId]){var b=this.theatersCache[this.cityId+"_"+this.movieId];this.lowestPrice=b.lowestPrice;this.districts=b.districts;this.districts.push({districtId:0,name:"其它",cinemas:[]});this.favCinemas=b.favCinemas;this.cinemasLen=b.cinemas.length;this.getTheaterData(b.cinemas);this.builderTheaterListHtml()}else{this.server.GetOnlineTheatersByMovieIdInCity(this.cityId,this.movieId,this.hasOnlineTicket,function(a){if(a&&a.value){this.lowestPrice=a.value.lowestPrice;this.districts=a.value.districts;this.districts.push({districtId:0,name:"其它",cinemas:[]});this.favCinemas=a.value.favCinemas;this.cinemasLen=a.value.cinemas.length;this.getTheaterData(a.value.cinemas);this.builderTheaterListHtml()}}.bind(this))}}}else{this.server.GetOnlineTheatersInCity(this.cityId,this.hasOnlineTicket,function(a){if(a&&a.value){this.districts=a.value.districts;this.districts.push({districtId:0,name:"其它",cinemas:[]});this.favCinemas=a.value.favCinemas;this.cinemasLen=a.value.cinemas.length;this.getTheaterData(a.value.cinemas);this.builderTheaterListHtml()}}.bind(this))}},getTheaterLists:function(){this.server.GetOnlineTheatersByMovieIdInCity(this.cityId,this.movieId,this.hasOnlineTicket,function(b){if(b&&b.value){this.theatersCache[this.cityId+"_"+this.movieId]=b.value;this.theaterBoxTxt.innerHTML="<em>共<strong>"+b.value.cinemas.length+"</strong>家</em>选影院"}}.bind(this))},changeCityMethod:function(b){if(b>0){setCookie("DefaultCity-CookieKey",b);location.reload()}},getOnlineTicketShowtime:function(){var b=this.movieId+"_"+this.theaterId;if(this.addId&&this.addId===b){if(this.onlineTicketShowtimeElement){$show(this.onlineTicketShowtimeElement)}else{this.builderOnlineTicketShowtimeHtml()}return}this.server.GetOnlineTicketShowtime(this.movieId,this.theaterId,function(a){if(a&&a.value){this.lowestPrice=a.value.lowestPrice;this.addId=this.movieId+"_"+this.theaterId;this.dates=this.getDateConversion(a.value.dates);this.dateShowtimes=a.value.dateShowtimes;this.ticketUrl=a.value.ticketUrl;this.builderOnlineTicketShowtimeHtml()}}.bind(this))},destroyDOM:function(){this.movieBox=null;this.theaterBox=null;this.timeBox=null;this.ticketInfo=null;this.container=null;theatersCache=null;moviesCache:null}});var RemindNews=Class.create();Object.extend(RemindNews.prototype,{Server:{getUnreadNewsCount:function(d,c){return Mtime.Component.Ajax.crossDomainCallBack(siteChannelServiceUrl,"Mtime.Channel.Services","GetUnreadNewsCount",[d],c,"/Channel.api","get","60000")},getNews:function(d,c){if(d){new Ajax.Request(url,{method:"get",onSuccess:c})}}},defaults:{newsRegion:"",countRegion:"",refreshButton:"",loadingRegion:"",refreshCountRate:5,isRefreshOnInit:false,maxCount:99,countTemplate:"+{*}",callback:null},initialize:function(b){this.refreshCountTimer=null;this.sNewsLastTime="";this.count=0;this.freshdataUrl="";this.initializeOptions(b);this.initializeDOM();this.initializeEvent();this.isRefreshOnInit&&this.refreshNews(function(){this.refreshCount()});this.setRefreshCountTimer()},initializeOptions:function(d){for(var c in this.defaults){if(this.defaults.hasOwnProperty(c)){this[c]=d[c]?d[c]:this.defaults[c]}}},initializeDOM:function(){this.newsRegion=$(this.newsRegion);this.countRegion=$(this.countRegion);this.refreshButton=$(this.refreshButton);this.loadingRegion=$(this.loadingRegion)},initializeEvent:function(){this.onClickRefreshButtonHandler=this.onClickRefreshButton.bindAsEventListener(this);this.refreshButton.observe("click",this.onClickRefreshButtonHandler)},destroyEvent:function(){this.refreshButton.stopObserving("click",this.onClickRefreshButtonHandler)},onClickRefreshButton:function(){this.refreshNews()},refreshNews:function(b){this.showLoading();if(this.freshdataUrl.indexOf("test")>=0){this.freshdataUrl="http://www.test.com:9006/index/indextodayflash.html"}this.ajax({type:"get",url:this.freshdataUrl,data:"name=dipoo&info=good",dataType:"text",success:this.onRefreshNewsCallback.bind(this)});this.refreshButton.hide();this.unsetRefreshCountTimer();this.setRefreshCountTimer()},onRefreshNewsCallback:function(b){if(b&&b!==""){this.newsRegion.innerHTML=b;this.callback&&this.callback()}this.hideLoading()},refreshCount:function(){this.getNewsLastTime();this.Server.getUnreadNewsCount(this.sNewsLastTime,this.onRefreshCountCallback.bind(this))},onRefreshCountCallback:function(b){if(b&&b.value){this.count=b.value.unreadCount;this.freshdataUrl=b.value.freshdataUrl||"";if(this.count>0&&this.freshdataUrl!==""){if(this.count>=this.maxCount){this.count=this.maxCount;this.unsetRefreshCountTimer()}this.refreshButton.show();this.countRegion.innerHTML=(this.countTemplate.replace("{*}",this.count))}else{this.refreshButton.hide()}}},getNewsLastTime:function(){var b=this.newsRegion.getElementsByClassName("time");this.sNewsLastTime=b[0].getAttribute("pubtime");if(!this.sNewsLastTime){this.sNewsLastTime=""}},setRefreshCountTimer:function(){var b=this;if(!this.refreshCountTimer){this.refreshCountTimer=setTimeout(function(){b.unsetRefreshCountTimer();b.refreshCount();b.setRefreshCountTimer()},this.refreshCountRate*1000*60)}},unsetRefreshCountTimer:function(){clearTimeout(this.refreshCountTimer);this.refreshCountTimer=null},showLoading:function(){if(this.loadingRegion){this.loadingRegion.show()}},hideLoading:function(){if(this.loadingRegion){this.loadingRegion.hide()}},destroy:function(){this.destroyEvent();this.unsetRefreshCountTimer()},createAjax:function(){var f=null;if(window.ActiveXObject){try{f=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(d){try{f=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){alert("不能创建XMLHttpRequest实例！");return false}}}else{if(window.XMLHttpRequest){f=new window.XMLHttpRequest();if(f.overrideMimeType){f.overrideMimeType("text/xml")}}}return f},ajax:function(conf){var type=conf.type;var time=new Date();var url=conf.url+"?"+time.getTime();var data=conf.data;var dataType=conf.dataType;var success=conf.success;if(type==null){type="get"}if(dataType==null){dataType="text"}var xhr=this.createAjax();xhr.open(type,url,true);if(type=="GET"||type=="get"){xhr.send(null)}else{if(type=="POST"||type=="post"){xhr.setRequestHeader("content-type","application/x-www-form-urlencoded");xhr.send(data)}}xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){if(dataType=="text"||dataType=="TEXT"){if(success!=null){success(xhr.responseText)}}else{if(dataType=="xml"||dataType=="XML"){if(success!=null){success(xhr.responseXML)}}else{if(dataType=="json"||dataType=="JSON"){if(success!=null){success(eval("("+xhr.responseText+")"))}}}}}}}});!function(){var b=Class.create();Object.extend(b.prototype,{options:{goodsRegionId:"goodsRegion",showMarketPrice:false,showTag:false,showMultiTag:false,showPricebyMainProp:false,priceTemplate:"{0}",mainPropPriceTemplate:"{0}",marketPriceTemplate:"{0}",tagTemplate:"{0}",newTemplate:""},server:{getGoodsPriceAndTagInfo:function(d,a){return Mtime.Component.Ajax.crossDomainCallBack(siteGoodsServiceUrl,"Mtime.Ecommerce.Services","GetGoodsPriceAndTagInfo",[d],a,"/Mall.api","get","60000",null)}},initialize:function(a){this.setOptions(a);this.initializeDom();this.load()},setOptions:function(a){Object.extend(Object.extend(this,this.options),a)},initializeDom:function(a){this.goodsRegion=$(this.goodsRegionId);this.goodsRegions=this.goodsRegion.getElementsBySelector('[goodsid!=""]')},load:function(){var j=[],k="",a=0,l=0;for(a=0;a<this.goodsRegions.length;a++){var m=this.goodsRegions[a];var h=parseInt(m.getAttribute("goodsid"),10)||0;if(h>0){j.push(h)}}this.server.getGoodsPriceAndTagInfo(j,function(D){if(D&&D.value&&D.value.success&&D.value.result&&D.value.result.length>0){for(a=0;a<D.value.result.length;a++){var c=D.value.result[a];var e=this.goodsRegion.getElementsBySelector('[goodsid="'+c.id+'"]');for(l=0;l<e.length;l++){var d=e[l];var C=d.getElementsBySelector('[data-selector="price"]');if(C&&C.length>0){var B=C[0];if(c.price>0){B.innerHTML=String.format(this.priceTemplate,this.formatPrice(c.price))}}var x=d.getElementsBySelector('[data-mainprop!=""]');if(x&&x.length>0){var g=x[0];if(c.has_activity){if(c.price>0){g.innerHTML=String.format(this.mainPropPriceTemplate,this.formatPrice(c.price))}}else{var f=parseInt(g.getAttribute("data-mainprop"),10)||0;if(f>0){var y=c.mainprop.find(function(n){return n.mainprop_id==f});if(y&&y.mainprop_price>0){g.innerHTML=String.format(this.mainPropPriceTemplate,this.formatPrice(y.mainprop_price))}}}}var A=d.getElementsBySelector('[data-selector="market"]');if(A&&A.length>0){var z=A[0];if(this.showMarketPrice){if(c.market_price>0){z.innerHTML=String.format(this.marketPriceTemplate,this.formatPrice(c.market_price))}}else{if(c.has_activity){if(c.market_price>0){z.innerHTML=String.format(this.marketPriceTemplate,this.formatPrice(c.market_price))}}else{z.hide()}}}if(this.showTag){var G=d.getElementsBySelector('[data-selector="tag"]'),E="";if(G&&G.length>0){var F=G[0];if(c.has_activity){E=String.format(this.tagTemplate,c.tag);if(this.showMultiTag&&c.isnew){E+=this.newTemplate}}else{if(c.isnew){E=this.showMultiTag?this.newTemplate:String.format(this.tagTemplate,"新品")}}F.innerHTML=E}}}}}}.bind(this))},formatPrice:function(a){return a%100==0?(a/100).toFixed(0):(a/100).toFixed(2)},close:function(){this.destroyDOM()},destroyDOM:function(){this.goodsRegion=null;this.goodsRegions=null}});window.GoodsPriceControl=b}();var IndexPage=Class.create();Object.extend(IndexPage.prototype,{hotplayHeadImgIds:[],hotplayHeadImgRatingIds:[],hotplayMovieIds:[],hotplayUpcomingIds:[],communityHeadImgActivityIds:[],tgBgList:[],currentUserInfo:null,currentUserInGroup:null,movieTweetType:0,personTweetType:1,longReviewType:2,groupTopicType:3,PAGE_NAME:"M14_Index",options:{urls:[]},server:{loadData:function(j,k,l,g,h,m){return Mtime.Component.Ajax.crossDomainCallBack(siteChannelServiceUrl,"Mtime.Channel.Services","IndexLoadData",[j,k,l,g],h,"/Channel.api","get","60000",m)},addReviewComment:function(f,j,g,h,k){return Mtime.Component.Ajax.crossDomainCallBack(siteLibraryServiceUrl,"Mtime.Library.Services","AddMovieReviewComment",[f,j,g,"",""],h,"/Movie.api","get","60000",k)},addTweetComment:function(k,g,f,j){var h=[k,g,0,false,false,0,false,false];return Mtime.Component.Ajax.crossDomainCallBack(siteServiceUrl,"Mtime.Service.Pages.TwitterService","AddTweetCommentWithOptionCrossDomainByFlash",h,f,"/Service/Twitter.msi","post","20000",j)},getUserInfo:function(b){return Mtime.Component.Ajax.crossDomainCallBack(siteLibraryServiceUrl,"Mtime.Library.Services","GetUserInfo",[],b,"/Movie.api","get","60000")},addTopicReply:function(g,f,e,h){return Mtime.Component.Ajax.crossDomainCallBack(siteChannelServiceUrl,"Mtime.Channel.Services","AddTopicReply",[g,f],e,"/Channel.api","get","60000",h)},checkUserInGroup:function(e,d,f){return Mtime.Component.Ajax.crossDomainCallBack(siteChannelServiceUrl,"Mtime.Channel.Services","CheckUserInGroup",[e],d,"/Channel.api","get","60000",f)},userJoinGroup:function(e,d,f){return Mtime.Component.Ajax.crossDomainCallBack(siteChannelServiceUrl,"Mtime.Channel.Services","UserJoinGroup",[e],d,"/Channel.api","get","60000",f)}},setOptions:function(b){Object.extend(Object.extend(this,this.options),b)},initialize:function(b){this.setOptions(b);this.initializeServerData();this.initializeDOM();this.initializeEvent();this.initializeHeadImgTgBg();this.initializeControl();this.load()},initializeServerData:function(){if(typeof(tgBgList)!=="undefined"){this.tgBgList=tgBgList||[]}},initRegionClickObserver:function(){if(typeof tracker!=="undefined"&&tracker){tracker.observeRegionClick(this.PAGE_NAME)}},initializeDOM:function(){this.hotplayHeadImgRegion=$("hotplayHeadImgRegion");this.hotplayMovieRegion=$("hotplayMovieRegion");this.upcomingRegion=$("upcomingRegion");this.todayFocusDate=$("todayFocusDate");this.promotionRegion=$("promotionRegion")},destroyDOM:function(){this.hotplayHeadImgRegion=null;this.hotplayMovieRegion=null;this.upcomingRegion=null;this.todayFocusDate=null;this.promotionRegion=null},initializeEvent:function(){Event.observe(window,"unload",this.close.bind(this));this.countDown=setInterval(this.renderCountDown.bind(this),1000)},destroyEvent:function(){},initializeHeadImgTgBg:function(){if(this.tgBgList.length>0){var k;var f,j;for(var g=0,h=this.tgBgList.length;g<h;g++){k=this.tgBgList[g];f=$(k.TgName);if(f&&k.Pic1.length>0){j=f.parentNode.parentNode;j.style.backgroundImage=String.format("url({0})",k.Pic1);j.style.backgroundRepeat=k.Repeat}}}},initializeControl:function(){if($("newsHeadImgDotSlidesRegion")){this.newsHeadImgSlide=new Widgets.IndexTopSlidesControl({slidesRegion:"newsHeadImgSlidesRegion",dotSlidesRegion:"newsHeadImgDotSlidesRegion",backSlidesRegion:"newsHeadImgBackSlidesRegion",txtSlidesRegion:"newsHeadImgTxtSlidesRegion",advertisementRegion:"newsHeadImgTgRegion",prev:"newsHeadImgPre",next:"newsHeadImgNext",autoTimeout:5})}if($("todayFlashRegion")){this.remindNews=new RemindNews({newsRegion:"todayFlashRegion",countRegion:"todayFlashCount",refreshButton:"todayFlashFreshButton",loadingRegion:"todayFlashLoading",refreshCountRate:"5",callback:function(){this.intizeNewsPubTime()}.bind(this)})}if($("newsFunRegion")&&$("newsFunPre")&&$("newsFunNext")){this.newsFunSlide=new Widgets.indexDistanceSlidesControl({slidesRegion:"newsFunRegion",prev:"newsFunPre",next:"newsFunNext",showRegionWidth:960,slidesRegionWidth:720,currentPosition:0,itemWidth:240})}if($("newsSelectDotSlidesRegion")){this.newsSelectSlide=new Widgets.IndexTopSlidesControl({slidesRegion:"newsSelectSlidesRegion",dotSlidesRegion:"newsSelectDotSlidesRegion"})}if($("newsHotImgDotSlidesRegion")){this.newsHotImgSlide=new Widgets.IndexTopSlidesControl({slidesRegion:"newsHotImgSlidesRegion",dotSlidesRegion:"newsHotImgDotSlidesRegion",autoTimeout:3})}if($("hotplayHeadImgDotSlidesRegion")){this.hotplayHeadImgSlide=new Widgets.IndexTopSlidesControl({slidesRegion:"hotplayHeadImgSlidesRegion",dotSlidesRegion:"hotplayHeadImgDotSlidesRegion",backSlidesRegion:"hotplayHeadImgBackSlidesRegion",txtSlidesRegion:"hotplayHeadImgMovieRegion",advertisementRegion:"hotplayHeadImgTgRegion",prev:"hotplayHeadImgPre",next:"hotplayHeadImgNext",autoTimeout:5})}this.videoCtrl=new Widgets.CallOutVideo({slidesRegion:"content"});this.hotplayCard=new Card({mytimeContentRegion:"hotplayMovieSlide"});if($("hotplayMovieSlide")){this.hotplayMovieSlideCtrl=new Widgets.DistanceSlidesControl({slidesRegion:"hotplayMovieSlide",prev:"hotplayMoviePre",next:"hotplayMovieNext",slidesRegionWidth:648,itemWidth:162})}if($("upcomingSlide")){this.upcomingSlideCtrl=new Widgets.DistanceSlidesControl({slidesRegion:"upcomingSlide",prev:"upcomingPre",next:"upcomingNext",slidesRegionWidth:622,itemWidth:311})}this.shareCtrl=new IndexShareToolsControl();if($("bodyRegion")){this.card=new Card({mytimeContentRegion:"bodyRegion"})}if($("mallHeadImgDotSlidesRegion")){this.mallHeadImgSlide=new Widgets.IndexTopSlidesControl({slidesRegion:"mallHeadImgTxtSlidesRegion",dotSlidesRegion:"mallHeadImgDotSlidesRegion",backSlidesRegion:"mallHeadImgSlidesRegion",prev:"mallHeadImgPre",next:"mallHeadImgNext",autoTimeout:5})}if($("mallTopicDotSlidesRegion")){this.mallTopicSlide=new Widgets.IndexTopSlidesControl({slidesRegion:"mallTopicTxtSlidesRegion",dotSlidesRegion:"mallTopicDotSlidesRegion",prev:"mallTopicPre",next:"mallTopicNext",autoTimeout:5});if(window.GoodsPriceControl==undefined){$loadSubJs("/js/2014/GoodsPriceControl.js",function(){this.goodsPriceControl=new GoodsPriceControl({goodsRegionId:"goodsRecommendRegion",showTag:true,priceTemplate:"￥<strong>{0}</strong>",tagTemplate:'<i class="i_sg">{0}</i>'})}.bind(this))}else{this.goodsPriceControl=new GoodsPriceControl({goodsRegionId:"goodsRecommendRegion",showTag:true,priceTemplate:"￥<strong>{0}</strong>",tagTemplate:'<i class="i_sg">{0}</i>'})}}},initializeCommunityHeadImgControl:function(b){if($("communityHeadImgDotSlidesRegion")){this.communityHeadImgSlide=new Widgets.IndexTopSlidesControl({slidesRegion:"communityHeadImgSlidesRegion",dotSlidesRegion:"communityHeadImgDotSlidesRegion",backSlidesRegion:"communityHeadImgBackSlidesRegion",advertisementRegion:"communityHeadImgTgRegion",prev:"communityHeadImgPre",next:"communityHeadImgNext",autoTimeout:5})}if($("communityLoginRegion")){this.communityHeadImgLoginControl=new CommunityHeadImgLoginControl({mcUrl:b})}this.blogComment=new Widgets.BlogComment({container:"divCommunityContent",lengthExpMax:210,callback:this.communityPostComment.bind(this),clickTextareaCallBack:this.clickCommunityTextarea.bind(this),blurTextareaCallBack:this.blurCommunityTextarea.bind(this)})},destroyControl:function(){if(this.newsHeadImgSlide){this.newsHeadImgSlide.close();this.newsHeadImgSlide=null}if(this.remindNews){this.remindNews=null}if(this.newsFunSlide){this.newsFunSlide.close();this.newsFunSlide=null}if(this.newsSelectSlide){this.newsSelectSlide.close();this.newsSelectSlide=null}if(this.newsHotImgSlide){this.newsHotImgSlide.close();this.newsHotImgSlide=null}if(this.hotplayHeadImgSlide){this.hotplayHeadImgSlide.close();this.hotplayHeadImgSlide=null}if(this.videoCtrl){this.videoCtrl.close();this.videoCtrl=null}if(this.hotplayMovieSlideCtrl){this.hotplayMovieSlideCtrl.close();this.hotplayMovieSlideCtrl=null}if(this.upcomingSlideCtrl){this.upcomingSlideCtrl.close();this.upcomingSlideCtrl=null}if(this.ticketSearchBox){this.ticketSearchBox.close();this.ticketSearchBox=null}if(this.communityHeadImgSlide){this.communityHeadImgSlide.close();this.communityHeadImgSlide=null}if(this.communityHeadImgLoginControl){this.communityHeadImgLoginControl.close();this.communityHeadImgLoginControl=null}if(this.card){this.card.close();this.card=null}if(this.shareCtrl){this.shareCtrl.close();this.shareCtrl=null}if(this.blogComment){this.blogComment.close();this.blogComment=null}if(this.mallHeadImgSlide){this.mallHeadImgSlide.close();this.mallHeadImgSlide=null}if(this.mallTopicSlide){this.mallTopicSlide.close();this.mallTopicSlide=null}if(this.goodsPriceControl){this.goodsPriceControl.close();this.goodsPriceControl=null}},load:function(){this.intizeNewsPubTime();var g=this.getMovieIds(this.hotplayHeadImgRegion);this.hotplayHeadImgIds=g.split(",");this.hotplayHeadImgRatingIds=this.getRatingMovieIds(this.hotplayHeadImgIds);var h=this.hotplayHeadImgRatingIds.join(",");var j=this.getMovieIds(this.hotplayMovieRegion);this.hotplayMovieIds=j.split(",");var k=this.getMovieIds(this.upcomingRegion);this.hotplayUpcomingIds=k.split(",");this.communityHeadImgActivityIds=this.getCommunityHeadImgActivityIds();var f=this.communityHeadImgActivityIds.join(",");this.server.loadData(h,j,k,f,this.loadDataCallback.bind(this))},intizeNewsPubTime:function(){var h=$$("#todayFlashRegion p[pubtime]");if(typeof h!="undefined"&&h.length>0){var g,j,k;for(var f=0;f<h.length;f++){g=h[f];j=g.readAttribute("pubtime");if(!Mtime.isEmpty(j)){k=this.getNewsPubTime(j);g.innerHTML=k}}}},getNewsPubTime:function(d){var c=Mtime.parseDate(d);if(!c){c=new Date()}return Mtime.dateToFormatedString(c)},getMovieIds:function(c){if(c&&c.hasAttribute("movieids")){var d=c.getAttribute("movieids");return d}return""},getRatingMovieIds:function(l){var n=[];var m;var q;for(var j=0,k=l.length;j<k;j++){m=$("hotplayHeadImgRating_"+l[j]);if(m){n.push(l[j])}q=$("hotplayHeadImgUpcomingDay_"+l[j]);if(q){var o=q.getAttribute("datetime");if(o){if(o.length>0){var p=this.getSubday(o);if(p>0){q.innerHTML=String.format("距上映还有 <strong>{0}</strong> 天",p)}else{q.remove()}}else{q.remove()}}}}return n},getSubday:function(j){var g=j.split("-");var k=new Date(g[0],g[1]-1,g[2]);var h=new Date();var m=new Date(h.getFullYear(),h.getMonth(),h.getDate());var l=parseInt(Math.abs(k-m)/1000/60/60/24,10);if((k-m)<0){return -l}return l},loadDataCallback:function(result){if(result.value){this.setTodayFocusDate(result.value.curDate);if(this.hotplayHeadImgIds.length>0&&result.value.hotplayHeadImgRatings){this.showHotplayHeadImgRating(result.value.hotplayHeadImgRatings)}var showtimeList=result.value.showtimeList;if(showtimeList.length>0){this.showHotplayHeadImgShowtime(showtimeList)}var upcomingTicketList=[];var searchData=result.value.searchData;if(searchData){var data=eval("("+searchData+")");if($("ticketSearchBoxRegion")){this.ticketSearchBox=new IndexPageTicketSearchBox({container:"ticketSearchBoxRegion",cityId:result.value.cityId,cityName:result.value.cityName})}if(data.hotplayMovieHasTicketList){this.showHotplayMovieButton(data.hotplayMovieHasTicketList)}if(data.upcomingTicketList){upcomingTicketList=data.upcomingTicketList}}if(result.value.upcomingWantList){this.showUpcomingMovieInfo(result.value.upcomingWantList,upcomingTicketList)}if(result.value.isLogin&&$("communityLoginRegion")){this.removeLoginDom()}this.initializeCommunityHeadImgControl(result.value.mcUrl);var activityUsers=result.value.activityUsers;var activityUserCounts=result.value.activityUserCounts;if(activityUsers){this.showActivityUsers(activityUsers,activityUserCounts)}this.initRegionClickObserver()}},setTodayFocusDate:function(b){if(this.todayFocusDate){this.todayFocusDate.innerHTML=b}},showHotplayHeadImgRating:function(h){var e;for(var f=0,g=this.hotplayHeadImgRatingIds.length;f<g;f++){e=$("hotplayHeadImgRating_"+this.hotplayHeadImgRatingIds[f]);if(e){if(h[f].length>0){$show(e);e.innerHTML=String.format('<p class="pt3 pb3">总评分</p><strong>{0}</strong>',h[f])}else{e.remove()}}}},showHotplayHeadImgShowtime:function(q){var j=document.createElement("div");j.innerHTML=q;var o=$$("div[movieid]",j);var n;var m;for(var k=0,l=o.length;k<l;k++){n=o[k];m=n.getAttribute("movieid");var p=$("hotplayShowtime_"+m);if(p){p.innerHTML=n.innerHTML}}},showHotplayMovieButton:function(o){var h,m;var l=0;var n;for(var j=0,k=this.hotplayMovieIds.length;j<k;j++){l=this.hotplayMovieIds[j];n=this.getTicketByMovieId(l,o);if(n!==null){h=$("hotplayMovieButton_"+l);if(h){h.innerHTML=n.HasTicket?"选座购票":"查影讯";$show(h.parentNode)}if(n.Status){m=$("hotplayMovieStatus_"+l);if(m&&n.Status==="hot"){m.innerHTML='<i class="icon_hot"></i>'}if(m&&n.Status==="new"){m.innerHTML='<i class="icon_new"></i>'}}}}},getTicketByMovieId:function(g,h){g=parseInt(g,10);for(var e=0,f=h.length;e<f;e++){if(h[e].MovieID===g){return h[e]}}return null},getCommingMovieTicketByMovieId:function(g,h){g=parseInt(g,10);for(var e=0,f=h.length;e<f;e++){if(h[e].MovieID===g&&h[e].HasTicket){return h[e].MovieShowTimePageDate}}return""},showUpcomingMovieInfo:function(q,n){var p,m;var l=0;var o="";for(var j=0,k=this.hotplayUpcomingIds.length;j<k;j++){l=this.hotplayUpcomingIds[j];p=$("upcomingWantsee_"+l);m=$("upcomingPresell_"+l);if(p&&q.length>0){p.innerHTML=q[j]}if(m){if(n&&n.length>0){o=this.getCommingMovieTicketByMovieId(l,n);if(o.length>0){m.innerHTML="超前预售";m.setAttribute("href",o);$show(m.parentNode)}}else{m.remove()}}}},renderCountDown:function(){var c=false;var d=this.promotionRegion.getElementsBySelector("div.t_timedown");$A(d).each(function(p){var a=$(p);var b=a.readAttribute("begin");var t=a.readAttribute("end");var w=new Date().getTime();var x,s,u,v,y,r="",q="";if(b>w){r="距开始";x=Math.ceil((b-w)/1000);c=true}else{if(t>w){r="距结束";x=Math.ceil((t-w)/1000);c=true}else{r="";x=0}}if(x>0){s=Math.floor(x/60/60/24);u=Math.floor((x-s*60*60*24)/60/60);v=Math.floor((x-s*60*60*24-u*60*60)/60);y=x-s*60*60*24-u*60*60-v*60;if(s>=10){q+="<i>"+s.toString()[0]+"</i><i>"+s.toString()[1]+"</i><em>天</em>"}else{if(s>0){q+="<i>0</i><i>"+s+"</i><em>天</em>"}else{q+="<i>0</i><i>0</i><em>天</em>"}}if(u>=10){q+="<i>"+u.toString()[0]+"</i><i>"+u.toString()[1]+"</i><em>:</em>"}else{if(u>0){q+="<i>0</i><i>"+u+"</i><em>:</em>"}else{q+="<i>0</i><i>0</i><em>:</em>"}}if(v>=10){q+="<i>"+v.toString()[0]+"</i><i>"+v.toString()[1]+"</i><em>:</em>"}else{if(v>0){q+="<i>0</i><i>"+v+"</i><em>:</em>"}else{q+="<i>0</i><i>0</i><em>:</em>"}}if(y>=10){q+="<i>"+y.toString()[0]+"</i><i>"+y.toString()[1]+"</i>"}else{if(y>0){q+="<i>0</i><i>"+y+"</i>"}else{q+="<i>0</i><i>0</i>"}}}else{q="";a.previous("b.t_timeover",0).removeAttribute("style")}a.down("p",0).innerHTML=r;a.down("p",1).innerHTML=q});if(!c){clearInterval(this.countDown);this.countDown=null}},getCommunityHeadImgActivityIds:function(){var h=[];var m=$$("#communityHeadImgSlidesRegion div[activityid]");if(!Mtime.isEmpty(m)){var l;var g;for(var j=0,k=m.length;j<k;j++){l=$(m[j]);g=l.getAttribute("activityid");h.push(parseInt(g,10))}}return h},showActivityUsers:function(g,f){var h;for(var j=0,k=this.communityHeadImgActivityIds.length;j<k;j++){h=$("communityHeadImgJoinRegion_"+this.communityHeadImgActivityIds[j]);if(h&&g[j].length>0){h.innerHTML=String.format('<span class="tc mt3">已报名<br><em class="c_666">({0}人)</em></span>{1}',f[j],g[j])}}},removeLoginDom:function(){this.removeLastDom("#communityHeadImgTgRegion div.ddtiper");this.removeLastDom("#communityHeadImgBackSlidesRegion li");this.removeLastDom("#communityHeadImgDotSlidesRegion a");this.removeLastDom("#communityHeadImgSlidesRegion dd")},removeLastDom:function(f){var e=$$(f);var d=e.length;if(d>0){e[d-1].remove()}},displayLoginDailog:function(){if(typeof UserLoginDialog=="undefined"){$loadJs("/js/2014/UserLoginDialog.js",function(){new UserLoginDialog({callback:function(){location.reload()}})}.bind(this))}else{new UserLoginDialog({callback:function(){location.reload()}})}},blurCommunityTextarea:function(f,e,d){if(d.value=="发表评论"||d.value.trim().length<=0){this.communityHeaderHideOrDisplayComment(d,true)}},communityHeaderHideOrDisplayComment:function(m,q){var p=m.getAttribute("isheader")=="1";if(p){var j=m.parentElement.parentElement.parentElement;var n=0;for(var o=0;o<j.children.length;o++){if(j.children[o].className=="pic_30"){n+=1}}var s=1;if(q){for(var r=0;r<j.children.length;r++){j.children[r].show()}}else{if(n>s){j.children[0].hide()}}var t=parseInt(m.getAttribute("objtypeid"),10);if(t===3){var u=m.up("div.i_timecont").down("p");if(u){if(q){u.show()}else{u.hide()}}}}},clickCommunityTextarea:function(k,j,f){var h=f.getAttribute("isheader")=="1";if(h){this.communityHeaderHideOrDisplayComment(f,false)}if(this.currentUserInfo){if(this.currentUserInfo.isAnonymous){this.displayLoginDailog()}else{this.currentUserInGroup=null;if(k==this.groupTopicType){var g=parseInt(f.getAttribute("groupid"),10);this.server.checkUserInGroup(g,function(a){if(a&&a.value){this.currentUserInGroup=a.value;if(!this.currentUserInGroup.inGroup){this.joinGroup(g)}}}.bind(this),null)}}}else{this.server.getUserInfo(function(b){if(b&&b.value){this.currentUserInfo=b.value}if(this.currentUserInfo){if(this.currentUserInfo.isAnonymous){this.displayLoginDailog()}else{this.currentUserInGroup=null;if(k==this.groupTopicType){var a=parseInt(f.getAttribute("groupid"),10);this.server.checkUserInGroup(a,function(c){if(c&&c.value){this.currentUserInGroup=c.value;if(!this.currentUserInGroup.inGroup){this.joinGroup(a)}}}.bind(this),null)}}}}.bind(this))}},joinGroup:function(b){new Dialog({windowClassName:"w295",content:'<div class="tc mt25 mb30 px20 lh15">参与话题讨论，请先加入群组</div>',buttonRegionClass:"tc pb12 pt15",buttons:[{title:"加入",keyCode:Event.KEY_RETURN,buttonStyle:"btn_square_hover mr15",callback:function(a){this.joinGroupRequest(b);a.close()}.bind(this)}],onClickCloseCallback:Prototype.emptyFunction})},joinGroupRequest:function(b){this.server.userJoinGroup(b,function(a){if(a&&a.value){if(a.value.status==1){this.currentUserInGroup=a.value;$alert("加入群组成功")}else{if(a.value.status==-1){$alert("群组不存在")}else{if(a.value.status==-4){$alert("对不起，你已被管理员放入群组黑名单中，暂无法加入和退出该群组")}else{if(a.value.status==-3){$alert("加入该群组需要管理员的审批，请耐心等待")}else{$alert("加入群组失败")}}}}}}.bind(this),null)},redirectCommentPage:function(b){new Dialog({windowClassName:"w295",content:'<div class="tc mt25 mb30 px20 lh15">发布成功</div>',buttonRegionClass:"tc pb12 pt15",buttons:[{title:"查看详情",keyCode:Event.KEY_RETURN,buttonStyle:"btn_square_hover mr15",callback:function(a){window.open(b);a.close()}.bind(this)}],onClickCloseCallback:Prototype.emptyFunction})},communityPostComment:function(g,l,k,h){if(!this.currentUserInfo){return}if(g.trim().length===0){$alert("请输入回复内容");if(AutoHeight){AutoHeight.stopAuto(h)}}var j=h.getAttribute("isheader")=="1";var m=h.getAttribute("redirecturl");if(l==this.movieTweetType||l==this.personTweetType){this.server.addTweetComment(g,k,function(a){if(a&&a.value&&this.addCommentErrorCheck(a)){h.value="";if(AutoHeight){AutoHeight.stopAuto(h)}this.redirectCommentPage(m)}else{if(a.value===-9){this.displayLoginDailog()}else{if(a.value==-20){$alert("你发的速度太快了，休息一下吧:)");h.value="";if(AutoHeight){AutoHeight.stopAuto(h)}}else{$alert("发布失败")}}}this.communityHeaderHideOrDisplayComment(h,true)}.bind(this),null)}else{if(l==this.longReviewType){this.server.addReviewComment(k,0,g,function(a){if(a.value.commentId){h.value="";if(AutoHeight){AutoHeight.stopAuto(h)}this.redirectCommentPage(m)}else{if(a.value.status==-105){if(a.value.isUserLogin){$alert("你发的速度太快了，休息一下吧:)");h.value="";if(AutoHeight){AutoHeight.stopAuto(h)}return}}if(!a.value.isUserLogin){this.displayLoginDailog();return}else{if(a.value.msg!="undefined"&&a.value.msg.length>0){$alert(a.value.msg)}}}this.communityHeaderHideOrDisplayComment(h,true)}.bind(this))}else{if(l==this.groupTopicType){if(!this.currentUserInGroup){return}if(!this.currentUserInGroup.inGroup){$alert("请先加入群组");return}this.server.addTopicReply(k,g,function(a){if(a.value.status==1){h.value="";if(AutoHeight){AutoHeight.stopAuto(h)}this.redirectCommentPage(m)}else{if(a.value.status==-101){if(a.value.isUserLogin){$alert("你发的速度太快了，休息一下吧:)");h.value="";if(AutoHeight){AutoHeight.stopAuto(h)}return}}if(a.value.status==-4){$alert("您填写的内容包含了敏感词，请修改");return}if(a.value.status==-10){this.displayLoginDailog();return}if(a.value.msg!="undefined"&&a.value.msg.length>0){$alert(a.value.msg)}}this.communityHeaderHideOrDisplayComment(h,true)}.bind(this),null)}}}},addCommentErrorCheck:function(j){var k=parseInt(j.value.success,10);if(k===1){var f=function(a){switch(a){case 0:return"保存失败.";case -1:return"内容过长.";case -2:return"内容为空.";case -3:return"非法的用户.";case -4:return"微评不存在.";case -5:return"原回复已被删除.";case -6:return"在对方的黑名单中.";case -7:return"原作者微评正在审核中，如有不便敬请谅解！";default:return""}};var h=function(a){switch(a){case 0:return"保存失败.";case -1:return"内容过长.";case -2:return"非法的用户.";case -3:return"原微评不存在.";case -4:return"原微评不存在.";case -5:return"原作者微评正在审核中，如有不便敬请谅解！";default:return""}};var g="";if(parseInt(j.value.commentId,10)<=0){g=f(parseInt(j.value.commentId,10))}if(!g&&j.value.isForward&&parseInt(j.value.forwardTweetId,10)<=0){g=h(parseInt(j.value.forwardTweetId,10))}if(!g&&j.value.isCommentToRoot&&parseInt(j.value.commentToRootId,10)<=0){g=f(parseInt(j.value.commentToRootId,10))}if(!g&&parseInt(j.value.replyResult,10)!=1){g=j.value.replyError||""}if(g){$alert(g,null,null,4);return false}else{return true}}else{if(k===-4){$alert("你的评论有被禁止的内容，请修改后发布。",null,null,4);return false}else{if(k===-5){$alert("你的评论有被禁止的内容，请修改后发布。",null,null,4);return false}else{if(k===-20){$alert("你发布的速度太快了，休息一下吧：）",null,null,4);return false}else{if(k===-30){$alert("非法用户",null,null,4);return false}}}}}},close:function(){this.destroyControl();this.destroyEvent();this.destroyDOM();this.hotplayHeadImgIds=null;this.hotplayMovieIds=null;this.hotplayUpcomingIds=null;this.urls=null}});